<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="This Learning Journey enables cloud operators and developers to deliver cloud-native solutions with Red Hat OpenShift in hybrid cloud environments."><meta name=author content="GSI Labs"><link href=https://ibm-ecosystem-lab.github.io/ibm-gsi-cloudnative-journey/guides/continuous-delivery/ rel=canonical><link rel=icon href=../../images/cloudnativetoolkit.png><meta name=generator content="mkdocs-1.2.1, mkdocs-material-7.1.8"><title>Continuous Delivery - TechZone Automation - Cloud-Native Learning Journey</title><link rel=stylesheet href=../../assets/stylesheets/main.ca7ac06f.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.f1a3b89f.min.css><meta name=theme-color content=#000000><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans:300,400,400i,700%7CIBM+Plex+Mono&display=fallback"><style>:root{--md-text-font-family:"IBM Plex Sans";--md-code-font-family:"IBM Plex Mono"}</style><link rel=stylesheet href=../../css/extra.css><link rel=stylesheet href=../../css/toolkit-code.css><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-155887541-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){var e;this.value&&(e=document.location.pathname,ga("send","pageview",e+"?q="+this.value))}),"undefined"!=typeof location$&&location$.subscribe(function(e){ga("send","pageview",e.pathname)})})</script><script async src=https://www.google-analytics.com/analytics.js></script><!-- Determine title --><!-- The image needs to have an absolute URL --><!-- Open graph meta tags --><meta property=og:type content=website><meta property=og:title content="TechZone Automation - Cloud-Native Learning Journey - Continuous Delivery"><meta property=og:description content="This Learning Journey enables cloud operators and developers to deliver cloud-native solutions with Red Hat OpenShift in hybrid cloud environments."><meta content=https://ibm-ecosystem-lab.github.io/ibm-gsi-cloudnative-journey/guides/continuous-delivery/ property=og:url><meta property=og:image content=https://ibm-ecosystem-lab.github.io/ibm-gsi-cloudnative-journey/assets/images/banner.png><meta property=og:image:type content=image/png><meta property=og:image:width content=1080><meta property=og:image:height content=568></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=black data-md-color-accent> <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#what-is-continuous-delivery class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="TechZone Automation - Cloud-Native Learning Journey" class="md-header__button md-logo" aria-label="TechZone Automation - Cloud-Native Learning Journey" data-md-component=logo> <img src=../../images/cloudnativetoolkit.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> TechZone Automation - Cloud-Native Learning Journey </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Continuous Delivery </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query data-md-state=active required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/ibm-ecosystem-lab/ibm-gsi-cloudnative-journey/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <!-- Determine class according to configuration --> <!-- Main navigation --> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <!-- Site title --> <!--
  <label class="md-nav__title" for="__drawer">
    <a
      href="../.."
      title="TechZone Automation - Cloud-Native Learning Journey"
      class="md-nav__button md-logo"
      aria-label="TechZone Automation - Cloud-Native Learning Journey"
      data-md-component="logo"
    >
      
  <img src="../../images/cloudnativetoolkit.png" alt="logo">

    </a>
    TechZone Automation - Cloud-Native Learning Journey
  </label>
--> <!-- Repository information --> <div class=md-nav__source> <a href=https://github.com/ibm-ecosystem-lab/ibm-gsi-cloudnative-journey/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> </div> </a> </div> <!-- Render item list --> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1 type=checkbox id=__nav_1> <label class=md-nav__link for=__nav_1> Introduction <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Introduction data-md-level=1> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> Introduction </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../getting-started/introduction/ class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=../../getting-started/prereqs/ class=md-nav__link> Prerequisites </a> </li> <li class=md-nav__item> <a href=../../getting-started/checksetup/ class=md-nav__link> Validate Environment </a> </li> <li class=md-nav__item> <a href=../../getting-started/devenvsetup/ class=md-nav__link> Developer Tools Setup </a> </li> <li class=md-nav__item> <a href=../../getting-started/cli/ class=md-nav__link> Developer Tools CLI </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2> Developer Foundation <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Developer Foundation" data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Developer Foundation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../developer-foundation/agenda/ class=md-nav__link> Agenda </a> </li> <li class=md-nav__item> <a href=../../developer-foundation/cloud-native-overview/ class=md-nav__link> What is Cloud-Native? </a> </li> <li class=md-nav__item> <a href=../../developer-foundation/cloud-native-app-dev/ class=md-nav__link> Cloud-Native App Dev </a> </li> <li class=md-nav__item> <a href=../../developer-foundation/containers/ class=md-nav__link> Containers Overview </a> </li> <li class=md-nav__item> <a href=../../developer-foundation/k8s-overview/ class=md-nav__link> Kubernetes 'overview' </a> </li> <li class=md-nav__item> <a href=../../developer-foundation/openshift/ class=md-nav__link> Openshift 'overview' </a> </li> <li class=md-nav__item> <a href=../../developer-foundation/k8s-core-concepts/ class=md-nav__link> Core Concepts </a> </li> <li class=md-nav__item> <a href=../../developer-foundation/k8s-configuration/ class=md-nav__link> Configuration </a> </li> <li class=md-nav__item> <a href=../../developer-foundation/k8s-multi-container-pods/ class=md-nav__link> Multi-Container Pods </a> </li> <li class=md-nav__item> <a href=../../developer-foundation/k8s-observability/k8s-observability/ class=md-nav__link> Observability </a> </li> <li class=md-nav__item> <a href=../../developer-foundation/k8s-pod-design/ class=md-nav__link> Pod Design </a> </li> <li class=md-nav__item> <a href=../../developer-foundation/k8s-services-networking/ class=md-nav__link> Services & Networking </a> </li> <li class=md-nav__item> <a href=../../developer-foundation/k8s-state-persistence/ class=md-nav__link> State Persistence </a> </li> <li class=md-nav__item> <a href=../../developer-foundation/k8s-troubleshooting/ class=md-nav__link> Troubleshoot </a> </li> <li class=md-nav__item> <a href=../../developer-foundation/garage-development/ class=md-nav__link> Garage Method </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3> Developer Intermediate <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Developer Intermediate" data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Developer Intermediate </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../developer-intermediate/agenda/ class=md-nav__link> Agenda </a> </li> <li class=md-nav__item> <a href=../../developer-intermediate/deploy-app/ class=md-nav__link> Deploy First App </a> </li> <li class=md-nav__item> <a href=../../developer-intermediate/artifact-management/ class=md-nav__link> Artifact Management </a> </li> <li class=md-nav__item> <a href=../../developer-intermediate/code-analysis/ class=md-nav__link> Code Analysis </a> </li> <li class=md-nav__item> <a href=../../developer-intermediate/continuous-delivery/ class=md-nav__link> Continuous Delivery </a> </li> <li class=md-nav__item> <a href=../../developer-intermediate/content-overview/ class=md-nav__link> DevSecOps Overview </a> </li> <li class=md-nav__item> <a href=../../developer-intermediate/continuous-integration/ class=md-nav__link> Continuous Integration </a> </li> <li class=md-nav__item> <a href=../../developer-intermediate/image-registry/ class=md-nav__link> Image Registry </a> </li> <li class=md-nav__item> <a href=../../developer-intermediate/log-management/ class=md-nav__link> Log Management </a> </li> <li class=md-nav__item> <a href=../../developer-intermediate/monitoring/ class=md-nav__link> Monitoring </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_11 type=checkbox id=__nav_3_11> <label class=md-nav__link for=__nav_3_11> Inventory App <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Inventory App" data-md-level=2> <label class=md-nav__title for=__nav_3_11> <span class="md-nav__icon md-icon"></span> Inventory App </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../developer-intermediate/inventory-application/ class=md-nav__link> Intro </a> </li> <li class=md-nav__item> <a href=../../developer-intermediate/inventory-prebuilt-solution/ class=md-nav__link> Solution </a> </li> <li class=md-nav__item> <a href=../../developer-intermediate/inventory-service/ class=md-nav__link> Service </a> </li> <li class=md-nav__item> <a href=../../developer-intermediate/inventory-bff/ class=md-nav__link> BFF </a> </li> <li class=md-nav__item> <a href=../../developer-intermediate/inventory-ui/ class=md-nav__link> UI </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4> Developer Advanced <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Developer Advanced" data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Developer Advanced </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../developer-advanced-1/inventory-cd/ class=md-nav__link> CD for Inventory App </a> </li> <li class=md-nav__item> <a href=../../developer-advanced-1/database-with-cloudant/ class=md-nav__link> Database with Cloudant </a> </li> <li class=md-nav__item> <a href=../../developer-advanced-1/database-with-mongodb/ class=md-nav__link> Database with MongoDB </a> </li> <li class=md-nav__item> <a href=../../developer-advanced-1/inventory-appid/ class=md-nav__link> Authentication with AppID </a> </li> <li class=md-nav__item> <a href=../../developer-advanced-1/code-engine/ class=md-nav__link> Code Engine </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#what-is-continuous-delivery class=md-nav__link> What is continuous delivery </a> <nav class=md-nav aria-label="What is continuous delivery"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#what-is-gitops class=md-nav__link> What is GitOps </a> </li> <li class=md-nav__item> <a href=#cicd-integration class=md-nav__link> CI/CD integration </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#what-is-argo-cd class=md-nav__link> What is Argo CD </a> </li> <li class=md-nav__item> <a href=#configuring-gitops-with-argo-cd class=md-nav__link> Configuring GitOps with Argo CD </a> <nav class=md-nav aria-label="Configuring GitOps with Argo CD"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#set-up-the-gitops-repo class=md-nav__link> Set up the GitOps repo </a> </li> <li class=md-nav__item> <a href=#register-the-git-repo-in-argo-cd class=md-nav__link> Register the git repo in Argo CD </a> </li> <li class=md-nav__item> <a href=#create-a-project-in-argo-cd-optional class=md-nav__link> Create a project in Argo CD (Optional) </a> </li> <li class=md-nav__item> <a href=#add-an-application-in-argo-cd-for-each-application-component-helm-chart class=md-nav__link> Add an application in Argo CD for each application component (Helm chart) </a> </li> <li class=md-nav__item> <a href=#hook-the-ci-pipeline-to-the-cd-pipeline class=md-nav__link> Hook the CI pipeline to the CD pipeline </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/ibm-ecosystem-lab/ibm-gsi-cloudnative-journey/edit/main/docs/guides/continuous-delivery.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <h1>Continuous Delivery</h1> <!--- cSpell:ignore ICPA openshiftconsole Theia userid toolset crwexposeservice gradlew bluemix ocinstall Mico crwopenlink crwopenapp swaggerui gitpat gituser  buildconfig yourproject wireframe devenvsetup viewapp crwopenlink  atemplatized rtifactoryurlsetup Kata Koda configmap Katacoda checksetup cndp katacoda checksetup Linespace igccli regcred REPLACEME Tavis pipelinerun openshiftcluster invokecloudshell cloudnative sampleapp bwoolf hotspots multicloud pipelinerun Sricharan taskrun Vadapalli Rossel REPLACEME cloudnativesampleapp artifactoryuntar untar Hotspot devtoolsservices Piyum Zonooz Farr Kamal Arora Laszewski  Roadmap roadmap Istio Packt buildpacks automatable ksonnet jsonnet targetport podsiks SIGTERM SIGKILL minikube apiserver multitenant kubelet multizone Burstable checksetup handson  stockbffnode codepatterns devenvsetup newwindow preconfigured cloudantcredentials apikey Indexyaml classname  errorcondition tektonpipeline gradlew gitsecret viewapp cloudantgitpodscreen crwopenlink cdply crwopenapp --> <p><strong>Use Argo CD to continuously deliver application changes</strong></p> <p>In IBM Garage Method, one of the Develop practices is <a href=https://www.ibm.com/garage/method/practices/deliver/practice_continuous_delivery/ >continuous delivery</a>. The Developer Environment uses an <a href=https://argoproj.github.io/argo-cd/ >Argo CD</a> pipeline to automate continuous delivery.</p> <h2 id=what-is-continuous-delivery>What is continuous delivery<a class=headerlink href=#what-is-continuous-delivery title="Permanent link">&para;</a></h2> <p>Continuous delivery is the DevOps approach of frequently making new versions of an application's components available for deployment to a runtime environment. The process involves automation of the build and validation process and concludes with a new version of the application that is available for promotion to another environment.</p> <p>Continuous delivery is closely related to continuous deployment. The distinction is: - Continuous delivery deploys an application when a user manually triggers deployment - Continuous deployment deploys an application automatically when it is ready</p> <p>An application is ready for deployment when it passes a set of tests that prove it doesn't contain any significant problems. These tests must be automated so that deployment can be automated. Until you have this set of automated tests and trust them sufficiently, stick with continuous delivery.</p> <h3 id=what-is-gitops>What is GitOps<a class=headerlink href=#what-is-gitops title="Permanent link">&para;</a></h3> <p><a href=https://www.weave.works/technologies/gitops/ ><em>GitOps</em></a> is the operational pattern of using Git repositories as the source of truth for defining the configuration that makes up the desired state of the application. It uses Git repositories to declaratively represent the desired state of applications in deployment environments.</p> <p>GitOps takes advantage of several Git features: - Git has an audit log of changes - Whole releases can be managed from a pull request - Git enables changes to be rolled back quickly if there is an issue with a new release</p> <h3 id=cicd-integration>CI/CD integration<a class=headerlink href=#cicd-integration title="Permanent link">&para;</a></h3> <p>For the full end-to-end build and delivery process, both the CI and CD pipelines are required. For this to work, a Git repo is used to convey the configuration values. Within the Developer Environment, we have used certain naming conventions to streamline and simplify the integration between the various components.</p> <p><img alt="Argo CD config" src=../../images/continuous-delivery/CI_CD-pipelines.png></p> <p>The naming components are: </p> <ul> <li><code>app repo</code> - The name of the Git repository for the application</li> <li><code>git org</code> - The name of the GitHub organization for the application's repo</li> <li><code>tag</code> - The build version</li> <li><code>chart version</code> - The version of the Helm chart</li> <li><code>region</code> - The geographic location in IBM Cloud</li> </ul> <p>The derived names are: </p> <ul> <li>GitHub application path: <code>github.com/{git org}/{app repo}</code></li> <li>CI Pipeline name: <code>{git org}.{app repo}</code></li> <li>Docker image's path: <code>{region}.icr.io/{git org}/{app repo}:{tag}</code> in the <a href=/developer-intermediate/image-registry>Image Registry</a></li> <li>Helm chart's path: <code>generic-local/{git org}/{app repo}-{tag}-{chart version}.tgz</code> in the <a href=/developer-intermediate/artifact-management>Helm Repository</a></li> <li>Dependencies filename: <code>{app repo}/requirements.yaml</code> in the GitOps repo</li> <li>CD Pipeline name: <code>{app repo}</code></li> </ul> <h2 id=what-is-argo-cd>What is Argo CD<a class=headerlink href=#what-is-argo-cd title="Permanent link">&para;</a></h2> <p><a href=https://argoproj.github.io/argo-cd/ >Argo CD</a> is a declarative, GitOps continuous delivery tool for Kubernetes. The deployment environment is a Kubernetes cluster or namespace, which also works for an OpenShift cluster or project. Argo CD models a collection of applications as a project and uses a Git repository to store the project's desired state. Each application is stored as a folder in the repository, and each deployment environment is stored as a branch in the repository.</p> <p>Argo CD supports defining Kubernetes manifests in a number of ways: - helm charts - kustomize - ksonnet - jsonnet - plain directory of yaml/json manifests</p> <p>Argo CD synchronizes the application state with the desired state defined in Git and automates the deployment of Kubernetes resources to ensure they match.</p> <h2 id=configuring-gitops-with-argo-cd>Configuring GitOps with Argo CD<a class=headerlink href=#configuring-gitops-with-argo-cd title="Permanent link">&para;</a></h2> <p>You must have completed the <a href=/admin/artifactory-setup>Argo CD Setup</a> before continuing.</p> <p><strong>Terminology:</strong></p> <p>Argo CD uses a number of terms to refer to the components</p> <ul> <li> <p>Application - A deployable unit</p> <p>In the context of the Developer Environment, an application is one Helm chart that contains one container image that was produced by one CI pipeline. While Helm charts and images could certainly be combined to make more sophisticated applications in more advanced scenarios, we will be using this simple definition here.</p> </li> <li> <p>Project - A collection of applications that make up a solution</p> </li> </ul> <h3 id=set-up-the-gitops-repo>Set up the GitOps repo<a class=headerlink href=#set-up-the-gitops-repo title="Permanent link">&para;</a></h3> <p>Argo CD uses a Git repo to express the desired state of the Kubernetes environment. The basic setup uses one repository to represent one <a href=https://argoproj.github.io/argo-cd/user-guide/projects/ ><em>project</em></a>. Within that repository, each <a href=https://argoproj.github.io/argo-cd/operator-manual/declarative-setup/#applications><em>application</em></a> that makes up the project will be described in its own folder. The repository will also contain a branch for each destination (i.e. cluster and namespace) into which we want to deploy the applications.</p> <ol> <li> <p>Create a new repo from the <a href=https://github.com/IBM/template-argocd-gitops/generate>Argo CD Code Pattern</a></p> </li> <li> <p>Clone the project to your machine</p> </li> <li> <p>Create a branch for the environment (e.g. <code>test</code> to configure the values for deployment to the testing environment)</p> <div class=highlight><pre><span></span><code>git checkout -b <span class=nb>test</span>
</code></pre></div> </li> <li> <p>The repository contains a template Helm chart in the <code>app-artifactory</code> folder. Copy that folder and rename it to match one of the application names in your project, i.e. <code>{app repo}</code>.</p> </li> </ol> <p>The application name should match the repository name if the CI pipeline is going push changes to the CD pipeline.</p> <ol> <li> <p>Update <code>Chart.yaml</code></p> </li> <li> <p><code>name</code> - The name of the application, should match the folder from the previous step</p> </li> <li> <p>Update <code>requirements.yaml</code></p> <ul> <li><code>name</code> - The name of Helm chart and Docker image, should match your Git repo name, i.e. <code>{app repo}</code></li> <li><code>version</code> - The version number of the Helm chart, i.e. <code>{chart version}</code></li> <li> <p><code>repository</code> - The url to the Helm repository including the folder where the Helm charts are being stored, i.e. <code>http://artifactory.{ingress subdomain}/artifactory/generic-local/</code></p> <p>The url of the Helm repository in Artifactory can be determined by following the steps described in <a href=/admin/argocd-setup/#get-the-helm-repository-location>Administrator Guide - Argo CD setup</a>.</p> </li> </ul> </li> <li> <p>Update <code>values.yaml</code></p> <ul> <li>Replace <code>&lt;app-chart-name&gt;</code> with the name of application</li> <li>Provide configuration values specific to the Helm chart under the <code>&lt;app-chart-name&gt;</code> prefix</li> </ul> <p><strong>Note:</strong> The Helm values will need to be prefixed with the Helm chart name that was provided in the previous step. For example, assuming the helm chart is <code>message-logger</code>, the values.yaml file would look like the following: <div class=highlight><pre><span></span><code><span class=nt>message-logger</span><span class=p>:</span>
  <span class=nt>replicaCount</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
</code></pre></div> <strong>Note:</strong> The specific values that should be configured are dependent on the Helm chart that is referenced in the <code>requirements.yaml</code>. For the Code Patterns, you can see those details and customize the chart by looking in the <code>chart/{chart name}</code> of the repository.</p> </li> <li> <p>Repeat steps 4-7 for each application in the project</p> </li> </ol> <h3 id=register-the-git-repo-in-argo-cd>Register the git repo in Argo CD<a class=headerlink href=#register-the-git-repo-in-argo-cd title="Permanent link">&para;</a></h3> <p>Now that the repository has been created, we need to tell Argo CD where it is.</p> <ol> <li> <p>Get the Argo CD login information from the <code>igc credentials</code> CLI command</p> <p><strong>Note:</strong> You need to be logged into the cluster on the command-line for the CLI to access the cluster information.</p> </li> <li> <p>Log in to Argo CD</p> </li> <li> <p>Click on the gear icon on the left menu to access the Settings options</p> <p><img alt="Argo CD config" src=../../images/continuous-delivery/argocd-config.png></p> </li> <li> <p>Select the <code>Repositories</code> option</p> </li> <li> <p>Press either the Connect Repo using HTTPS or Connect Repo using SSH button at the top and provide the information for the Git repo</p> </li> </ol> <h3 id=create-a-project-in-argo-cd-optional>Create a project in Argo CD (Optional)<a class=headerlink href=#create-a-project-in-argo-cd-optional title="Permanent link">&para;</a></h3> <p>In Argo CD terms, each deployable component is an application and applications are grouped into projects. Projects are not required for Argo CD to be able to deploy applications, but it helps to organize applications and provide some restrictions on what can be done for applications that make up a project.</p> <p>To create a project:</p> <ol> <li> <p>Log into Argo CD</p> </li> <li> <p>Click on the gear icon on the left menu to access the Settings options</p> <p><img alt="Argo CD config" src=../../images/continuous-delivery/argocd-config.png></p> </li> <li> <p>Select the Projects option</p> </li> <li> <p>Press the New Project button at the top of the page</p> </li> <li> <p>Specify the properties for the new project</p> <ul> <li>name - Provide the name for the project</li> <li>description - A brief description of the project</li> <li>source - Press Add source and pick the Git repository from the list that was added previously</li> <li>destinations<ul> <li>Add <code>https://kubernetes.default.svc</code> for the cluster url and <code>test</code> for the namespace</li> <li>Add <code>https://kubernetes.default.svc</code> for the cluster url and <code>staging</code> for the namespace</li> </ul> </li> <li>Press Create</li> </ul> <p><strong>Note:</strong> Initially, the only cluster that is available is the one in which Argo CD is - <code>https://kubernetes.default.svc</code>. By adding the two destinations we have allowed the project to be deployed to both the <code>test</code> and <code>staging</code> namespaces within the current cluster.</p> </li> </ol> <h3 id=add-an-application-in-argo-cd-for-each-application-component-helm-chart>Add an application in Argo CD for each application component (Helm chart)<a class=headerlink href=#add-an-application-in-argo-cd-for-each-application-component-helm-chart title="Permanent link">&para;</a></h3> <p>The last step in the process is to define the application(s) within Argo CD that should be managed. This consists of connecting the config within the Git repo to the cluster and namespace.</p> <ol> <li> <p>Log into Argo CD</p> </li> <li> <p>Press <code>New Application</code> and provide the following values:</p> <ul> <li><code>application name</code> - The name of the application. It is recommend to use the format of <code>{namespace}-{image name}</code></li> <li><code>project</code> - The project with which the application should be included</li> <li><code>sync-policy</code> - The manner with which Argo CD will use to manage the deployed artifacts. <code>Automatic</code> is recommended</li> <li><code>repository url</code> - The Git url where the configuration is stored</li> <li><code>revision</code> - The branch where the configuration for this instance is stored</li> <li><code>path</code> - The path within the repository where the application config is located (should be the application name)</li> <li><code>destination cluster</code> - The cluster url for the deployment</li> <li><code>destination namespace</code> - The namespace where the application should be deployed</li> </ul> </li> <li> <p>Repeat that step for each application and each environment</p> </li> </ol> <h3 id=hook-the-ci-pipeline-to-the-cd-pipeline>Hook the CI pipeline to the CD pipeline<a class=headerlink href=#hook-the-ci-pipeline-to-the-cd-pipeline title="Permanent link">&para;</a></h3> <p>The last stage in the CI pipeline updates the version number in the <code>requirements.yaml</code> to the version of the helm chart that was just built. Through a couple naming conventions the only thing the pipeline needs in order to interact with the CD process is a Kubernetes secret named <code>gitops-cd-secret</code> that provides the details needed to connect to the git repo to push updates.</p> <p>Fortunately, a CLI command provides a simple way to create a Kubernetes secret that contains git credentials.</p> <p>Create the <code>gitops-cd-secret</code>:</p> <ol> <li> <p>Log into the cluster on the command-line.</p> </li> <li> <p>Change the directory to the root of the Argo CD Code Pattern repo that was cloned previously.</p> </li> <li> <p>Run <code>igc git-secret gitops-repo -n dev-{initials}</code> to create the secret. This command will prompt for the username, personal access token, and the branch to put in the secret.</p> </li> </ol> <h4 id=what-just-happened>What just happened?<a class=headerlink href=#what-just-happened title="Permanent link">&para;</a></h4> <p>The <code>git-secret</code> command creates a secret in a Kubernetes namespace containing the url, username, password, and branch information for a git repo. In the command above, we provided <code>gitops-cd-secret</code> for the secret name. (If that value is left off the secret name defaults to <code>{git org}.{git repo}</code>.) You can verify the secret was created by running:</p> <div class=highlight><pre><span></span><code>kubectl get secrets/gitops-cd-secret -n dev-<span class=o>{</span>initials<span class=o>}</span> -o yaml
</code></pre></div> <p><strong>Note:</strong></p> <ul> <li>For the secret to be available to the CI pipeline, the secret needs to be created in the same namespace where the pipeline is running (e.g. <code>dev-{initials}</code>).</li> <li>The value provided for <code>branch</code> is the one the pipeline will use to when committing changes to trigger the CD pipeline. <code>test</code> is the recommended value for the branch field.</li> </ul> </article> </div> </div> </main> <!-- Footer --> <footer class=md-footer> <!-- Further information --> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-column> <div class=md-footer-text><a href=https://develop.cloudnativetoolkit.dev/contribute/contribute/ >Contribute</a> to the Cloud-Native Toolkit</div> <div class=md-footer-text>Site licensed under <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ >CC BY-NC-SA 4.0</a></div> </div> <div class=md-footer-column> <div class=md-footer-text>Have questions? open an issue on <a href=https://github.com/cloud-native-toolkit/planning/issues/new/choose>GitHub</a>.</div> <!-- Copyright and theme information --> <div class=md-footer-text> Copyright Â© 2022 IBM </div> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["navigation.instant", "navigation.tracking"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.b0710199.min.js", "version": null}</script> <script src=../../assets/javascripts/bundle.76f349be.min.js></script> </body> </html>