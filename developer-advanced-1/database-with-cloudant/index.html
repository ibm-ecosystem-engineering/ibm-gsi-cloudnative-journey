<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="This Learning Journey enables cloud operators and developers to deliver cloud-native solutions with Red Hat OpenShift in hybrid cloud environments."><meta name=author content="Ecosystem Engineering"><link href=https://learning-journey.cloudnativetoolkit.dev/developer-advanced-1/database-with-cloudant/ rel=canonical><link rel=icon href=../../images/cloudnativetoolkit.png><meta name=generator content="mkdocs-1.3.1, mkdocs-material-8.4.1"><title>Database with Cloudant - TechZone Automation - Cloud-Native Learning Journey</title><link rel=stylesheet href=../../assets/stylesheets/main.69437709.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.cbb835fc.min.css><meta name=theme-color content=#000000><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans:300,300i,400,400i,700,700i%7CIBM+Plex+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"IBM Plex Sans";--md-code-font:"IBM Plex Mono"}</style><link rel=stylesheet href=../../css/extra.css><link rel=stylesheet href=../../css/toolkit-code.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-155887541-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){if(document.forms.search&&document.forms.search.query.addEventListener("blur",function(){var e;this.value&&(e=document.location.pathname,ga("send","pageview",e+"?q="+this.value))}),document.forms.feedback){var e,a=document.forms.feedback;for(e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");ga("send","event","feedback","click",t,e),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}"undefined"!=typeof location$&&location$.subscribe(function(e){ga("send","pageview",e.pathname)})});var e=document.createElement("script");e.async=!0,e.src="https://www.google-analytics.com/analytics.js",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script><!-- Determine title --><!-- The image needs to have an absolute URL --><!-- Open graph meta tags --><meta property=og:type content=website><meta property=og:title content="TechZone Automation - Cloud-Native Learning Journey - Database with Cloudant"><meta property=og:description content="This Learning Journey enables cloud operators and developers to deliver cloud-native solutions with Red Hat OpenShift in hybrid cloud environments."><meta content=https://learning-journey.cloudnativetoolkit.dev/developer-advanced-1/database-with-cloudant/ property=og:url><meta property=og:image content=https://learning-journey.cloudnativetoolkit.dev/assets/images/banner.png><meta property=og:image:type content=image/png><meta property=og:image:width content=1080><meta property=og:image:height content=568></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=black data-md-color-accent> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#add-a-cloudant-integration-to-your-backend-service class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="TechZone Automation - Cloud-Native Learning Journey" class="md-header__button md-logo" aria-label="TechZone Automation - Cloud-Native Learning Journey" data-md-component=logo> <img src=../../images/cloudnativetoolkit.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> TechZone Automation - Cloud-Native Learning Journey </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Database with Cloudant </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/ibm-ecosystem-lab/ibm-gsi-cloudnative-journey title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <!-- Determine class according to configuration --> <!-- Main navigation --> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <!-- Site title --> <!--
  <label class="md-nav__title" for="__drawer">
    <a
      href="../.."
      title="TechZone Automation - Cloud-Native Learning Journey"
      class="md-nav__button md-logo"
      aria-label="TechZone Automation - Cloud-Native Learning Journey"
      data-md-component="logo"
    >
      
  <img src="../../images/cloudnativetoolkit.png" alt="logo">

    </a>
    TechZone Automation - Cloud-Native Learning Journey
  </label>
--> <!-- Repository information --> <div class=md-nav__source> <a href=https://github.com/ibm-ecosystem-lab/ibm-gsi-cloudnative-journey title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> </div> </a> </div> <!-- Render item list --> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1 type=checkbox id=__nav_1> <label class=md-nav__link for=__nav_1> Introduction <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Introduction data-md-level=1> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> Introduction </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../getting-started/ class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=../../getting-started/prereqs/ class=md-nav__link> Prerequisites </a> </li> <li class=md-nav__item> <a href=../../getting-started/checksetup/ class=md-nav__link> Validate Environment </a> </li> <li class=md-nav__item> <a href=../../getting-started/devenvsetup/ class=md-nav__link> Developer Tools Setup </a> </li> <li class=md-nav__item> <a href=../../getting-started/cli/ class=md-nav__link> Developer Tools CLI </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2> Developer Foundation <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Developer Foundation" data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Developer Foundation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../developer-foundation/ class=md-nav__link> Agenda </a> </li> <li class=md-nav__item> <a href=../../developer-foundation/cloud-native-overview/ class=md-nav__link> What is Cloud-Native? </a> </li> <li class=md-nav__item> <a href=../../developer-foundation/cloud-native-app-dev/ class=md-nav__link> Cloud-Native App Dev </a> </li> <li class=md-nav__item> <a href=../../developer-foundation/containers/ class=md-nav__link> Containers Overview </a> </li> <li class=md-nav__item> <a href=../../developer-foundation/k8s-overview/ class=md-nav__link> Kubernetes 'overview' </a> </li> <li class=md-nav__item> <a href=../../developer-foundation/openshift/ class=md-nav__link> Openshift 'overview' </a> </li> <li class=md-nav__item> <a href=../../developer-foundation/k8s-core-concepts/ class=md-nav__link> Core Concepts </a> </li> <li class=md-nav__item> <a href=../../developer-foundation/k8s-configuration/ class=md-nav__link> Configuration </a> </li> <li class=md-nav__item> <a href=../../developer-foundation/k8s-multi-container-pods/ class=md-nav__link> Multi-Container Pods </a> </li> <li class=md-nav__item> <a href=../../developer-foundation/k8s-observability/ class=md-nav__link> Observability </a> </li> <li class=md-nav__item> <a href=../../developer-foundation/k8s-pod-design/ class=md-nav__link> Pod Design </a> </li> <li class=md-nav__item> <a href=../../developer-foundation/k8s-services-networking/ class=md-nav__link> Services & Networking </a> </li> <li class=md-nav__item> <a href=../../developer-foundation/k8s-state-persistence/ class=md-nav__link> State Persistence </a> </li> <li class=md-nav__item> <a href=../../developer-foundation/k8s-troubleshooting/ class=md-nav__link> Troubleshoot </a> </li> <li class=md-nav__item> <a href=../../developer-foundation/garage-development/ class=md-nav__link> Garage Method </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3> Developer Intermediate <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Developer Intermediate" data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Developer Intermediate </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../developer-intermediate/ class=md-nav__link> Agenda </a> </li> <li class=md-nav__item> <a href=../../developer-intermediate/deploy-app/ class=md-nav__link> Deploy First App </a> </li> <li class=md-nav__item> <a href=../../developer-intermediate/continuous-delivery/ class=md-nav__link> Continuous Delivery </a> </li> <li class=md-nav__item> <a href=../../developer-intermediate/content-overview/ class=md-nav__link> DevSecOps Overview </a> </li> <li class=md-nav__item> <a href=../../developer-intermediate/continuous-integration/ class=md-nav__link> Continuous Integration </a> </li> <li class=md-nav__item> <a href=../../developer-intermediate/artifact-management/ class=md-nav__link> Artifact Management </a> </li> <li class=md-nav__item> <a href=../../developer-intermediate/code-analysis/ class=md-nav__link> Code Analysis </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_8 type=checkbox id=__nav_3_8> <label class=md-nav__link for=__nav_3_8> Image Registry <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Image Registry" data-md-level=2> <label class=md-nav__title for=__nav_3_8> <span class="md-nav__icon md-icon"></span> Image Registry </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../developer-intermediate/ocp-registry/ class=md-nav__link> OpenShift </a> </li> <li class=md-nav__item> <a href=../../developer-intermediate/image-registry/ class=md-nav__link> IBM Cloud </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_9 type=checkbox id=__nav_3_9> <label class=md-nav__link for=__nav_3_9> Log Management <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Log Management" data-md-level=2> <label class=md-nav__title for=__nav_3_9> <span class="md-nav__icon md-icon"></span> Log Management </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../developer-intermediate/log-management/ class=md-nav__link> OpenShift </a> </li> <li class=md-nav__item> <a href=../../developer-intermediate/log-management/ class=md-nav__link> IBM Cloud </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_10 type=checkbox id=__nav_3_10> <label class=md-nav__link for=__nav_3_10> Monitoring <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Monitoring data-md-level=2> <label class=md-nav__title for=__nav_3_10> <span class="md-nav__icon md-icon"></span> Monitoring </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../developer-intermediate/ocp-monitoring/ class=md-nav__link> OpenShift </a> </li> <li class=md-nav__item> <a href=../../developer-intermediate/monitoring/ class=md-nav__link> IBM Cloud </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_11 type=checkbox id=__nav_3_11> <label class=md-nav__link for=__nav_3_11> Inventory App <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Inventory App" data-md-level=2> <label class=md-nav__title for=__nav_3_11> <span class="md-nav__icon md-icon"></span> Inventory App </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../developer-intermediate/inventory-application/ class=md-nav__link> Intro </a> </li> <li class=md-nav__item> <a href=../../developer-intermediate/inventory-prebuilt-solution/ class=md-nav__link> Solution </a> </li> <li class=md-nav__item> <a href=../../developer-intermediate/inventory-service/ class=md-nav__link> Service </a> </li> <li class=md-nav__item> <a href=../../developer-intermediate/inventory-bff/ class=md-nav__link> BFF </a> </li> <li class=md-nav__item> <a href=../../developer-intermediate/inventory-ui/ class=md-nav__link> UI </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 type=checkbox id=__nav_4 checked> <label class=md-nav__link for=__nav_4> Developer Advanced <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Developer Advanced" data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Developer Advanced </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../inventory-cd/ class=md-nav__link> CD for Inventory App </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Database with Cloudant <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Database with Cloudant </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#add-a-cloudant-integration-to-your-backend-service class=md-nav__link> Add a Cloudant integration to your backend service </a> </li> <li class=md-nav__item> <a href=#enable-database-in-the-solution class=md-nav__link> Enable database in the solution </a> <nav class=md-nav aria-label="Enable database in the solution"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#set-up-local-development class=md-nav__link> Set up local development </a> </li> <li class=md-nav__item> <a href=#activate-the-cloudant-service-implementation class=md-nav__link> Activate the Cloudant service implementation </a> </li> <li class=md-nav__item> <a href=#update-the-stockitemservice-implementation class=md-nav__link> Update the StockItemService implementation </a> </li> <li class=md-nav__item> <a href=#update-the-stockitem-model class=md-nav__link> Update the StockItem model </a> </li> <li class=md-nav__item> <a href=#update-the-stockitem-controller class=md-nav__link> Update the StockItem controller </a> </li> <li class=md-nav__item> <a href=#update-the-configuration-values-in-the-valuesyaml-helm-chart class=md-nav__link> Update the configuration values in the values.yaml helm chart </a> </li> <li class=md-nav__item> <a href=#add-a-cloudant-integration-to-your-backend-service_1 class=md-nav__link> Add a Cloudant integration to your backend service </a> </li> <li class=md-nav__item> <a href=#update-the-gradle-config-to-include-cloudant-dependencies class=md-nav__link> Update the gradle config to include cloudant dependencies </a> </li> <li class=md-nav__item> <a href=#configuration-values class=md-nav__link> Configuration values </a> </li> <li class=md-nav__item> <a href=#service-implementation class=md-nav__link> Service Implementation </a> </li> <li class=md-nav__item> <a href=#running-the-application-locally class=md-nav__link> Running the application locally </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../database-with-mongodb/ class=md-nav__link> Database with MongoDB </a> </li> <li class=md-nav__item> <a href=../inventory-appid/ class=md-nav__link> Authentication with AppID </a> </li> <li class=md-nav__item> <a href=../code-engine/ class=md-nav__link> Code Engine </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#add-a-cloudant-integration-to-your-backend-service class=md-nav__link> Add a Cloudant integration to your backend service </a> </li> <li class=md-nav__item> <a href=#enable-database-in-the-solution class=md-nav__link> Enable database in the solution </a> <nav class=md-nav aria-label="Enable database in the solution"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#set-up-local-development class=md-nav__link> Set up local development </a> </li> <li class=md-nav__item> <a href=#activate-the-cloudant-service-implementation class=md-nav__link> Activate the Cloudant service implementation </a> </li> <li class=md-nav__item> <a href=#update-the-stockitemservice-implementation class=md-nav__link> Update the StockItemService implementation </a> </li> <li class=md-nav__item> <a href=#update-the-stockitem-model class=md-nav__link> Update the StockItem model </a> </li> <li class=md-nav__item> <a href=#update-the-stockitem-controller class=md-nav__link> Update the StockItem controller </a> </li> <li class=md-nav__item> <a href=#update-the-configuration-values-in-the-valuesyaml-helm-chart class=md-nav__link> Update the configuration values in the values.yaml helm chart </a> </li> <li class=md-nav__item> <a href=#add-a-cloudant-integration-to-your-backend-service_1 class=md-nav__link> Add a Cloudant integration to your backend service </a> </li> <li class=md-nav__item> <a href=#update-the-gradle-config-to-include-cloudant-dependencies class=md-nav__link> Update the gradle config to include cloudant dependencies </a> </li> <li class=md-nav__item> <a href=#configuration-values class=md-nav__link> Configuration values </a> </li> <li class=md-nav__item> <a href=#service-implementation class=md-nav__link> Service Implementation </a> </li> <li class=md-nav__item> <a href=#running-the-application-locally class=md-nav__link> Running the application locally </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/ibm-ecosystem-lab/ibm-gsi-cloudnative-journey/edit/main/docs/developer-advanced-1/database-with-cloudant/index.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg> </a> <h1>Database with Cloudant</h1> <!--- cSpell:ignore dataload cloudantcredentials apikey classname gradlew viewapp cloudantgitpodscreen crwopenlink crwopenapp --> <h2 id=add-a-cloudant-integration-to-your-backend-service>Add a Cloudant integration to your backend service<a class=headerlink href=#add-a-cloudant-integration-to-your-backend-service title="Permanent link">&para;</a></h2> <ul> <li> <p>While logged into the IBM Cloud account use the resource list to find your pre installed Cloudant database instance name after your development cluster.</p> </li> <li> <p>Open the database instance dashboard.</p> </li> <li> <p>Click on the Service Credentials on the left-hand menu.</p> </li> <li> <p>You will see the credentials for the database which will be something like this: <img alt="Service Credentials" src=images/cloudantcredentials.png></p> </li> <li> <p>Open a terminal window folder/directory called <code>data</code> <div class=highlight><pre><span></span><code>mkdir data
</code></pre></div></p> </li> <li> <p>To help create test JSON data we are going to supply a template to the JSON Generator tool, this helps when creating dummy data for testing. Navigate to the following link <a href=https://www.json-generator.com/ >https://www.json-generator.com/</a></p> </li> <li> <p>Replace the default template with the following template (using cut and paste). This will enable a 100 records of test data to be created to represent a products database. Click on the <em>Generate</em> button. <div class=highlight><pre><span></span><code><span class=o>{</span>
  docs: <span class=o>[</span>
    <span class=s1>&#39;{{repeat(100)}}&#39;</span>,
    <span class=o>{</span>
      _id: <span class=s1>&#39;{{objectId()}}&#39;</span>,
      manufacturer: <span class=s1>&#39;{{company().toUpperCase()}}&#39;</span>,
      name:  <span class=s1>&#39;{{lorem(3, &quot;words&quot;)}}&#39;</span>,
      price: <span class=s1>&#39;{{floating(10, 1000, 2, &quot;0.00&quot;)}}&#39;</span>,
      stock: <span class=s1>&#39;{{integer(1, 100)}}&#39;</span>
    <span class=o>}</span>
  <span class=o>]</span>
<span class=o>}</span>
</code></pre></div></p> </li> <li> <p>Copy the generated contents on the right hand side into a file called <code>inventory.json</code> and save it into the same folder.</p> </li> <li> <p>Download the <code>dataload.sh</code> script from the Iteration Zero repository using the following command: <div class=highlight><pre><span></span><code>curl https://raw.githubusercontent.com/ibm-garage-cloud/ibm-garage-iteration-zero/master/terraform/scripts/dataload.sh &gt;&gt; dataload.sh
</code></pre></div></p> </li> <li>Add the <code>username</code> and <code>apikey</code> to <code>CLOUDANT_USERNAME</code> and <code>CLOUDANT_API_KEY</code> variables in the <code>dataload.sh</code> script. You can get the credentials from the Cloudant credentials view in the IBM Cloud console.</li> <li>Add <code>DATABASE</code> value to be <code>inventory-&lt;replace with namespace&gt;</code> using the dev namespace/project name you have been using.</li> <li>Save the script, make it executable, and then run it by passing in the filename</li> <li>Before running this script,make sure you have <code>jq</code> installed. <div class=highlight><pre><span></span><code>chmod +x ./dataload.sh
./dataload.sh inventory.json
</code></pre></div></li> <li>The data from the <code>inventory.json</code> file will then be used to populate the database, to confirm this on the Dashboard click on Manage menu on the left and then Launch button to see the Cloudant dashboard.</li> <li>Click on the Left icon that looks like a Database and you will see the <code>inventory-&lt;namespace&gt;</code> database created.</li> <li>Click on the <code>inventory</code> database, then click <strong>Table</strong> view.</li> <li> <p>You can see the rows of data <img alt=Database src=images/database.png></p> </li> <li> <p>If you click on a row of data, you will see the raw NoSQL form of the data record.</p> </li> <li>This completes the setup of the database and populating it with data.</li> </ul> <h2 id=enable-database-in-the-solution>Enable database in the solution<a class=headerlink href=#enable-database-in-the-solution title="Permanent link">&para;</a></h2> <p>If you are starting from the solution, use the following steps to enable the Cloudant database</p> <h3 id=set-up-local-development>Set up local development<a class=headerlink href=#set-up-local-development title="Permanent link">&para;</a></h3> <ul> <li> <p>Open the mappings.json file under src/main/resources and add a <code>DATABASE_NAME</code> value with the value <code>inventory-{namespace}</code> where <code>namespace</code> is the namespace where the pipeline is running (e.g. dev-{initials}) <div class=highlight><span class=filename>src/main/resources/mappings.json</span><pre><span></span><code><span class=p>{</span><span class=w></span>
<span class=w>  </span><span class=nt>&quot;DATABASE_NAME&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;inventory-{namespace}&quot;</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div></p> </li> <li> <p>Log into cloud.ibm.com and open the Cloudant service from the resource list</p> </li> <li> <p>Click on service credentials Tab.</p> </li> <li> <p>In service credentials, click on "New credential" button.</p> </li> <li> <p>Select the role "Manager"</p> </li> </ul> <p><img alt="Manager Service Credentials" src=images/Cloudant-Service-Credentials.png></p> <ul> <li> <p>Navigate to your namespace where you are running the inventory solution pipeline and create the binding secret for the Cloudant instance on the cloud account <div class=highlight><pre><span></span><code>   oc project <span class=o>[</span>proj_name<span class=o>]</span>
   ibmcloud oc cluster service <span class=nb>bind</span> --cluster workshop-team-one 
   --namespace <span class=o>[</span>YOUR-NAMESPACE<span class=o>]</span> --service workshop-cldn-one
</code></pre></div></p> </li> <li> <p>The application needs a user with "manager" iam_role whereas the binding secret creates a user with "writer" iam_role resulting in "access denied" issues.</p> </li> <li> <p>Hence, the "binding" key in binding secret you just created needs to be replaced with the values of "manager" role user you created in Service Credentials on cloud.ibm.com.</p> </li> <li> <p>Copy the json contents from the credentials into <code>mappings.json</code> under the <code>CLOUDANT_CONFIG</code> object (note that CLOUDANT_CONFIG value must be a string type not a json type, so you must use escaping characters for this value). You could a JSON to String converting tool. <div class=highlight><span class=filename>src/main/resources/mappings.json</span><pre><span></span><code><span class=p>{</span><span class=w></span>
<span class=w>  </span><span class=nt>&quot;DATABASE_NAME&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;inventory-{namespace}&quot;</span><span class=p>,</span><span class=w></span>
<span class=w>  </span><span class=nt>&quot;CLOUDANT_CONFIG&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;{paste json here}&quot;</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div></p> </li> </ul> <h3 id=activate-the-cloudant-service-implementation>Activate the Cloudant service implementation<a class=headerlink href=#activate-the-cloudant-service-implementation title="Permanent link">&para;</a></h3> <ul> <li> <p>Create a new file <code>src/main/java/com/ibm/inventory_management/services/StockItemMockService.java</code>.</p> </li> <li> <p>Copy the contents of <code>src/main/java/com/ibm/inventory_management/services/StockItemService.java</code> in this newly created <code>StockItemMockService.java</code> file.</p> </li> <li> <p>Do the following changes after copying the contents of StockItemService.java to this new file:</p> <ol> <li>Remove the <code>@Primary</code> annotation.</li> <li>Change the classname from StockItemService to StockItemMockService</li> </ol> </li> <li> <p>Open <code>src/main/java/com/ibm/inventory_management/services/StockItemApi.java</code> and add the following code to the file. The file should look like the following <div class=highlight><span class=filename>src/main/java/com/ibm/inventory_management/services/StockItemApi.java</span><pre><span></span><code><span class=kn>package</span><span class=w> </span><span class=nn>com.ibm.inventory_management.services</span><span class=p>;</span><span class=w></span>

<span class=kn>import</span><span class=w> </span><span class=nn>java.util.List</span><span class=p>;</span><span class=w></span>

<span class=kn>import</span><span class=w> </span><span class=nn>com.ibm.inventory_management.models.StockItem</span><span class=p>;</span><span class=w></span>

<span class=kd>public</span><span class=w> </span><span class=kd>interface</span> <span class=nc>StockItemApi</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>  </span><span class=n>List</span><span class=o>&lt;</span><span class=n>StockItem</span><span class=o>&gt;</span><span class=w> </span><span class=nf>listStockItems</span><span class=p>()</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=p>;</span><span class=w></span>

<span class=w>  </span><span class=kt>void</span><span class=w> </span><span class=nf>addStockItem</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>Double</span><span class=w> </span><span class=n>price</span><span class=p>,</span><span class=w> </span><span class=n>Integer</span><span class=w> </span><span class=n>stock</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>manufacturer</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=p>;</span><span class=w></span>

<span class=w>  </span><span class=kt>void</span><span class=w> </span><span class=nf>updateStockItem</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>Double</span><span class=w> </span><span class=n>price</span><span class=p>,</span><span class=w> </span><span class=n>Integer</span><span class=w> </span><span class=n>stock</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>manufacturer</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=p>;</span><span class=w></span>

<span class=w>  </span><span class=kt>void</span><span class=w> </span><span class=nf>deleteStockItem</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>id</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=p>;</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div></p> </li> </ul> <h3 id=update-the-stockitemservice-implementation>Update the StockItemService implementation<a class=headerlink href=#update-the-stockitemservice-implementation title="Permanent link">&para;</a></h3> <div class=highlight><span class=filename>src/main/java/com/ibm/inventory_management/services/StockItemService.java</span><pre><span></span><code><span class=kn>package</span><span class=w> </span><span class=nn>com.ibm.inventory_management.services</span><span class=p>;</span><span class=w></span>

<span class=kn>import</span><span class=w> </span><span class=nn>java.io.IOException</span><span class=p>;</span><span class=w></span>
<span class=kn>import</span><span class=w> </span><span class=nn>java.util.List</span><span class=p>;</span><span class=w></span>
<span class=kn>import</span><span class=w> </span><span class=nn>javax.annotation.PostConstruct</span><span class=p>;</span><span class=w></span>
<span class=kn>import</span><span class=w> </span><span class=nn>java.net.URL</span><span class=p>;</span><span class=w></span>
<span class=kn>import</span><span class=w> </span><span class=nn>java.net.MalformedURLException</span><span class=p>;</span><span class=w></span>
<span class=kn>import</span><span class=w> </span><span class=nn>java.util.UUID</span><span class=p>;</span><span class=w></span>

<span class=kn>import</span><span class=w> </span><span class=nn>com.cloudant.client.api.CloudantClient</span><span class=p>;</span><span class=w></span>
<span class=kn>import</span><span class=w> </span><span class=nn>com.cloudant.client.api.ClientBuilder</span><span class=p>;</span><span class=w></span>
<span class=kn>import</span><span class=w> </span><span class=nn>com.cloudant.client.api.Database</span><span class=p>;</span><span class=w></span>
<span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.context.annotation.Primary</span><span class=p>;</span><span class=w></span>
<span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.context.annotation.Bean</span><span class=p>;</span><span class=w></span>
<span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.context.annotation.Lazy</span><span class=p>;</span><span class=w></span>
<span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.stereotype.Service</span><span class=p>;</span><span class=w></span>
<span class=kn>import</span><span class=w> </span><span class=nn>com.ibm.inventory_management.config.CloudantConfig</span><span class=p>;</span><span class=w></span>
<span class=kn>import</span><span class=w> </span><span class=nn>com.ibm.inventory_management.models.StockItem</span><span class=p>;</span><span class=w></span>

<span class=nd>@Service</span><span class=w></span>
<span class=nd>@Primary</span><span class=w></span>
<span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>StockItemService</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>StockItemApi</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>  </span><span class=nd>@Bean</span><span class=w></span>
<span class=w>  </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>CloudantClient</span><span class=w> </span><span class=nf>buildCloudant</span><span class=p>(</span><span class=n>CloudantConfig</span><span class=w> </span><span class=n>config</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>CloudServicesException</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;Config: &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>config</span><span class=p>);</span><span class=w></span>
<span class=w>    </span><span class=n>URL</span><span class=w> </span><span class=n>url</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>null</span><span class=p>;</span><span class=w></span>

<span class=w>    </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>      </span><span class=n>url</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>URL</span><span class=p>(</span><span class=n>config</span><span class=p>.</span><span class=na>getUrl</span><span class=p>());</span><span class=w></span>
<span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>MalformedURLException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>      </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>CloudServicesException</span><span class=p>(</span><span class=s>&quot;Invalid service URL specified&quot;</span><span class=p>,</span><span class=w> </span><span class=n>e</span><span class=p>);</span><span class=w></span>
<span class=w>    </span><span class=p>}</span><span class=w></span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>ClientBuilder</span><span class=w></span>
<span class=w>        </span><span class=p>.</span><span class=na>url</span><span class=p>(</span><span class=n>url</span><span class=p>)</span><span class=w></span>
<span class=w>        </span><span class=p>.</span><span class=na>iamApiKey</span><span class=p>(</span><span class=n>config</span><span class=p>.</span><span class=na>getApiKey</span><span class=p>())</span><span class=w></span>
<span class=w>        </span><span class=c1>// .username(config.getUsername())</span><span class=w></span>
<span class=w>        </span><span class=c1>// .iamApiKey(config.getPassword())</span><span class=w></span>
<span class=w>        </span><span class=p>.</span><span class=na>build</span><span class=p>();</span><span class=w></span>
<span class=w>  </span><span class=p>}</span><span class=w></span>

<span class=w>  </span><span class=kd>private</span><span class=w> </span><span class=n>CloudantConfig</span><span class=w> </span><span class=n>config</span><span class=p>;</span><span class=w></span>
<span class=w>  </span><span class=kd>private</span><span class=w> </span><span class=n>CloudantClient</span><span class=w> </span><span class=n>client</span><span class=p>;</span><span class=w></span>
<span class=w>  </span><span class=kd>private</span><span class=w> </span><span class=n>Database</span><span class=w> </span><span class=n>db</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>null</span><span class=p>;</span><span class=w></span>

<span class=w>  </span><span class=kd>public</span><span class=w> </span><span class=nf>StockItemService</span><span class=p>(</span><span class=n>CloudantConfig</span><span class=w> </span><span class=n>config</span><span class=p>,</span><span class=w> </span><span class=nd>@Lazy</span><span class=w> </span><span class=n>CloudantClient</span><span class=w> </span><span class=n>client</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=k>this</span><span class=p>.</span><span class=na>config</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>config</span><span class=p>;</span><span class=w></span>
<span class=w>    </span><span class=k>this</span><span class=p>.</span><span class=na>client</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>client</span><span class=p>;</span><span class=w></span>
<span class=w>  </span><span class=p>}</span><span class=w></span>

<span class=w>  </span><span class=nd>@PostConstruct</span><span class=w></span>
<span class=w>  </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>init</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=n>db</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>client</span><span class=p>.</span><span class=na>database</span><span class=p>(</span><span class=n>config</span><span class=p>.</span><span class=na>getDatabaseName</span><span class=p>(),</span><span class=w> </span><span class=kc>true</span><span class=p>);</span><span class=w></span>
<span class=w>  </span><span class=p>}</span><span class=w></span>

<span class=w>  </span><span class=nd>@Override</span><span class=w></span>
<span class=w>  </span><span class=kd>public</span><span class=w> </span><span class=n>List</span><span class=o>&lt;</span><span class=n>StockItem</span><span class=o>&gt;</span><span class=w> </span><span class=nf>listStockItems</span><span class=p>()</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w></span>

<span class=w>    </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>      </span><span class=k>return</span><span class=w> </span><span class=n>db</span><span class=p>.</span><span class=na>getAllDocsRequestBuilder</span><span class=p>()</span><span class=w></span>
<span class=w>          </span><span class=p>.</span><span class=na>includeDocs</span><span class=p>(</span><span class=kc>true</span><span class=p>)</span><span class=w></span>
<span class=w>          </span><span class=p>.</span><span class=na>build</span><span class=p>()</span><span class=w></span>
<span class=w>          </span><span class=p>.</span><span class=na>getResponse</span><span class=p>()</span><span class=w></span>
<span class=w>          </span><span class=p>.</span><span class=na>getDocsAs</span><span class=p>(</span><span class=n>StockItem</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w></span>

<span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>IOException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>      </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Exception</span><span class=p>(</span><span class=s>&quot;&quot;</span><span class=p>,</span><span class=w> </span><span class=n>e</span><span class=p>);</span><span class=w></span>
<span class=w>    </span><span class=p>}</span><span class=w></span>
<span class=w>  </span><span class=p>}</span><span class=w></span>

<span class=w>  </span><span class=nd>@Override</span><span class=w></span>
<span class=w>  </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>addStockItem</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>Double</span><span class=w> </span><span class=n>price</span><span class=p>,</span><span class=w> </span><span class=n>Integer</span><span class=w> </span><span class=n>stock</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>manufacturer</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>      </span><span class=n>db</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>StockItem</span><span class=p>(</span><span class=n>UUID</span><span class=p>.</span><span class=na>randomUUID</span><span class=p>().</span><span class=na>toString</span><span class=p>())</span><span class=w></span>
<span class=w>              </span><span class=p>.</span><span class=na>withName</span><span class=p>(</span><span class=n>name</span><span class=p>)</span><span class=w></span>
<span class=w>              </span><span class=p>.</span><span class=na>withPrice</span><span class=p>(</span><span class=n>price</span><span class=p>)</span><span class=w></span>
<span class=w>              </span><span class=p>.</span><span class=na>withStock</span><span class=p>(</span><span class=n>stock</span><span class=p>)</span><span class=w></span>
<span class=w>              </span><span class=p>.</span><span class=na>withManufacturer</span><span class=p>(</span><span class=n>manufacturer</span><span class=p>)</span><span class=w></span>
<span class=w>      </span><span class=p>);</span><span class=w></span>
<span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>      </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Exception</span><span class=p>(</span><span class=s>&quot;&quot;</span><span class=p>,</span><span class=n>e</span><span class=p>);</span><span class=w></span>
<span class=w>    </span><span class=p>}</span><span class=w></span>
<span class=w>  </span><span class=p>}</span><span class=w></span>

<span class=w>  </span><span class=nd>@Override</span><span class=w></span>
<span class=w>  </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>updateStockItem</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>Double</span><span class=w> </span><span class=n>price</span><span class=p>,</span><span class=w> </span><span class=n>Integer</span><span class=w> </span><span class=n>stock</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>manufacturer</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>      </span><span class=n>StockItem</span><span class=w> </span><span class=n>itemToUpdate</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>db</span><span class=p>.</span><span class=na>find</span><span class=p>(</span><span class=n>StockItem</span><span class=p>.</span><span class=na>class</span><span class=p>,</span><span class=n>id</span><span class=p>);</span><span class=w></span>

<span class=w>      </span><span class=n>itemToUpdate</span><span class=p>.</span><span class=na>setName</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>!=</span><span class=kc>null</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>itemToUpdate</span><span class=p>.</span><span class=na>getName</span><span class=p>());</span><span class=w></span>
<span class=w>      </span><span class=n>itemToUpdate</span><span class=p>.</span><span class=na>setManufacturer</span><span class=p>(</span><span class=n>manufacturer</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=n>manufacturer</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>itemToUpdate</span><span class=p>.</span><span class=na>getManufacturer</span><span class=p>());</span><span class=w></span>
<span class=w>      </span><span class=n>itemToUpdate</span><span class=p>.</span><span class=na>setPrice</span><span class=p>(</span><span class=n>price</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=n>price</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>itemToUpdate</span><span class=p>.</span><span class=na>getPrice</span><span class=p>());</span><span class=w></span>
<span class=w>      </span><span class=n>itemToUpdate</span><span class=p>.</span><span class=na>setStock</span><span class=p>(</span><span class=n>stock</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=n>stock</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>itemToUpdate</span><span class=p>.</span><span class=na>getStock</span><span class=p>());</span><span class=w></span>

<span class=w>      </span><span class=n>db</span><span class=p>.</span><span class=na>update</span><span class=p>(</span><span class=n>itemToUpdate</span><span class=p>);</span><span class=w></span>
<span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=w> </span><span class=p>){</span><span class=w></span>
<span class=w>      </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Exception</span><span class=p>(</span><span class=s>&quot;&quot;</span><span class=p>,</span><span class=w> </span><span class=n>e</span><span class=p>);</span><span class=w></span>
<span class=w>    </span><span class=p>}</span><span class=w></span>
<span class=w>  </span><span class=p>}</span><span class=w></span>

<span class=w>  </span><span class=nd>@Override</span><span class=w></span>
<span class=w>  </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>deleteStockItem</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>id</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>      </span><span class=n>db</span><span class=p>.</span><span class=na>remove</span><span class=p>(</span><span class=n>db</span><span class=p>.</span><span class=na>find</span><span class=p>(</span><span class=n>StockItem</span><span class=p>.</span><span class=na>class</span><span class=p>,</span><span class=n>id</span><span class=p>));</span><span class=w></span>
<span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>){</span><span class=w></span>
<span class=w>      </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Exception</span><span class=p>(</span><span class=s>&quot;&quot;</span><span class=p>,</span><span class=n>e</span><span class=p>);</span><span class=w></span>
<span class=w>    </span><span class=p>}</span><span class=w></span>
<span class=w>  </span><span class=p>}</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div> <h3 id=update-the-stockitem-model>Update the StockItem model<a class=headerlink href=#update-the-stockitem-model title="Permanent link">&para;</a></h3> <div class=highlight><span class=filename>src/main/java/com/ibm/inventory_management/models/StockItem.java</span><pre><span></span><code><span class=kn>package</span><span class=w> </span><span class=nn>com.ibm.inventory_management.models</span><span class=p>;</span><span class=w></span>

<span class=kn>import</span><span class=w> </span><span class=nn>java.io.Serializable</span><span class=p>;</span><span class=w></span>

<span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>StockItem</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>Serializable</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>  </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>name</span><span class=p>;</span><span class=w></span>
<span class=w>  </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>null</span><span class=p>;</span><span class=w></span>

<span class=w>  </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>_rev</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>null</span><span class=p>;</span><span class=w></span>
<span class=w>  </span><span class=kd>private</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>stock</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w></span>
<span class=w>  </span><span class=kd>private</span><span class=w> </span><span class=kt>double</span><span class=w> </span><span class=n>price</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>0.0</span><span class=p>;</span><span class=w></span>
<span class=w>  </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>manufacturer</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;&quot;</span><span class=p>;</span><span class=w></span>

<span class=w>  </span><span class=kd>public</span><span class=w> </span><span class=nf>StockItem</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=kd>super</span><span class=p>();</span><span class=w></span>
<span class=w>  </span><span class=p>}</span><span class=w></span>

<span class=w>  </span><span class=kd>public</span><span class=w> </span><span class=nf>StockItem</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>id</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=k>this</span><span class=p>.</span><span class=na>_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>id</span><span class=p>;</span><span class=w></span>
<span class=w>  </span><span class=p>}</span><span class=w></span>

<span class=w>  </span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>getName</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>name</span><span class=p>;</span><span class=w></span>
<span class=w>  </span><span class=p>}</span><span class=w></span>

<span class=w>  </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>setName</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>name</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=k>this</span><span class=p>.</span><span class=na>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>name</span><span class=p>;</span><span class=w></span>
<span class=w>  </span><span class=p>}</span><span class=w></span>

<span class=w>  </span><span class=kd>public</span><span class=w> </span><span class=n>StockItem</span><span class=w> </span><span class=nf>withName</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>name</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=k>this</span><span class=p>.</span><span class=na>setName</span><span class=p>(</span><span class=n>name</span><span class=p>);</span><span class=w></span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=k>this</span><span class=p>;</span><span class=w></span>
<span class=w>  </span><span class=p>}</span><span class=w></span>

<span class=w>  </span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>getId</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>_id</span><span class=p>;</span><span class=w></span>
<span class=w>  </span><span class=p>}</span><span class=w></span>

<span class=w>  </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>setId</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>id</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=k>this</span><span class=p>.</span><span class=na>_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>id</span><span class=p>;</span><span class=w></span>
<span class=w>  </span><span class=p>}</span><span class=w></span>

<span class=w>  </span><span class=kd>public</span><span class=w> </span><span class=n>StockItem</span><span class=w> </span><span class=nf>withId</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>id</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=k>this</span><span class=p>.</span><span class=na>setId</span><span class=p>(</span><span class=n>id</span><span class=p>);</span><span class=w></span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=k>this</span><span class=p>;</span><span class=w></span>
<span class=w>  </span><span class=p>}</span><span class=w></span>


<span class=w>  </span><span class=kd>public</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=nf>getStock</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>stock</span><span class=p>;</span><span class=w></span>
<span class=w>  </span><span class=p>}</span><span class=w></span>

<span class=w>  </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>setStock</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>stock</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=k>this</span><span class=p>.</span><span class=na>stock</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>stock</span><span class=p>;</span><span class=w></span>
<span class=w>  </span><span class=p>}</span><span class=w></span>

<span class=w>  </span><span class=kd>public</span><span class=w> </span><span class=n>StockItem</span><span class=w> </span><span class=nf>withStock</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>stock</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=k>this</span><span class=p>.</span><span class=na>setStock</span><span class=p>(</span><span class=n>stock</span><span class=p>);</span><span class=w></span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=k>this</span><span class=p>;</span><span class=w></span>
<span class=w>  </span><span class=p>}</span><span class=w></span>

<span class=w>  </span><span class=kd>public</span><span class=w> </span><span class=kt>double</span><span class=w> </span><span class=nf>getPrice</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>price</span><span class=p>;</span><span class=w></span>
<span class=w>  </span><span class=p>}</span><span class=w></span>

<span class=w>  </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>setPrice</span><span class=p>(</span><span class=kt>double</span><span class=w> </span><span class=n>price</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=k>this</span><span class=p>.</span><span class=na>price</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>price</span><span class=p>;</span><span class=w></span>
<span class=w>  </span><span class=p>}</span><span class=w></span>

<span class=w>  </span><span class=kd>public</span><span class=w> </span><span class=n>StockItem</span><span class=w> </span><span class=nf>withPrice</span><span class=p>(</span><span class=kt>double</span><span class=w> </span><span class=n>price</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=k>this</span><span class=p>.</span><span class=na>setPrice</span><span class=p>(</span><span class=n>price</span><span class=p>);</span><span class=w></span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=k>this</span><span class=p>;</span><span class=w></span>
<span class=w>  </span><span class=p>}</span><span class=w></span>

<span class=w>  </span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>getManufacturer</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>manufacturer</span><span class=p>;</span><span class=w></span>
<span class=w>  </span><span class=p>}</span><span class=w></span>

<span class=w>  </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>setManufacturer</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>manufacturer</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=k>this</span><span class=p>.</span><span class=na>manufacturer</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>manufacturer</span><span class=p>;</span><span class=w></span>
<span class=w>  </span><span class=p>}</span><span class=w></span>

<span class=w>  </span><span class=kd>public</span><span class=w> </span><span class=n>StockItem</span><span class=w> </span><span class=nf>withManufacturer</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>manufacturer</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=k>this</span><span class=p>.</span><span class=na>setManufacturer</span><span class=p>(</span><span class=n>manufacturer</span><span class=p>);</span><span class=w></span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=k>this</span><span class=p>;</span><span class=w></span>
<span class=w>  </span><span class=p>}</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div> <h3 id=update-the-stockitem-controller>Update the StockItem controller<a class=headerlink href=#update-the-stockitem-controller title="Permanent link">&para;</a></h3> <div class=highlight><span class=filename>src/main/java/com/ibm/inventory_management/controllers/StockItemController.java</span><pre><span></span><code><span class=kn>package</span><span class=w> </span><span class=nn>com.ibm.inventory_management.controllers</span><span class=p>;</span><span class=w></span>

<span class=kn>import</span><span class=w> </span><span class=nn>java.util.List</span><span class=p>;</span><span class=w></span>

<span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.web.bind.annotation.*</span><span class=p>;</span><span class=w></span>

<span class=kn>import</span><span class=w> </span><span class=nn>com.ibm.inventory_management.models.StockItem</span><span class=p>;</span><span class=w></span>
<span class=kn>import</span><span class=w> </span><span class=nn>com.ibm.inventory_management.services.StockItemApi</span><span class=p>;</span><span class=w></span>

<span class=nd>@RestController</span><span class=w></span>
<span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>StockItemController</span><span class=w> </span><span class=p>{</span><span class=w></span>

<span class=w>  </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>StockItemApi</span><span class=w> </span><span class=n>service</span><span class=p>;</span><span class=w></span>

<span class=w>  </span><span class=kd>public</span><span class=w> </span><span class=nf>StockItemController</span><span class=p>(</span><span class=n>StockItemApi</span><span class=w> </span><span class=n>service</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=k>this</span><span class=p>.</span><span class=na>service</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>service</span><span class=p>;</span><span class=w></span>
<span class=w>  </span><span class=p>}</span><span class=w></span>

<span class=w>  </span><span class=nd>@GetMapping</span><span class=p>(</span><span class=n>path</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;/stock-items&quot;</span><span class=p>,</span><span class=w> </span><span class=n>produces</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;application/json&quot;</span><span class=p>)</span><span class=w></span>
<span class=w>  </span><span class=kd>public</span><span class=w> </span><span class=n>List</span><span class=o>&lt;</span><span class=n>StockItem</span><span class=o>&gt;</span><span class=w> </span><span class=nf>listStockItems</span><span class=p>()</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=na>service</span><span class=p>.</span><span class=na>listStockItems</span><span class=p>();</span><span class=w></span>
<span class=w>  </span><span class=p>}</span><span class=w></span>

<span class=w>  </span><span class=nd>@PostMapping</span><span class=p>(</span><span class=n>path</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;/stock-item&quot;</span><span class=p>)</span><span class=w></span>
<span class=w>  </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>addStockItem</span><span class=p>(</span><span class=nd>@RequestParam</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=nd>@RequestParam</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>manufacturer</span><span class=p>,</span><span class=w> </span><span class=nd>@RequestParam</span><span class=w> </span><span class=n>Double</span><span class=w> </span><span class=n>price</span><span class=p>,</span><span class=w> </span><span class=nd>@RequestParam</span><span class=w> </span><span class=n>Integer</span><span class=w> </span><span class=n>stock</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=k>this</span><span class=p>.</span><span class=na>service</span><span class=p>.</span><span class=na>addStockItem</span><span class=p>(</span><span class=n>name</span><span class=p>,</span><span class=n>price</span><span class=p>,</span><span class=n>stock</span><span class=p>,</span><span class=n>manufacturer</span><span class=p>);</span><span class=w></span>
<span class=w>  </span><span class=p>}</span><span class=w></span>

<span class=w>  </span><span class=nd>@PutMapping</span><span class=p>(</span><span class=n>path</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;/stock-item/{id}&quot;</span><span class=p>)</span><span class=w></span>
<span class=w>  </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>updateStockItem</span><span class=p>(</span><span class=nd>@PathVariable</span><span class=p>(</span><span class=s>&quot;id&quot;</span><span class=p>)</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=nd>@RequestParam</span><span class=p>(</span><span class=n>required</span><span class=o>=</span><span class=kc>false</span><span class=p>)</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=nd>@RequestParam</span><span class=p>(</span><span class=n>required</span><span class=o>=</span><span class=kc>false</span><span class=p>)</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>manufacturer</span><span class=p>,</span><span class=w> </span><span class=nd>@RequestParam</span><span class=p>(</span><span class=n>required</span><span class=o>=</span><span class=kc>false</span><span class=p>)</span><span class=w> </span><span class=n>Double</span><span class=w> </span><span class=n>price</span><span class=p>,</span><span class=w> </span><span class=nd>@RequestParam</span><span class=p>(</span><span class=n>required</span><span class=o>=</span><span class=kc>false</span><span class=p>)</span><span class=w> </span><span class=n>Integer</span><span class=w> </span><span class=n>stock</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=k>this</span><span class=p>.</span><span class=na>service</span><span class=p>.</span><span class=na>updateStockItem</span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>price</span><span class=p>,</span><span class=w> </span><span class=n>stock</span><span class=p>,</span><span class=w> </span><span class=n>manufacturer</span><span class=p>);</span><span class=w></span>
<span class=w>  </span><span class=p>}</span><span class=w></span>

<span class=w>  </span><span class=nd>@DeleteMapping</span><span class=p>(</span><span class=n>path</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;/stock-item/{id}&quot;</span><span class=p>)</span><span class=w></span>
<span class=w>  </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>deleteStockItem</span><span class=p>(</span><span class=nd>@PathVariable</span><span class=p>(</span><span class=s>&quot;id&quot;</span><span class=p>)</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>id</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=k>this</span><span class=p>.</span><span class=na>service</span><span class=p>.</span><span class=na>deleteStockItem</span><span class=p>(</span><span class=n>id</span><span class=p>);</span><span class=w></span>
<span class=w>  </span><span class=p>}</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div> <h3 id=update-the-configuration-values-in-the-valuesyaml-helm-chart>Update the configuration values in the <code>values.yaml</code> helm chart<a class=headerlink href=#update-the-configuration-values-in-the-valuesyaml-helm-chart title="Permanent link">&para;</a></h3> <ul> <li>Open the <code>values.yaml</code> file and add the values <code>cloudantBinding</code> and <code>databaseName</code> <div class=highlight><span class=filename>chart/base/values.yaml</span><pre><span></span><code><span class="l l-Scalar l-Scalar-Plain">cloudantBinding=&quot;{binding name}&quot;</span><span class=w></span>
<span class="l l-Scalar l-Scalar-Plain">databaseName=&quot;inventory-{namespace}&quot;</span><span class=w></span>
</code></pre></div></li> </ul> <div class="admonition note"> <p class=admonition-title>Note</p> <p>The <code>cloudantBinding</code> value should match the name of the cloudant binding secret</p> </div> <h3 id=add-a-cloudant-integration-to-your-backend-service_1>Add a Cloudant integration to your backend service<a class=headerlink href=#add-a-cloudant-integration-to-your-backend-service_1 title="Permanent link">&para;</a></h3> <p>If you are following the instructions from MicroApp part 1 and want to enable the Cloudant database yourself, use the following directions.</p> <h3 id=update-the-gradle-config-to-include-cloudant-dependencies>Update the gradle config to include cloudant dependencies<a class=headerlink href=#update-the-gradle-config-to-include-cloudant-dependencies title="Permanent link">&para;</a></h3> <ul> <li> <p>Add <code>build-cloudant.gradle</code> to the gradle folder <div class=highlight><pre><span></span><code><span class=w>  </span><span class=n>dependencies</span><span class=w> </span><span class=o>{</span><span class=w></span>
<span class=w>  </span><span class=n>compile</span><span class=w> </span><span class=nl>group:</span><span class=w> </span><span class=s1>&#39;com.cloudant&#39;</span><span class=o>,</span><span class=w> </span><span class=nl>name:</span><span class=w> </span><span class=s1>&#39;cloudant-client&#39;</span><span class=o>,</span><span class=w> </span><span class=nl>version:</span><span class=w> </span><span class=s1>&#39;2.17.0&#39;</span><span class=w></span>
<span class=w>  </span><span class=n>compile</span><span class=w> </span><span class=nl>group:</span><span class=w> </span><span class=s1>&#39;com.jayway.jsonpath&#39;</span><span class=o>,</span><span class=w> </span><span class=nl>name:</span><span class=w> </span><span class=s1>&#39;json-path&#39;</span><span class=o>,</span><span class=w> </span><span class=nl>version:</span><span class=w> </span><span class=s1>&#39;2.4.0&#39;</span><span class=w></span>
<span class=w>  </span><span class=n>compile</span><span class=w> </span><span class=nl>group:</span><span class=w> </span><span class=s1>&#39;javax.xml.bind&#39;</span><span class=o>,</span><span class=w> </span><span class=nl>name:</span><span class=w> </span><span class=s1>&#39;jaxb-api&#39;</span><span class=o>,</span><span class=w> </span><span class=nl>version:</span><span class=w> </span><span class=s1>&#39;2.1&#39;</span><span class=w></span>
<span class=w>  </span><span class=n>compile</span><span class=w> </span><span class=nl>group:</span><span class=w> </span><span class=s1>&#39;joda-time&#39;</span><span class=o>,</span><span class=w> </span><span class=nl>name:</span><span class=w> </span><span class=s1>&#39;joda-time&#39;</span><span class=o>,</span><span class=w> </span><span class=nl>version:</span><span class=w> </span><span class=s1>&#39;2.10.3&#39;</span><span class=w></span>
<span class=w>  </span><span class=o>}</span><span class=w></span>
</code></pre></div></p> </li> <li> <p>Enable the cloudant libraries by applying the <code>build-cloudant.gradle</code> to the end of the build.gradle file</p> </li> </ul> <div class=highlight><span class=filename>build.gradle</span><pre><span></span><code><span class=n>apply</span><span class=w> </span><span class=nl>from:</span><span class=w>   </span><span class=s1>&#39;gradle/build-cloudant.gradle&#39;</span><span class=w></span>
</code></pre></div> <ul> <li>Run <code>./gradlew init</code> to validate the changes and load the libraries </li> </ul> <h3 id=configuration-values>Configuration values<a class=headerlink href=#configuration-values title="Permanent link">&para;</a></h3> <ul> <li>Add CloudantConfig to hold the <code>url</code>, <code>username</code>, <code>password</code>, <code>apikey</code> and <code>databaseName</code> values:</li> </ul> <div class=highlight><span class=filename>src/main/java/com/ibm/inventory_management/config/CloudantConfig.java</span><pre><span></span><code><span class=kn>package</span><span class=w> </span><span class=nn>com.ibm.inventory_management.config</span><span class=p>;</span><span class=w></span>
<span class=kn>import</span><span class=w> </span><span class=nn>com.fasterxml.jackson.annotation.JsonIgnoreProperties</span><span class=p>;</span><span class=w></span>
<span class=nd>@JsonIgnoreProperties</span><span class=p>(</span><span class=n>ignoreUnknown</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span><span class=p>)</span><span class=w></span>
<span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>CloudantConfig</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w> </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>url</span><span class=p>;</span><span class=w></span>
<span class=w> </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>username</span><span class=p>;</span><span class=w></span>
<span class=w> </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>password</span><span class=p>;</span><span class=w></span>
<span class=w> </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>databaseName</span><span class=p>;</span><span class=w></span>
<span class=w> </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>apikey</span><span class=p>;</span><span class=w></span>
<span class=w> </span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>getUrl</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>   </span><span class=k>return</span><span class=w> </span><span class=n>url</span><span class=p>;</span><span class=w></span>
<span class=w> </span><span class=p>}</span><span class=w></span>
<span class=w> </span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>getApikey</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>   </span><span class=k>return</span><span class=w> </span><span class=n>apikey</span><span class=p>;</span><span class=w></span>
<span class=w> </span><span class=p>}</span><span class=w></span>
<span class=w> </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>setApikey</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>url</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=k>this</span><span class=p>.</span><span class=na>apikey</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>apikey</span><span class=p>;</span><span class=w></span>
<span class=w> </span><span class=p>}</span><span class=w></span>
<span class=w> </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>setUrl</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>url</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>   </span><span class=k>this</span><span class=p>.</span><span class=na>url</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>url</span><span class=p>;</span><span class=w></span>
<span class=w> </span><span class=p>}</span><span class=w></span>
<span class=w> </span><span class=kd>public</span><span class=w> </span><span class=n>CloudantConfig</span><span class=w> </span><span class=nf>withUrl</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>url</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>   </span><span class=k>this</span><span class=p>.</span><span class=na>setUrl</span><span class=p>(</span><span class=n>url</span><span class=p>);</span><span class=w></span>
<span class=w>   </span><span class=k>return</span><span class=w> </span><span class=k>this</span><span class=p>;</span><span class=w></span>
<span class=w> </span><span class=p>}</span><span class=w></span>
<span class=w> </span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>getUsername</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>   </span><span class=k>return</span><span class=w> </span><span class=n>username</span><span class=p>;</span><span class=w></span>
<span class=w> </span><span class=p>}</span><span class=w></span>
<span class=w> </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>setUsername</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>username</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>   </span><span class=k>this</span><span class=p>.</span><span class=na>username</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>username</span><span class=p>;</span><span class=w></span>
<span class=w> </span><span class=p>}</span><span class=w></span>
<span class=w> </span><span class=kd>public</span><span class=w> </span><span class=n>CloudantConfig</span><span class=w> </span><span class=nf>withUsername</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>username</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>   </span><span class=k>this</span><span class=p>.</span><span class=na>setUsername</span><span class=p>(</span><span class=n>username</span><span class=p>);</span><span class=w></span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=k>this</span><span class=p>;</span><span class=w></span>
<span class=w> </span><span class=p>}</span><span class=w></span>
<span class=w> </span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>getPassword</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>   </span><span class=k>return</span><span class=w> </span><span class=n>password</span><span class=p>;</span><span class=w></span>
<span class=w> </span><span class=p>}</span><span class=w></span>
<span class=w> </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>setPassword</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>password</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>   </span><span class=k>this</span><span class=p>.</span><span class=na>password</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>password</span><span class=p>;</span><span class=w></span>
<span class=w> </span><span class=p>}</span><span class=w></span>
<span class=w> </span><span class=kd>public</span><span class=w> </span><span class=n>CloudantConfig</span><span class=w> </span><span class=nf>withPassword</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>password</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>   </span><span class=k>this</span><span class=p>.</span><span class=na>setPassword</span><span class=p>(</span><span class=n>password</span><span class=p>);</span><span class=w></span>
<span class=w>   </span><span class=k>return</span><span class=w> </span><span class=k>this</span><span class=p>;</span><span class=w></span>
<span class=w> </span><span class=p>}</span><span class=w></span>
<span class=w> </span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>getDatabaseName</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>   </span><span class=k>return</span><span class=w> </span><span class=n>databaseName</span><span class=p>;</span><span class=w></span>
<span class=w> </span><span class=p>}</span><span class=w></span>
<span class=w> </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>setDatabaseName</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>databaseName</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>   </span><span class=k>this</span><span class=p>.</span><span class=na>databaseName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>databaseName</span><span class=p>;</span><span class=w></span>
<span class=w> </span><span class=p>}</span><span class=w></span>
<span class=w> </span><span class=kd>public</span><span class=w> </span><span class=n>CloudantConfig</span><span class=w> </span><span class=nf>withDatabaseName</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>databaseName</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>   </span><span class=k>this</span><span class=p>.</span><span class=na>setDatabaseName</span><span class=p>(</span><span class=n>databaseName</span><span class=p>);</span><span class=w></span>
<span class=w>   </span><span class=k>return</span><span class=w> </span><span class=k>this</span><span class=p>;</span><span class=w></span>
<span class=w> </span><span class=p>}</span><span class=w></span>
<span class=w> </span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>toString</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>  </span><span class=k>return</span><span class=w> </span><span class=s>&quot;[CloudantConfig: url=&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=na>url</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&quot;, username=&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=na>username</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&quot;, name=&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=na>databaseName</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&quot;]&quot;</span><span class=p>;</span><span class=w></span>
<span class=w> </span><span class=p>}</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div> <ul> <li> <p>Implement logic to load the configuration from the secret binding or local file</p> </li> <li> <p>Add CloudantMapping and CloudantConfigFactory files to the config directory:</p> </li> </ul> <div class=highlight><span class=filename>src/main/java/com/ibm/inventory_management/config/CloudantMapping.java</span><pre><span></span><code><span class=kn>package</span><span class=w> </span><span class=nn>com.ibm.inventory_management.config</span><span class=p>;</span><span class=w></span>
<span class=kn>import</span><span class=w> </span><span class=nn>java.io.Serializable</span><span class=p>;</span><span class=w></span>
<span class=kn>import</span><span class=w> </span><span class=nn>com.fasterxml.jackson.annotation.JsonProperty</span><span class=p>;</span><span class=w></span>
<span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>CloudantMapping</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>Serializable</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=nd>@JsonProperty</span><span class=p>(</span><span class=n>value</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;CLOUDANT_CONFIG&quot;</span><span class=p>)</span><span class=w></span>
<span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>cloudantConfig</span><span class=p>;</span><span class=w></span>
<span class=nd>@JsonProperty</span><span class=p>(</span><span class=n>value</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;DATABASE_NAME&quot;</span><span class=p>)</span><span class=w></span>
<span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>databaseName</span><span class=p>;</span><span class=w></span>
<span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>getCloudantConfig</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>   </span><span class=k>return</span><span class=w> </span><span class=n>cloudantConfig</span><span class=p>;</span><span class=w></span>
<span class=p>}</span><span class=w></span>
<span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>setCloudantConfig</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>cloudantConfig</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>   </span><span class=k>this</span><span class=p>.</span><span class=na>cloudantConfig</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>cloudantConfig</span><span class=p>;</span><span class=w></span>
<span class=p>}</span><span class=w></span>
<span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>getDatabaseName</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>   </span><span class=k>return</span><span class=w> </span><span class=n>databaseName</span><span class=p>;</span><span class=w></span>
<span class=p>}</span><span class=w></span>
<span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>setDatabaseName</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>databaseName</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>   </span><span class=k>this</span><span class=p>.</span><span class=na>databaseName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>databaseName</span><span class=p>;</span><span class=w></span>
<span class=p>}</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div> <div class=highlight><span class=filename>src/main/java/com/ibm/inventory_management/config/CloudantConfigFactory.java</span><pre><span></span><code><span class=kn>package</span><span class=w> </span><span class=nn>com.ibm.inventory_management.config</span><span class=p>;</span><span class=w></span>
<span class=kn>import</span><span class=w> </span><span class=nn>java.io.IOException</span><span class=p>;</span><span class=w></span>
<span class=kn>import</span><span class=w> </span><span class=nn>com.fasterxml.jackson.databind.ObjectMapper</span><span class=p>;</span><span class=w></span>
<span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.context.annotation.Bean</span><span class=p>;</span><span class=w></span>
<span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.stereotype.Component</span><span class=p>;</span><span class=w></span>
<span class=nd>@Component</span><span class=w></span>
<span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>CloudantConfigFactory</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=nd>@Bean</span><span class=w></span>
<span class=kd>public</span><span class=w> </span><span class=n>CloudantConfig</span><span class=w> </span><span class=nf>buildCloudantConfig</span><span class=p>()</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>IOException</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>   </span><span class=k>return</span><span class=w> </span><span class=n>buildConfigFromBinding</span><span class=p>(</span><span class=w></span>
<span class=w>           </span><span class=n>loadCloudantConfig</span><span class=p>(),</span><span class=w></span>
<span class=w>           </span><span class=n>loadDatabaseName</span><span class=p>()</span><span class=w></span>
<span class=w>   </span><span class=p>);</span><span class=w></span>
<span class=p>}</span><span class=w></span>
<span class=kd>protected</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>loadCloudantConfig</span><span class=p>()</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>IOException</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>System</span><span class=p>.</span><span class=na>getProperty</span><span class=p>(</span><span class=s>&quot;CLOUDANT_CONFIG&quot;</span><span class=p>)</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=w></span>
<span class=w>            </span><span class=o>?</span><span class=w> </span><span class=n>System</span><span class=p>.</span><span class=na>getProperty</span><span class=p>(</span><span class=s>&quot;CLOUDANT_CONFIG&quot;</span><span class=p>)</span><span class=w></span>
<span class=w>            </span><span class=p>:</span><span class=w> </span><span class=n>loadCloudantMappingFromLocalDev</span><span class=p>().</span><span class=na>getCloudantConfig</span><span class=p>();</span><span class=w></span>
<span class=p>}</span><span class=w></span>
<span class=kd>protected</span><span class=w> </span><span class=n>CloudantMapping</span><span class=w> </span><span class=nf>loadCloudantMappingFromLocalDev</span><span class=p>()</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>IOException</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=kd>final</span><span class=w> </span><span class=n>ObjectMapper</span><span class=w> </span><span class=n>mapper</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ObjectMapper</span><span class=p>();</span><span class=w></span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>mapper</span><span class=p>.</span><span class=na>readValue</span><span class=p>(</span><span class=w></span>
<span class=w>            </span><span class=k>this</span><span class=p>.</span><span class=na>getClass</span><span class=p>().</span><span class=na>getClassLoader</span><span class=p>().</span><span class=na>getResourceAsStream</span><span class=p>(</span><span class=s>&quot;mappings.json&quot;</span><span class=p>),</span><span class=w></span>
<span class=w>            </span><span class=n>CloudantMapping</span><span class=p>.</span><span class=na>class</span><span class=w></span>
<span class=w>    </span><span class=p>);</span><span class=w></span>
<span class=p>}</span><span class=w></span>
<span class=kd>protected</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>loadDatabaseName</span><span class=p>()</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>IOException</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>System</span><span class=p>.</span><span class=na>getProperty</span><span class=p>(</span><span class=s>&quot;DATABASE_NAME&quot;</span><span class=p>)</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=w></span>
<span class=w>            </span><span class=o>?</span><span class=w> </span><span class=n>System</span><span class=p>.</span><span class=na>getProperty</span><span class=p>(</span><span class=s>&quot;DATABASE_NAME&quot;</span><span class=p>)</span><span class=w></span>
<span class=w>            </span><span class=p>:</span><span class=w> </span><span class=n>loadCloudantMappingFromLocalDev</span><span class=p>().</span><span class=na>getDatabaseName</span><span class=p>();</span><span class=w></span>
<span class=p>}</span><span class=w></span>
<span class=kd>protected</span><span class=w> </span><span class=n>CloudantConfig</span><span class=w> </span><span class=nf>buildConfigFromBinding</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>binding</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>databaseName</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>IOException</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=kd>final</span><span class=w> </span><span class=n>ObjectMapper</span><span class=w> </span><span class=n>mapper</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ObjectMapper</span><span class=p>();</span><span class=w></span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>binding</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>CloudantConfig</span><span class=p>();</span><span class=w></span>
<span class=w>    </span><span class=p>}</span><span class=w></span>
<span class=w>    </span><span class=kd>final</span><span class=w> </span><span class=n>CloudantConfig</span><span class=w> </span><span class=n>baseConfig</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>mapper</span><span class=p>.</span><span class=na>readValue</span><span class=p>(</span><span class=n>binding</span><span class=p>,</span><span class=w> </span><span class=n>CloudantConfig</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w></span>

<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>baseConfig</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>CloudantConfig</span><span class=p>();</span><span class=w></span>
<span class=w>    </span><span class=p>}</span><span class=w></span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>baseConfig</span><span class=p>.</span><span class=na>withDatabaseName</span><span class=p>(</span><span class=n>databaseName</span><span class=p>);</span><span class=w></span>
<span class=p>}</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div> <h3 id=service-implementation>Service Implementation<a class=headerlink href=#service-implementation title="Permanent link">&para;</a></h3> <ul> <li>Add a CloudantApi component to create the CloudantClient instance from the configuration.</li> </ul> <div class=highlight><span class=filename>src/main/java/com/ibm/inventory_management/services/CloudServicesException.java</span><pre><span></span><code><span class=kn>package</span><span class=w> </span><span class=nn>com.ibm.inventory_management.services</span><span class=p>;</span><span class=w></span>
<span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>CloudServicesException</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=kd>public</span><span class=w> </span><span class=nf>CloudServicesException</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=p>}</span><span class=w></span>
<span class=kd>public</span><span class=w> </span><span class=nf>CloudServicesException</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>message</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>   </span><span class=kd>super</span><span class=p>(</span><span class=n>message</span><span class=p>);</span><span class=w></span>
<span class=p>}</span><span class=w></span>
<span class=kd>public</span><span class=w> </span><span class=nf>CloudServicesException</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>message</span><span class=p>,</span><span class=w> </span><span class=n>Throwable</span><span class=w> </span><span class=n>cause</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>   </span><span class=kd>super</span><span class=p>(</span><span class=n>message</span><span class=p>,</span><span class=w> </span><span class=n>cause</span><span class=p>);</span><span class=w></span>
<span class=p>}</span><span class=w></span>
<span class=kd>public</span><span class=w> </span><span class=nf>CloudServicesException</span><span class=p>(</span><span class=n>Throwable</span><span class=w> </span><span class=n>cause</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>   </span><span class=kd>super</span><span class=p>(</span><span class=n>cause</span><span class=p>);</span><span class=w></span>
<span class=p>}</span><span class=w></span>
<span class=kd>public</span><span class=w> </span><span class=nf>CloudServicesException</span><span class=p>(</span><span class=w></span>
<span class=w>       </span><span class=n>String</span><span class=w> </span><span class=n>message</span><span class=p>,</span><span class=w></span>
<span class=w>       </span><span class=n>Throwable</span><span class=w> </span><span class=n>cause</span><span class=p>,</span><span class=w></span>
<span class=w>       </span><span class=kt>boolean</span><span class=w> </span><span class=n>enableSuppression</span><span class=p>,</span><span class=w></span>
<span class=w>       </span><span class=kt>boolean</span><span class=w> </span><span class=n>writableStackTrace</span><span class=w></span>
<span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>   </span><span class=kd>super</span><span class=p>(</span><span class=n>message</span><span class=p>,</span><span class=w> </span><span class=n>cause</span><span class=p>,</span><span class=w> </span><span class=n>enableSuppression</span><span class=p>,</span><span class=w> </span><span class=n>writableStackTrace</span><span class=p>);</span><span class=w></span>
<span class=p>}</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div> <div class=highlight><span class=filename>src/main/java/com/ibm/inventory_management/services/CloudantApi.java</span><pre><span></span><code><span class=kn>package</span><span class=w> </span><span class=nn>com.ibm.inventory_management.services</span><span class=p>;</span><span class=w></span>
<span class=kn>import</span><span class=w> </span><span class=nn>java.net.MalformedURLException</span><span class=p>;</span><span class=w></span>
<span class=kn>import</span><span class=w> </span><span class=nn>java.net.URL</span><span class=p>;</span><span class=w></span>
<span class=kn>import</span><span class=w> </span><span class=nn>com.cloudant.client.api.ClientBuilder</span><span class=p>;</span><span class=w></span>
<span class=kn>import</span><span class=w> </span><span class=nn>com.cloudant.client.api.CloudantClient</span><span class=p>;</span><span class=w></span>
<span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.context.annotation.Bean</span><span class=p>;</span><span class=w></span>
<span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.context.annotation.Profile</span><span class=p>;</span><span class=w></span>
<span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.stereotype.Component</span><span class=p>;</span><span class=w></span>
<span class=kn>import</span><span class=w> </span><span class=nn>com.ibm.inventory_management.config.CloudantConfig</span><span class=p>;</span><span class=w></span>
<span class=nd>@Component</span><span class=w></span>
<span class=nd>@Profile</span><span class=p>(</span><span class=s>&quot;!mock&quot;</span><span class=p>)</span><span class=w></span>
<span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>CloudantApi</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>  </span><span class=nd>@Bean</span><span class=w></span>
<span class=w>  </span><span class=kd>public</span><span class=w> </span><span class=n>CloudantClient</span><span class=w> </span><span class=nf>buildCloudant</span><span class=p>(</span><span class=n>CloudantConfig</span><span class=w> </span><span class=n>config</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>CloudServicesException</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>     </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;Config: &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>config</span><span class=p>);</span><span class=w></span>
<span class=w>     </span><span class=n>URL</span><span class=w> </span><span class=n>url</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>null</span><span class=p>;</span><span class=w></span>
<span class=w>     </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>         </span><span class=n>url</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>URL</span><span class=p>(</span><span class=n>config</span><span class=p>.</span><span class=na>getUrl</span><span class=p>());</span><span class=w></span>
<span class=w>     </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>MalformedURLException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>         </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>CloudServicesException</span><span class=p>(</span><span class=s>&quot;Invalid service URL specified&quot;</span><span class=p>,</span><span class=w> </span><span class=n>e</span><span class=p>);</span><span class=w></span>
<span class=w>     </span><span class=p>}</span><span class=w></span>

<span class=w>     </span><span class=k>return</span><span class=w> </span><span class=n>ClientBuilder</span><span class=w></span>
<span class=w>             </span><span class=p>.</span><span class=na>url</span><span class=p>(</span><span class=n>url</span><span class=p>)</span><span class=w></span>
<span class=w>             </span><span class=p>.</span><span class=na>iamApiKey</span><span class=p>(</span><span class=n>config</span><span class=p>.</span><span class=na>getApikey</span><span class=p>())</span><span class=w></span>
<span class=w>             </span><span class=c1>//.username(config.getUsername())</span><span class=w></span>
<span class=w>             </span><span class=c1>//.password(config.getPassword())</span><span class=w></span>
<span class=w>             </span><span class=p>.</span><span class=na>build</span><span class=p>();</span><span class=w></span>
<span class=w> </span><span class=p>}</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div> <ul> <li> <p>Open the <code>deployment.yaml</code> file and add environment variables that use those values to the top of the existing <code>env</code> block</p> <div class=highlight><span class=filename>chart/template-java-spring/templates/deployment.yaml</span><pre><span></span><code><span class=nt>env</span><span class=p>:</span><span class=w></span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">CLOUDANT_CONFIG</span><span class=w></span>
<span class=w>    </span><span class=nt>valueFrom</span><span class=p>:</span><span class=w></span>
<span class=w>      </span><span class=nt>secretKeyRef</span><span class=p>:</span><span class=w></span>
<span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">{{</span><span class=w> </span><span class=nv>.Values.cloudantBinding | quote</span><span class=w> </span><span class="p p-Indicator">}}</span><span class=w></span>
<span class=w>        </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">binding</span><span class=w></span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">DATABASE_NAME</span><span class=w></span>
<span class=w>    </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">{{</span><span class=w> </span><span class=nv>.Values.databaseName | quote</span><span class=w> </span><span class="p p-Indicator">}}</span><span class=w></span>
</code></pre></div> <h3 id=running-the-application-locally>Running the application locally<a class=headerlink href=#running-the-application-locally title="Permanent link">&para;</a></h3> </li> <li> <p>Start the application. <div class=highlight><pre><span></span><code>./gradlew build
./gradlew bootrun
</code></pre></div></p> </li> </ul> <div class=tabbed-set data-tabs=1:4><input checked=checked id=__tabbed_1_1 name=__tabbed_1 type=radio><label for=__tabbed_1_1>Cloud Shell</label><div class=tabbed-content> <ul> <li>To view the running app click on the <strong>Eye Icon</strong> on the top right and select the port <code>9080</code> this will open a browser tab and display the running app on that port.</li> </ul> <p><img alt="View App" src=images/viewapp.png></p> </div> <input id=__tabbed_1_2 name=__tabbed_1 type=radio><label for=__tabbed_1_2>Gitpod</label><div class=tabbed-content> <ul> <li>Once you run the application,gitpod gives the option to make the port "Public".Once you make the port Public, it gives you the option to "Open Preview" or "Open Browser".</li> </ul> <p><img alt="View App" src=images/gitpod01.png></p> <ul> <li>Selecting "Open Preview" opens a window inside gitpod workspace tab.</li> </ul> <p><img alt=OpenPreview src=images/cloudantgitpodscreen.png></p> <ul> <li>Selecting "Open Browser" opens a new browser tab for accessing the URL.</li> </ul> </div> <input id=__tabbed_1_3 name=__tabbed_1 type=radio><label for=__tabbed_1_3>Cloud Ready Workspaces</label><div class=tabbed-content> <ul> <li> <p>Click on open link <img alt="CRW Open Link" src=images/crwopenlink.png></p> </li> <li> <p>To view this application in new tab click top right corner arrow icon <img alt="CRW Open App" src=images/crwopenapp.png></p> </li> </ul> </div> <input id=__tabbed_1_4 name=__tabbed_1 type=radio><label for=__tabbed_1_4>Desktop/Laptop</label><div class=tabbed-content> <ul> <li>Open a browser to <a href=http://localhost:9080:swagger-ui.html><code>http://localhost:9080/swagger-ui.html</code></a></li> </ul> </div> </div> <hr> <ul> <li> <p>Once the application is up, go the Swagger UI and execute get <code>stock-items</code>.</p> </li> <li> <p>You should be able to see all the data you pushed to the database through ./dataload.sh</p> </li> </ul> <p><img alt=ResultScreen src=images/ResultScreen.png></p> <p>Prebuilt solution for this can be found here: <a href=https://github.com/ibm-ecosystem-lab/inventory-management-svc-cloudant>Inventory Management Service Cloudant solution template</a></p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>You will need to setup your own Cloudant database, create your <code>mappings.json</code> file and update your <code>values.yaml</code> Helm file as mentioned before</p> </div> <form class=md-feedback name=feedback hidden> <fieldset> <legend class=md-feedback__title> Was this page helpful? </legend> <div class=md-feedback__inner> <div class=md-feedback__list> <button class="md-feedback__icon md-icon" type=submit title="This page was helpful" data-md-value=1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m7 0c0 .8-.7 1.5-1.5 1.5S14 10.3 14 9.5 14.7 8 15.5 8s1.5.7 1.5 1.5m-5 7.73c-1.75 0-3.29-.73-4.19-1.81L9.23 14c.45.72 1.52 1.23 2.77 1.23s2.32-.51 2.77-1.23l1.42 1.42c-.9 1.08-2.44 1.81-4.19 1.81Z"/></svg> </button> <button class="md-feedback__icon md-icon" type=submit title="This page could be improved" data-md-value=0> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10m-6.5-4c.8 0 1.5.7 1.5 1.5s-.7 1.5-1.5 1.5-1.5-.7-1.5-1.5.7-1.5 1.5-1.5M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m2 4.5c1.75 0 3.29.72 4.19 1.81l-1.42 1.42C14.32 16.5 13.25 16 12 16s-2.32.5-2.77 1.23l-1.42-1.42C8.71 14.72 10.25 14 12 14Z"/></svg> </button> </div> <div class=md-feedback__note> <div data-md-value=1 hidden> Thanks for your feedback! </div> <div data-md-value=0 hidden> Thanks for your feedback! </div> </div> </div> </fieldset> </form> </article> </div> </div> </main> <!-- Footer --> <footer class=md-footer> <!-- Further information --> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-column> <div class=md-footer-text><a href=https://develop.cloudnativetoolkit.dev/contribute/contribute/ >Contribute</a> to the Cloud-Native Toolkit</div> <div class=md-footer-text>Site licensed under <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ >CC BY-NC-SA 4.0</a></div> </div> <div class=md-footer-column> <div class=md-footer-text>Have questions? open an issue on <a href=https://github.com/cloud-native-toolkit/planning/issues/new/choose>GitHub</a>.</div> <!-- Copyright and theme information --> <div class=md-footer-text> Copyright  2022 IBM </div> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["navigation.instant", "navigation.tracking"], "search": "../../assets/javascripts/workers/search.ecf98df9.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script> <script src=../../assets/javascripts/bundle.9c69f0bc.min.js></script> <script src=../../javascripts/extra.js></script> </body> </html>