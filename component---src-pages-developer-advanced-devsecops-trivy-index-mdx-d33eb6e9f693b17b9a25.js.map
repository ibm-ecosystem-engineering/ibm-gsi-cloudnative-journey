{"version":3,"sources":["webpack:///./src/pages/developer-advanced/devsecops-trivy/index.mdx"],"names":["_frontmatter","makeShortcode","name","props","console","warn","PageDescription","Tabs","Tab","BR","layoutProps","MDXLayout","DefaultLayout","MDXContent","components","mdxType","parentName","label","isMDXComponent"],"mappings":"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","file":"component---src-pages-developer-advanced-devsecops-trivy-index-mdx-d33eb6e9f693b17b9a25.js","sourcesContent":["import * as React from 'react'\n  /* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsx mdx */\n\nimport DefaultLayout from \"/Users/admin/Documents/ISL/Code/GSI-Labs/publish/ibm-gsi-cloudnative-journey/node_modules/gatsby-theme-carbon/src/templates/Default.js\";\nimport Globals from 'gatsby-theme-carbon/src/templates/Globals';\nexport const _frontmatter = {};\n\nconst makeShortcode = name => function MDXDefaultShortcode(props) {\n  console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n  return <div {...props} />;\n};\n\nconst PageDescription = makeShortcode(\"PageDescription\");\nconst Tabs = makeShortcode(\"Tabs\");\nconst Tab = makeShortcode(\"Tab\");\nconst BR = makeShortcode(\"BR\");\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout;\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n\n    <PageDescription mdxType=\"PageDescription\">\n      <p>{`Integrating Aquasec Trivy in in CICD Pipeline for DevSecOps`}</p>\n    </PageDescription>\n    <h2>{`Overview`}</h2>\n    <p>{`DevSecOps ensures the security by doing Vulnerability scanning on the container images. There are several tools available for image scanning. `}</p>\n    <p><inlineCode parentName=\"p\">{`Trivy`}</inlineCode>{` is a Simple and Comprehensive Vulnerability Scanner for Containers, Suitable for CI.`}</p>\n    <p>{`The more information on Trivy is available in `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/aquasecurity/trivy\"\n      }}>{`https://github.com/aquasecurity/trivy`}</a></p>\n    <h2>{`Working with Trivy Commands`}</h2>\n    <h3>{`Installation`}</h3>\n    <p>{`Trivy installation is very simple. You can use homebrew on macOS to install`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`$ brew install aquasecurity/trivy/trivy\n`}</code></pre>\n    <h3>{`Trivy Standalone Run`}</h3>\n    <p>{`Trivy can be run as standalone in Desktop or in laptop .`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`$ trivy [YOUR_IMAGE_NAME]\n\n\n$ trivy python:3.4-alpine\n`}</code></pre>\n    <p>{`Output`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`2020-06-23T23:11:07.297+0530    INFO    Detecting Alpine vulnerabilities...\n\npython:3.4-alpine (alpine 3.9.2)\n================================\nTotal: 15 (UNKNOWN: 0, LOW: 1, MEDIUM: 10, HIGH: 4, CRITICAL: 0)\n\n+---------+------------------+----------+-------------------+---------------+--------------------------------+\n| LIBRARY | VULNERABILITY ID | SEVERITY | INSTALLED VERSION | FIXED VERSION |             TITLE              |\n+---------+------------------+----------+-------------------+---------------+--------------------------------+\n| bzip2   | CVE-2019-12900   | HIGH     | 1.0.6-r6          | 1.0.6-r7      | bzip2: out-of-bounds write in  |\n|         |                  |          |                   |               | function BZ2_decompress        |\n+---------+------------------+          +-------------------+---------------+--------------------------------+\n| expat   | CVE-2018-20843   |          | 2.2.6-r0          | 2.2.7-r0      | expat: large number of colons  |\n|         |                  |          |                   |               | in input makes parser consume  |\n|         |                  |          |                   |               | high amount...                 |\n+         +------------------+----------+                   +---------------+--------------------------------+\n|         | CVE-2019-15903   | MEDIUM   |                   | 2.2.7-r1      | expat: heap-based buffer       |\n|         |                  |          |                   |               | over-read via crafted XML      |\n|         |                  |          |                   |               | input                          |\n+---------+------------------+----------+-------------------+---------------+--------------------------------+\n| musl    | CVE-2019-14697   | HIGH     | 1.1.20-r4         | 1.1.20-r5     | musl libc through 1.1.23       |\n|         |                  |          |                   |               | has an x87 floating-point      |\n|         |                  |          |                   |               | stack adjustment imbalance,    |\n|         |                  |          |                   |               | related...                     |\n+---------+------------------+----------+-------------------+---------------+--------------------------------+\n| openssl | CVE-2019-1543    | MEDIUM   | 1.1.1a-r1         | 1.1.1b-r1     | openssl: ChaCha20-Poly1305     |\n|         |                  |          |                   |               | with long nonces               |\n+         +------------------+          +                   +---------------+--------------------------------+\n|         | CVE-2019-1549    |          |                   | 1.1.1d-r0     | openssl: information           |\n|         |                  |          |                   |               | disclosure in fork()           |\n+         +------------------+          +                   +---------------+--------------------------------+\n|         | CVE-2019-1551    |          |                   | 1.1.1d-r2     | openssl: Integer overflow in   |\n|         |                  |          |                   |               | RSAZ modular exponentiation on |\n|         |                  |          |                   |               | x86_64                         |\n+         +------------------+          +                   +---------------+--------------------------------+\n|         | CVE-2019-1563    |          |                   | 1.1.1d-r0     | openssl: information           |\n|         |                  |          |                   |               | disclosure in PKCS7_dataDecode |\n|         |                  |          |                   |               | and CMS_decrypt_set1_pkey      |\n+         +------------------+          +                   +---------------+--------------------------------+\n|         | CVE-2020-1967    |          |                   | 1.1.1g-r0     | openssl: Segmentation fault in |\n|         |                  |          |                   |               | SSL_check_chain causes denial  |\n|         |                  |          |                   |               | of service                     |\n+         +------------------+----------+                   +---------------+--------------------------------+\n|         | CVE-2019-1547    | LOW      |                   | 1.1.1d-r0     | openssl: side-channel weak     |\n|         |                  |          |                   |               | encryption vulnerability       |\n+---------+------------------+----------+-------------------+---------------+--------------------------------+\n| sqlite  | CVE-2019-8457    | HIGH     | 3.26.0-r3         | 3.28.0-r0     | sqlite: heap out-of-bound read |\n|         |                  |          |                   |               | in function rtreenode()        |\n+         +------------------+----------+                   +---------------+--------------------------------+\n|         | CVE-2019-16168   | MEDIUM   |                   | 3.28.0-r1     | sqlite: division by zero in    |\n|         |                  |          |                   |               | whereLoopAddBtreeIndex in      |\n|         |                  |          |                   |               | sqlite3.c                      |\n+         +------------------+          +                   +---------------+--------------------------------+\n|         | CVE-2019-19242   |          |                   | 3.28.0-r2     | sqlite: SQL injection in       |\n|         |                  |          |                   |               | sqlite3ExprCodeTarget in       |\n|         |                  |          |                   |               | expr.c                         |\n+         +------------------+          +                   +---------------+--------------------------------+\n|         | CVE-2019-5018    |          |                   | 3.28.0-r0     | sqlite: use-after-free in      |\n|         |                  |          |                   |               | window function leading to     |\n|         |                  |          |                   |               | remote code execution          |\n+         +------------------+          +                   +---------------+--------------------------------+\n|         | CVE-2020-11655   |          |                   | 3.28.0-r3     | sqlite: malformed              |\n|         |                  |          |                   |               | window-function query leads to |\n|         |                  |          |                   |               | DoS                            |\n+---------+------------------+----------+-------------------+---------------+--------------------------------+\n`}</code></pre>\n    <h3>{`Trivy Docker Run`}</h3>\n    <p>{`Trivy can be run from Docker.`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`$ docker run --rm -v [YOUR_CACHE_DIR]:/root/.cache/ aquasec/trivy [YOUR_IMAGE_NAME]\n\n$ docker run --rm -v $HOME/Library/Caches:/root/.cache/ aquasec/trivy python:3.4-alpine\n`}</code></pre>\n    <h3>{`Trivy Results as JSON`}</h3>\n    <p>{`Trivy output can be generated as json.`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`$ trivy -f json -o results.json python:3.4-alpine\n`}</code></pre>\n    <h3>{`Filter vulnerabilities by severities`}</h3>\n    <p>{`Vulnerability results can be filtered. In the below example HIGH and CRITICAL issues are displayed`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`$ trivy --severity HIGH,CRITICAL python:3.4-alpine\n`}</code></pre>\n    <pre><code parentName=\"pre\" {...{}}>{`\npython:3.4-alpine (alpine 3.9.2)\n================================\nTotal: 4 (UNKNOWN: 0, LOW: 0, MEDIUM: 0, HIGH: 4, CRITICAL: 0)\n\n+---------+------------------+----------+-------------------+---------------+--------------------------------+\n| LIBRARY | VULNERABILITY ID | SEVERITY | INSTALLED VERSION | FIXED VERSION |             TITLE              |\n+---------+------------------+----------+-------------------+---------------+--------------------------------+\n| bzip2   | CVE-2019-12900   | HIGH     | 1.0.6-r6          | 1.0.6-r7      | bzip2: out-of-bounds write in  |\n|         |                  |          |                   |               | function BZ2_decompress        |\n+---------+------------------+          +-------------------+---------------+--------------------------------+\n| expat   | CVE-2018-20843   |          | 2.2.6-r0          | 2.2.7-r0      | expat: large number of colons  |\n|         |                  |          |                   |               | in input makes parser consume  |\n|         |                  |          |                   |               | high amount...                 |\n+---------+------------------+          +-------------------+---------------+--------------------------------+\n| musl    | CVE-2019-14697   |          | 1.1.20-r4         | 1.1.20-r5     | musl libc through 1.1.23       |\n|         |                  |          |                   |               | has an x87 floating-point      |\n|         |                  |          |                   |               | stack adjustment imbalance,    |\n|         |                  |          |                   |               | related...                     |\n+---------+------------------+          +-------------------+---------------+--------------------------------+\n| sqlite  | CVE-2019-8457    |          | 3.26.0-r3         | 3.28.0-r0     | sqlite: heap out-of-bound read |\n|         |                  |          |                   |               | in function rtreenode()        |\n+---------+------------------+----------+-------------------+---------------+--------------------------------+\n`}</code></pre>\n    <h3>{`Trivy Run - Exit Code`}</h3>\n    <p>{`Exit code can be used to break the build based on condition. `}</p>\n    <p>{`This is useful while using Trivy in CICD`}</p>\n    <h4>{`Stop Build\u000b`}</h4>\n    <p>{`Build stops, when CRITICAL and HIGH severities are found.`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`$ trivy --exit-code 1 --severity CRITICAL,HIGH python:3.4-alpine\n`}</code></pre>\n    <h4>{`Continue Build\u000b`}</h4>\n    <p>{`Build doesn’t stop, when MEDIUM and LOW found.`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`$ trivy --exit-code 0 --severity MEDIUM,LOW python:3.4-alpine\n`}</code></pre>\n    <h2>{`Integrating Trivy with Jenkins and Tekton\\``}</h2>\n    <p>{`Lets integrate the Trivy in `}<inlineCode parentName=\"p\">{`Jenkins`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`Tekton`}</inlineCode>{` pipelines of Cloud Native Toolkit`}</p>\n    <ul>\n      <li parentName=\"ul\">\n        <p parentName=\"li\">{`Create an App using `}<a parentName=\"p\" {...{\n            \"href\": \"/ibm-gsi-cloudnative-journey/developer-intermediate/deploy-app\"\n          }}>{`Deploy First App`}</a>{`.`}</p>\n      </li>\n      <li parentName=\"ul\">\n        <p parentName=\"li\">{`Make changes to the `}<inlineCode parentName=\"p\">{`Jenkins`}</inlineCode>{` or `}<inlineCode parentName=\"p\">{`Tekton`}</inlineCode>{` pipelines as given below.`}</p>\n      </li>\n    </ul>\n    <Tabs mdxType=\"Tabs\">\n      <Tab label=\"Jenkins\" mdxType=\"Tab\">\n        <p>{`The CICD process contains several steps. There is a step called `}<inlineCode parentName=\"p\">{`Build Image`}</inlineCode>{` that will build a image and Push the image to the image registry.\n`}<span parentName=\"p\" {...{\n            \"className\": \"gatsby-resp-image-wrapper\",\n            \"style\": {\n              \"position\": \"relative\",\n              \"display\": \"block\",\n              \"marginLeft\": \"auto\",\n              \"marginRight\": \"auto\",\n              \"maxWidth\": \"1152px\"\n            }\n          }}>{`\n      `}<span parentName=\"span\" {...{\n              \"className\": \"gatsby-resp-image-background-image\",\n              \"style\": {\n                \"paddingBottom\": \"39.93055555555555%\",\n                \"position\": \"relative\",\n                \"bottom\": \"0\",\n                \"left\": \"0\",\n                \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABEElEQVQoz51Q2XKDMAzM//9fT9I0DeUqmBRjY4yPrSXClD70oZXHo5UlrVc6VFWFsixB3loLshgjfrN97ide48OyLNiuNgpiEJxw3qGXgr1zDnVbQSrJzeJToE91ZPTWXlt47xFDItz/LkaBU/3ChGYxOFYZJjshhIBjmUHIleS9y5G3F8ad7LjHp49ZIQFtJpZsZgM5SsR0FrdgkAMXEqFMeFvJqEYorRhrrTkmsnXkNM6pvsLYmBR84Ll4YgI9azxc7qDSGmicx/we3dAyyVtzxrl5Zdz0NbLU4zaFIZCedaG0RzsnFbddE/G2+D0mT/Eeb/4QIyXWwqIrWJUPHv+xm8KA9ZJCi8lM+H77+/0CeuRw6uwv+YoAAAAASUVORK5CYII=')\",\n                \"backgroundSize\": \"cover\",\n                \"display\": \"block\"\n              }\n            }}></span>{`\n  `}<img parentName=\"span\" {...{\n              \"className\": \"gatsby-resp-image-image\",\n              \"alt\": \"Jenkins Pipeline\",\n              \"title\": \"Jenkins Pipeline\",\n              \"src\": \"/ibm-gsi-cloudnative-journey/static/1e4238bed0420d3a318118f9ca37d5ef/3cbba/01-jenkins-pipeline.png\",\n              \"srcSet\": [\"/ibm-gsi-cloudnative-journey/static/1e4238bed0420d3a318118f9ca37d5ef/7fc1e/01-jenkins-pipeline.png 288w\", \"/ibm-gsi-cloudnative-journey/static/1e4238bed0420d3a318118f9ca37d5ef/a5df1/01-jenkins-pipeline.png 576w\", \"/ibm-gsi-cloudnative-journey/static/1e4238bed0420d3a318118f9ca37d5ef/3cbba/01-jenkins-pipeline.png 1152w\", \"/ibm-gsi-cloudnative-journey/static/1e4238bed0420d3a318118f9ca37d5ef/0b124/01-jenkins-pipeline.png 1728w\", \"/ibm-gsi-cloudnative-journey/static/1e4238bed0420d3a318118f9ca37d5ef/97581/01-jenkins-pipeline.png 1832w\"],\n              \"sizes\": \"(max-width: 1152px) 100vw, 1152px\",\n              \"style\": {\n                \"width\": \"100%\",\n                \"height\": \"100%\",\n                \"margin\": \"0\",\n                \"verticalAlign\": \"middle\",\n                \"position\": \"absolute\",\n                \"top\": \"0\",\n                \"left\": \"0\"\n              },\n              \"loading\": \"lazy\"\n            }}></img>{`\n    `}</span></p>\n        <p>{`Need to split the step into 3 steps.`}</p>\n        <ul>\n          <li parentName=\"ul\">{`Build Image`}</li>\n          <li parentName=\"ul\">{`Trivy Scan`}</li>\n          <li parentName=\"ul\">{`Push Image`}</li>\n        </ul>\n        <p>{`The modified pipeline should look like this.\n`}<span parentName=\"p\" {...{\n            \"className\": \"gatsby-resp-image-wrapper\",\n            \"style\": {\n              \"position\": \"relative\",\n              \"display\": \"block\",\n              \"marginLeft\": \"auto\",\n              \"marginRight\": \"auto\",\n              \"maxWidth\": \"1152px\"\n            }\n          }}>{`\n      `}<span parentName=\"span\" {...{\n              \"className\": \"gatsby-resp-image-background-image\",\n              \"style\": {\n                \"paddingBottom\": \"45.833333333333336%\",\n                \"position\": \"relative\",\n                \"bottom\": \"0\",\n                \"left\": \"0\",\n                \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABqklEQVQoz31S72sTQRC9P0KoKCi02Jqapg3VoqhQVBBbk7axFr+J+EEQ/+N8aWMTCMnt7e7d5fbX5Tk7RwqCdeHxdmZn3j1uJmk96aDd6eLu/Qf4cNzD5e9rDIdDjEYjjMfjBpMxptMphBC3Ik1TRrK9s4et7R0WPDkbQBQOQuaQMkOWCWIJrTWMqfC/U9c1vPdIHpPYZqvNgh/7p1Clgy4tpC6hCwMfagTCquE2xHdrLZL2bpcdrpFg73SAvDSYR/tCkdMSsggEz+JVZeCoyRpL7FhgxSEEOOeQvHl/jFeHb7G3f4Cv376jKApCjsouUC8DrKfiOrKjuOb4hsmVo3x898E1gv3BZ/TPPuH14Tv8+PkLlTFUXCPTAsZZ4gyWWOYZxQZCpTDWIJUp1VYcx4/LQiL4gCQ663Sf4uH6IwzOL1jQGIdUzbGoFsyxcS6JLQnoRmiWzfh9Jmc3g2GHWzSQjc0W7qzdw1HvhJPx+OD/McslizW35V+8mnSy/+w5Dl68ZNHziy+4vLqivZvQymS8LrnOG85zXqEJ7aSSiuOYb/55gbIsoZTCH/QKaZ2HRkCzAAAAAElFTkSuQmCC')\",\n                \"backgroundSize\": \"cover\",\n                \"display\": \"block\"\n              }\n            }}></span>{`\n  `}<img parentName=\"span\" {...{\n              \"className\": \"gatsby-resp-image-image\",\n              \"alt\": \"Jenkins Pipeline with Trivy\",\n              \"title\": \"Jenkins Pipeline with Trivy\",\n              \"src\": \"/ibm-gsi-cloudnative-journey/static/e289ea197ce44d16fcea26788bfe0554/3cbba/02-jenkins-pipeline-with-trivy.png\",\n              \"srcSet\": [\"/ibm-gsi-cloudnative-journey/static/e289ea197ce44d16fcea26788bfe0554/7fc1e/02-jenkins-pipeline-with-trivy.png 288w\", \"/ibm-gsi-cloudnative-journey/static/e289ea197ce44d16fcea26788bfe0554/a5df1/02-jenkins-pipeline-with-trivy.png 576w\", \"/ibm-gsi-cloudnative-journey/static/e289ea197ce44d16fcea26788bfe0554/3cbba/02-jenkins-pipeline-with-trivy.png 1152w\", \"/ibm-gsi-cloudnative-journey/static/e289ea197ce44d16fcea26788bfe0554/0b124/02-jenkins-pipeline-with-trivy.png 1728w\", \"/ibm-gsi-cloudnative-journey/static/e289ea197ce44d16fcea26788bfe0554/a7ba4/02-jenkins-pipeline-with-trivy.png 2236w\"],\n              \"sizes\": \"(max-width: 1152px) 100vw, 1152px\",\n              \"style\": {\n                \"width\": \"100%\",\n                \"height\": \"100%\",\n                \"margin\": \"0\",\n                \"verticalAlign\": \"middle\",\n                \"position\": \"absolute\",\n                \"top\": \"0\",\n                \"left\": \"0\"\n              },\n              \"loading\": \"lazy\"\n            }}></img>{`\n    `}</span></p>\n        <h4>{`Build Image`}</h4>\n        <p>{`The build image will build the image.`}</p>\n        <h4>{`Trivy Scan`}</h4>\n        <p>{`Trivy scan will scan the image and print the Vulnerability count as Low, Medium, High and Critical.\nBased on the configured exit criteria (0 Critical) the next step would in the pipeline will continue.`}</p>\n        <h4>{`Push Image`}</h4>\n        <p>{`After the scan is completed, it Pushes the image to the Image Registry.`}</p>\n        <BR mdxType=\"BR\"></BR>\n        <BR mdxType=\"BR\"></BR>\n        <p>{`The pipeline scripts are defined in the `}<inlineCode parentName=\"p\">{`jenkinsfile`}</inlineCode>{`. lets us see the changes done in the jenkins file.`}</p>\n        <h2>{`Jenkinsfile Changes`}</h2>\n        <h3>{`Declaration`}</h3>\n        <p>{`The below code snippet is the declaration about Trivy image, to be added in the `}<inlineCode parentName=\"p\">{`containers`}</inlineCode>{` section under `}<inlineCode parentName=\"p\">{`podTemplate`}</inlineCode>{` in the `}<inlineCode parentName=\"p\">{`jenkinsfile`}</inlineCode></p>\n        <pre><code parentName=\"pre\" {...{}}>{`\\`\\`\\`\n- name: trivy\n    image: docker.io/aquasec/trivy\n    tty: true\n    command: [\"/bin/sh\"]\n    workingDir: \\${workingDir}\n    securityContext:\n    privileged: true\n    envFrom:\n    - configMapRef:\n        name: ibmcloud-config\n    - secretRef:\n        name: ibmcloud-apikey       \n\\`\\`\\`\n`}</code></pre>\n        <ol>\n          <li parentName=\"ol\"><inlineCode parentName=\"li\">{`name`}</inlineCode>{`  -  `}<inlineCode parentName=\"li\">{`trivy`}</inlineCode>{` will be used in the script to refer the trivy container.`}</li>\n          <li parentName=\"ol\"><inlineCode parentName=\"li\">{`image`}</inlineCode>{` - image tag of the `}<inlineCode parentName=\"li\">{`trivy`}</inlineCode>{`.`}</li>\n          <li parentName=\"ol\"><inlineCode parentName=\"li\">{`configMapRef`}</inlineCode>{` -  A configmap contains `}<inlineCode parentName=\"li\">{`username`}</inlineCode>{` details to connect to IBM Cloud Container registry.`}</li>\n          <li parentName=\"ol\"><inlineCode parentName=\"li\">{`secretRef`}</inlineCode>{` A secrte contains `}<inlineCode parentName=\"li\">{`password`}</inlineCode>{` to connect to IBM Cloud Container registry.`}</li>\n        </ol>\n        <h3>{`Build Image`}</h3>\n        <p>{`Here are the steps to Build Image. Replace the existing content under the `}<inlineCode parentName=\"p\">{`container(name: 'buildah'`}</inlineCode></p>\n        <pre><code parentName=\"pre\" {...{}}>{`container(name: 'buildah', shell: '/bin/bash') {\n    stage('Build image') {\n        sh '''#!/bin/bash\n            set -e\n            . ./env-config\n\n            echo TLSVERIFY=\\${TLSVERIFY}\n            echo CONTEXT=\\${CONTEXT}\n        IMAGE_VERSION=\"0.0.1\"\n\n            if [[ -z \"\\${REGISTRY_PASSWORD}\" ]]; then\n                REGISTRY_PASSWORD=\"\\${APIKEY}\"\n            fi\n\n        APP_IMAGE=\"\\${REGISTRY_URL}/\\${REGISTRY_NAMESPACE}/\\${IMAGE_NAME}-temp:\\${IMAGE_VERSION}\"\n\n        echo \"Image... $APP_IMAGE\"\n\n        buildah bud --tls-verify=\\${TLSVERIFY} --format=docker -f \\${DOCKERFILE} -t \\${APP_IMAGE} \\${CONTEXT}\n\n        if [[ -n \"\\${REGISTRY_USER}\" ]] && [[ -n \"\\${REGISTRY_PASSWORD}\" ]]; then\n            buildah login -u \"\\${REGISTRY_USER}\" -p \"\\${REGISTRY_PASSWORD}\" \"\\${REGISTRY_URL}\"\n        fi\n\n        buildah push --tls-verify=\\${TLSVERIFY} \"\\${APP_IMAGE}\" \"docker://\\${APP_IMAGE}\"\n        '''\n    }\n}\n`}</code></pre>\n        <ol>\n          <li parentName=\"ol\">\n            <p parentName=\"li\">{`The variable `}<inlineCode parentName=\"p\">{`APP_IMAGE=`}</inlineCode>{` contains the Temp image name. `}</p>\n          </li>\n          <li parentName=\"ol\">\n            <p parentName=\"li\">{`Image is build using `}<inlineCode parentName=\"p\">{`buildah`}</inlineCode>{` and tagged with temp image name.`}</p>\n          </li>\n          <li parentName=\"ol\">\n            <p parentName=\"li\">{`Login into IBM Cloud Container Registry using `}<inlineCode parentName=\"p\">{`buildah`}</inlineCode>{`.`}</p>\n          </li>\n          <li parentName=\"ol\">\n            <p parentName=\"li\">{`Temp image is pushed to IBM Cloud Container Registry using `}<inlineCode parentName=\"p\">{`buildah`}</inlineCode>{`.`}</p>\n          </li>\n        </ol>\n        <h3>{`Trivy Scan`}</h3>\n        <p>{`The below code snippet is for trivy Scanning. Add the below code under the previous step \\`Build Image’`}</p>\n        <pre><code parentName=\"pre\" {...{}}>{`        container(name: 'trivy', shell: '/bin/sh') {\n            stage('Trivy Scan') {\n\n                  sh '''#!/bin/sh\n\n                    set -e\n                    . ./env-config\n\n                    echo TLSVERIFY=\\${TLSVERIFY}\n                    echo CONTEXT=\\${CONTEXT}\n                    IMAGE_VERSION=\"0.0.1\"\n\n                    if [[ -z \"\\${REGISTRY_PASSWORD}\" ]]; then\n                      REGISTRY_PASSWORD=\"\\${APIKEY}\"\n                    fi\n\n                    APP_IMAGE_Temp=\"\\${REGISTRY_URL}/\\${REGISTRY_NAMESPACE}/\\${IMAGE_NAME}-temp:\\${IMAGE_VERSION}\"\n\n                    export TRIVY_AUTH_URL=\\${REGISTRY_URL}\n                    export TRIVY_USERNAME=\\${REGISTRY_USER}\n                    export TRIVY_PASSWORD=\\${REGISTRY_PASSWORD}\n\n                    echo \"Trivy image scanning started.... $APP_IMAGE_Temp\"\n\n                    # Trivy scan\n                    trivy --exit-code 1 --severity CRITICAL \\${APP_IMAGE_Temp}\n                    #trivy \\${APP_IMAGE_Temp}\n\n                    # Check scan results\n                    my_exit_code=$?\n                    echo \"scan exit code : $my_exit_code\"\n                    if [ \\${my_exit_code} == 1 ]; then\n                        echo \"Image scanning failed. Some vulnerabilities found\"\n                        exit 1;\n                    else\n                        echo \"Image is scanned Successfully. No vulnerabilities found\"\n                    fi;\n                '''\n            }\n        }\n\n`}</code></pre>\n        <ol>\n          <li parentName=\"ol\">\n            <p parentName=\"li\">{`The temporary image is scanned here.`}</p>\n          </li>\n          <li parentName=\"ol\">\n            <p parentName=\"li\"><inlineCode parentName=\"p\">{`TRIVY_AUTH_URL,`}</inlineCode>{` `}<inlineCode parentName=\"p\">{`TRIVY_USERNAME`}</inlineCode>{`, `}<inlineCode parentName=\"p\">{`TRIVY_PASSWORD`}</inlineCode>{` refers the Registry URL and user details to login into IBM Cloud Container Registry by trivy.`}</p>\n          </li>\n          <li parentName=\"ol\">\n            <p parentName=\"li\"><inlineCode parentName=\"p\">{`trivy --exit-code 1 --severity CRITICAL \\${APP_IMAGE_Temp}`}</inlineCode>{` - step scans the temp image available in the IBM Cloud Container Registry.`}</p>\n          </li>\n          <li parentName=\"ol\">\n            <p parentName=\"li\">{`The step stops and then the pipeline also stops when there is a CRITICAL issue found.`}</p>\n          </li>\n          <li parentName=\"ol\">\n            <p parentName=\"li\">{`If you don’t want to stop the pipeline though the CRITICAL issue is found then replace the above triy scan line with `}<inlineCode parentName=\"p\">{`trivy \\${APP_IMAGE_Temp}`}</inlineCode>{`.`}</p>\n          </li>\n          <li parentName=\"ol\">\n            <p parentName=\"li\">{`The scan results will be printed in the console.`}</p>\n          </li>\n        </ol>\n        <h3>{`Push Image`}</h3>\n        <p>{`The below code snippet is for Pushing Image. Add the below code under the previous step \\`Trivy Scan’`}</p>\n        <pre><code parentName=\"pre\" {...{}}>{`        container(name: 'buildah', shell: '/bin/bash') {\n            stage('Push image') {\n                sh '''#!/bin/bash\n                    set -e\n                    . ./env-config\n\n                    echo TLSVERIFY=\\${TLSVERIFY}\n                    echo CONTEXT=\\${CONTEXT}\n                IMAGE_VERSION=\"0.0.1\"\n\n                    if [[ -z \"\\${REGISTRY_PASSWORD}\" ]]; then\n                      REGISTRY_PASSWORD=\"\\${APIKEY}\"\n                    fi\n\n                APP_IMAGE=\"\\${REGISTRY_URL}/\\${REGISTRY_NAMESPACE}/\\${IMAGE_NAME}:\\${IMAGE_VERSION}\"\n                APP_IMAGE_Temp=\"\\${REGISTRY_URL}/\\${REGISTRY_NAMESPACE}/\\${IMAGE_NAME}-temp:\\${IMAGE_VERSION}\"\n\n                if [[ -n \"\\${REGISTRY_USER}\" ]] && [[ -n \"\\${REGISTRY_PASSWORD}\" ]]; then\n                    buildah login -u \"\\${REGISTRY_USER}\" -p \"\\${REGISTRY_PASSWORD}\" \"\\${REGISTRY_URL}\"\n                fi\n        \n                buildah pull \\${APP_IMAGE_Temp}\n                buildah tag \\${APP_IMAGE_Temp} \\${APP_IMAGE}\n                buildah push --tls-verify=\\${TLSVERIFY} \"\\${APP_IMAGE}\" \"docker://\\${APP_IMAGE}\"\n                buildah rmi \\${APP_IMAGE_Temp}\n                '''\n            }\n        }\n`}</code></pre>\n        <p>{`The code snippet does the followings.`}</p>\n        <ol>\n          <li parentName=\"ol\">\n            <p parentName=\"li\">{`Login into IBM Cloud Container Registry using `}<inlineCode parentName=\"p\">{`buildah`}</inlineCode>{`.`}</p>\n          </li>\n          <li parentName=\"ol\">\n            <p parentName=\"li\">{`Pull the temp image using `}<inlineCode parentName=\"p\">{`buildah`}</inlineCode>{`.`}</p>\n          </li>\n          <li parentName=\"ol\">\n            <p parentName=\"li\">{`Tag the image to the actual image name.`}</p>\n          </li>\n          <li parentName=\"ol\">\n            <p parentName=\"li\">{`Push the actual image to IBM Cloud Container Registry using `}<inlineCode parentName=\"p\">{`buildah`}</inlineCode>{`.`}</p>\n          </li>\n          <li parentName=\"ol\">\n            <p parentName=\"li\">{`Remove the temp image from IBM Cloud Container Registry using `}<inlineCode parentName=\"p\">{`buildah`}</inlineCode>{`.`}</p>\n          </li>\n        </ol>\n      </Tab>\n      <Tab label=\"Tekton\" mdxType=\"Tab\">\n        <p>{`The CICD process contains several steps. There is a step called `}<inlineCode parentName=\"p\">{`Build`}</inlineCode>{` that will build a image and Push the image to the image registry.`}</p>\n        <span {...{\n          \"className\": \"gatsby-resp-image-wrapper\",\n          \"style\": {\n            \"position\": \"relative\",\n            \"display\": \"block\",\n            \"marginLeft\": \"auto\",\n            \"marginRight\": \"auto\",\n            \"maxWidth\": \"1152px\"\n          }\n        }}>{`\n      `}<span parentName=\"span\" {...{\n            \"className\": \"gatsby-resp-image-background-image\",\n            \"style\": {\n              \"paddingBottom\": \"44.09722222222222%\",\n              \"position\": \"relative\",\n              \"bottom\": \"0\",\n              \"left\": \"0\",\n              \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABMUlEQVQoz42STW6DMBCFfYBschcuxCbHyHF6hW7YpaqUHUeIFH4TcOJgAzaGV48rqtAkap/09ITGHr4ZYF2nIaVC3/cgjeP44GmaXpvq7p69cZjiCHasUqR5huSYoK4rPNNfDUki/kT9/gbGpYRoWjRNg5tz27aeds6u655SL2wtLFE6My5a1FcJpSS0Nr6JMcZ7GAaf/xGRju48E+KK8+kEzrl/27xHIiQTIaVS6sfz831aa/1dJmlkIVCWJXa7D0RRhP1+7/ZZL3y5XHyeq8pnVS3rWuvvhrQ7UhzHWK/XWK1WCILAj0qkNDYlNSSSaRo9zW/PH4llReYO9kjTFJvNBmEYYrvd+uK9ynOJ0pGYAdDD9PJvYEmeolH9Q5HIZhNhfspxyAtcG4Ob1Iv6PeEXKsGvQHDJB1wAAAAASUVORK5CYII=')\",\n              \"backgroundSize\": \"cover\",\n              \"display\": \"block\"\n            }\n          }}></span>{`\n  `}<img parentName=\"span\" {...{\n            \"className\": \"gatsby-resp-image-image\",\n            \"alt\": \"Tekton Pipeline\",\n            \"title\": \"Tekton Pipeline\",\n            \"src\": \"/ibm-gsi-cloudnative-journey/static/0d4736433c6134f3deb5b76a4f37af5e/3cbba/05-tekton-pipeline.png\",\n            \"srcSet\": [\"/ibm-gsi-cloudnative-journey/static/0d4736433c6134f3deb5b76a4f37af5e/7fc1e/05-tekton-pipeline.png 288w\", \"/ibm-gsi-cloudnative-journey/static/0d4736433c6134f3deb5b76a4f37af5e/a5df1/05-tekton-pipeline.png 576w\", \"/ibm-gsi-cloudnative-journey/static/0d4736433c6134f3deb5b76a4f37af5e/3cbba/05-tekton-pipeline.png 1152w\", \"/ibm-gsi-cloudnative-journey/static/0d4736433c6134f3deb5b76a4f37af5e/0b124/05-tekton-pipeline.png 1728w\", \"/ibm-gsi-cloudnative-journey/static/0d4736433c6134f3deb5b76a4f37af5e/8c91b/05-tekton-pipeline.png 2130w\"],\n            \"sizes\": \"(max-width: 1152px) 100vw, 1152px\",\n            \"style\": {\n              \"width\": \"100%\",\n              \"height\": \"100%\",\n              \"margin\": \"0\",\n              \"verticalAlign\": \"middle\",\n              \"position\": \"absolute\",\n              \"top\": \"0\",\n              \"left\": \"0\"\n            },\n            \"loading\": \"lazy\"\n          }}></img>{`\n    `}</span>\n        <p>{`Need to split the step into 3 steps.`}</p>\n        <ul>\n          <li parentName=\"ul\">{`build`}</li>\n          <li parentName=\"ul\">{`image-scan`}</li>\n          <li parentName=\"ul\">{`push`}</li>\n        </ul>\n        <p>{`The modified pipeline should look like this.\n`}<span parentName=\"p\" {...{\n            \"className\": \"gatsby-resp-image-wrapper\",\n            \"style\": {\n              \"position\": \"relative\",\n              \"display\": \"block\",\n              \"marginLeft\": \"auto\",\n              \"marginRight\": \"auto\",\n              \"maxWidth\": \"1152px\"\n            }\n          }}>{`\n      `}<span parentName=\"span\" {...{\n              \"className\": \"gatsby-resp-image-background-image\",\n              \"style\": {\n                \"paddingBottom\": \"43.75%\",\n                \"position\": \"relative\",\n                \"bottom\": \"0\",\n                \"left\": \"0\",\n                \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABVklEQVQoz41SSW4CMRD0F4J4QRAnfoA48Qd+l1s+kEueQUTECaFEQgwDxLOFWTzepuI2MeJAlpZKbru7y+V2s7Ks0TQNyLqug7XWI/i0/gmXpw9byN072Ga3RRRFiOPYB2/Zb2RkRkrw50ekTw9g2alCVVUoyxJ13UAqBSEEpEsSooUx5qL6JxhS6IitA+P5+clSKjSOSDnCtm2htfYrFfzHOqNhXQ3b72Mcj0evip5Ais7qhCeklUCXEoJ/fU754fmsKArkeY7VaoX5/AWLxSsO7oI0TT2SJEGWZUgdOOdIvs9CnDufOC6EpIL6Nx6PMbgfYDgcYrlc+iDFSDH1mIqt87VWvh3UmgDah89jHzzxhaPRCL27Hvr9/oUw9K9uakSHGK0ChHJtsbcnwStMitJ/yGw2w2QywXQ6xXq99sFwc1md8BZtkJ8UPmvlJsH42bue2UD6BYF5prC464CFAAAAAElFTkSuQmCC')\",\n                \"backgroundSize\": \"cover\",\n                \"display\": \"block\"\n              }\n            }}></span>{`\n  `}<img parentName=\"span\" {...{\n              \"className\": \"gatsby-resp-image-image\",\n              \"alt\": \"Tekton Pipeline with Trivy\",\n              \"title\": \"Tekton Pipeline with Trivy\",\n              \"src\": \"/ibm-gsi-cloudnative-journey/static/6f91f2c02d5eb188fc100fcadca86418/3cbba/06-tekton-pipeline-with-trivy.png\",\n              \"srcSet\": [\"/ibm-gsi-cloudnative-journey/static/6f91f2c02d5eb188fc100fcadca86418/7fc1e/06-tekton-pipeline-with-trivy.png 288w\", \"/ibm-gsi-cloudnative-journey/static/6f91f2c02d5eb188fc100fcadca86418/a5df1/06-tekton-pipeline-with-trivy.png 576w\", \"/ibm-gsi-cloudnative-journey/static/6f91f2c02d5eb188fc100fcadca86418/3cbba/06-tekton-pipeline-with-trivy.png 1152w\", \"/ibm-gsi-cloudnative-journey/static/6f91f2c02d5eb188fc100fcadca86418/0b124/06-tekton-pipeline-with-trivy.png 1728w\", \"/ibm-gsi-cloudnative-journey/static/6f91f2c02d5eb188fc100fcadca86418/ab251/06-tekton-pipeline-with-trivy.png 1936w\"],\n              \"sizes\": \"(max-width: 1152px) 100vw, 1152px\",\n              \"style\": {\n                \"width\": \"100%\",\n                \"height\": \"100%\",\n                \"margin\": \"0\",\n                \"verticalAlign\": \"middle\",\n                \"position\": \"absolute\",\n                \"top\": \"0\",\n                \"left\": \"0\"\n              },\n              \"loading\": \"lazy\"\n            }}></img>{`\n    `}</span></p>\n        <h4>{`build`}</h4>\n        <p>{`The build image will build the image.`}</p>\n        <h4>{`image-scan`}</h4>\n        <p>{`Image scan will scan the image and print the Vulnerability count as Low, Medium, High and Critical.\nBased on the configured exit criteria (0 Critical) the next step would in the pipeline will continue.`}</p>\n        <h4>{`push`}</h4>\n        <p>{`After the scan is completed, it Pushes the image to the Image Registry.`}</p>\n        <p>{`The pipeline scripts are defined as Task in the yaml file. lets us see the changes done in the task file.`}</p>\n        <h2>{`Tekton Task Changes`}</h2>\n        <h3>{`Declaration`}</h3>\n        <p>{`Add the below code code snippet as declaration about the Trivy image in the `}<inlineCode parentName=\"p\">{`Task`}</inlineCode></p>\n        <pre><code parentName=\"pre\" {...{}}>{`    - default: docker.io/aquasec/trivy\n      name: trivy\n      type: string     \n`}</code></pre>\n        <ul>\n          <li parentName=\"ul\">{`After adding the Task code should be like this.`}</li>\n          <li parentName=\"ul\">{`Replace the namespace `}<inlineCode parentName=\"li\">{`dev-gan2`}</inlineCode>{`, with your project namespace.`}</li>\n        </ul>\n        <pre><code parentName=\"pre\" {...{}}>{`apiVersion: tekton.dev/v1alpha1\nkind: Task\nmetadata:\n  name: igc-build-tag-push-v1-2-0\n  namespace: dev-gan2\nspec:\n  inputs:\n    params:\n    - default: docker.io/node:12-stretch\n      name: js-image\n      type: string\n    - default: quay.io/buildah/stable:v1.11.0\n      name: BUILDER_IMAGE\n      type: string\n    - default: docker.io/aquasec/trivy\n      name: trivy\n      type: string      \n    - default: ./Dockerfile\n      name: DOCKERFILE\n      type: string\n    - default: .\n      name: CONTEXT\n      type: string\n    - default: \"false\"\n      name: TLSVERIFY\n      type: string\n    resources:\n    - name: source\n      type: git\n`}</code></pre>\n        <h3>{`Build Image`}</h3>\n        <p>{`Add the below code snippet in the `}<inlineCode parentName=\"p\">{`Task`}</inlineCode>{` for building image`}</p>\n        <pre><code parentName=\"pre\" {...{}}>{`  - args:\n    - -c\n    - |\n      set -e\n\n      . ./env-config\n\n      IMAGE_URL=$(outputs.resources.image.url)\n\n      REGISTRY_URL=$(echo $IMAGE_URL | awk -F / '{print $1}')\n      REGISTRY_NAMESPACE=$(echo $IMAGE_URL | awk -F / '{print $2}')\n\n      APP_IMAGE=\"\\${REGISTRY_URL}/\\${REGISTRY_NAMESPACE}/\\${IMAGE_NAME}-temp:\\${IMAGE_VERSION}\"\n\n      buildah bud --tls-verify=$(inputs.params.TLSVERIFY) --format=docker -f $(inputs.params.DOCKERFILE) -t \\${APP_IMAGE}  $(inputs.params.CONTEXT)\n      if [[ -n \"\\${REGISTRY_USER}\" ]] && [[ -n \"\\${REGISTRY_PASSWORD}\" ]]; then\n        buildah login -u \"\\${REGISTRY_USER}\" -p \"\\${REGISTRY_PASSWORD}\" \"\\${REGISTRY_URL}\"\n      fi\n      buildah push --tls-verify=$(inputs.params.TLSVERIFY) \"\\${APP_IMAGE}\" \"docker://\\${APP_IMAGE}\"\n    command:\n    - /bin/bash\n    env:\n    - name: REGISTRY_USER\n      valueFrom:\n        secretKeyRef:\n          key: REGISTRY_USER\n          name: ibmcloud-apikey\n          optional: true\n    - name: REGISTRY_PASSWORD\n      valueFrom:\n        secretKeyRef:\n          key: APIKEY\n          name: ibmcloud-apikey\n          optional: true\n    image: $(inputs.params.BUILDER_IMAGE)\n    name: build\n    resources: {}\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: /var/lib/containers\n      name: varlibcontainers\n    workingDir: $(inputs.resources.source.path)\n\n`}</code></pre>\n        <ol>\n          <li parentName=\"ol\">{`Temp image is build using `}<inlineCode parentName=\"li\">{`buildah`}</inlineCode></li>\n          <li parentName=\"ol\">{`Login into IBM Cloud Container Registry using `}<inlineCode parentName=\"li\">{`buildah`}</inlineCode>{`.`}</li>\n          <li parentName=\"ol\">{`Temp image is pushed to IBM Cloud Container Registry using `}<inlineCode parentName=\"li\">{`buildah`}</inlineCode>{`.`}</li>\n          <li parentName=\"ol\">{`env `}<inlineCode parentName=\"li\">{`REGISTRY_USER`}</inlineCode>{` contains Username details to Login into IBM Cloud Container Registry.`}</li>\n          <li parentName=\"ol\">{`env `}<inlineCode parentName=\"li\">{`REGISTRY_PASSWORD`}</inlineCode>{` contains Password details to Login into IBM Cloud Container Registry.`}</li>\n          <li parentName=\"ol\"><inlineCode parentName=\"li\">{`name: build`}</inlineCode>{` refers the name of the step`}</li>\n        </ol>\n        <h3>{`Image Scan`}</h3>\n        <p>{`Add the below code code snippet in the `}<inlineCode parentName=\"p\">{`Task`}</inlineCode>{` for trivy scanning.`}</p>\n        <pre><code parentName=\"pre\" {...{}}>{`  - args:\n    - -c\n    - |\n      set -e\n\n      . ./env-config\n\n      IMAGE_URL=$(outputs.resources.image.url)\n\n      REGISTRY_URL=$(echo $IMAGE_URL | awk -F / '{print $1}')\n      REGISTRY_NAMESPACE=$(echo $IMAGE_URL | awk -F / '{print $2}')\n\n      APP_IMAGE=\"\\${REGISTRY_URL}/\\${REGISTRY_NAMESPACE}/\\${IMAGE_NAME}-temp:\\${IMAGE_VERSION}\"\n\n      export TRIVY_AUTH_URL=\\${REGISTRY_URL}\n      export TRIVY_USERNAME=\\${REGISTRY_USER}\n      export TRIVY_PASSWORD=\\${REGISTRY_PASSWORD}\n\n      echo \"Trivy image scanning.... $APP_IMAGE\"\n\n      # Trivy scan\n      trivy --exit-code 1 --severity CRITICAL \\${APP_IMAGE}\n      #trivy \\${APP_IMAGE_Temp}\n\n      # Check scan results\n      my_exit_code=$?\n      echo \"scan exit code : $my_exit_code\"\n      if [ \\${my_exit_code} == 1 ]; then\n          echo \"Image scanning failed. Some vulnerabilities found\"\n          exit 1;\n      else\n          echo \"Image is scanned Successfully. No vulnerabilities found\"\n      fi;\n    command:\n    - /bin/bash\n    env:\n    - name: REGISTRY_USER\n      valueFrom:\n        secretKeyRef:\n          key: REGISTRY_USER\n          name: ibmcloud-apikey\n          optional: true\n    - name: REGISTRY_PASSWORD\n      valueFrom:\n        secretKeyRef:\n          key: APIKEY\n          name: ibmcloud-apikey\n          optional: true\n    image: $(inputs.params.trivy)\n    name: image-scan\n    resources: {}\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: /var/lib/containers\n      name: varlibcontainers\n    workingDir: $(inputs.resources.source.path)\n\n`}</code></pre>\n        <ol>\n          <li parentName=\"ol\">\n            <p parentName=\"li\">{`The temporary image is scanned here.`}</p>\n          </li>\n          <li parentName=\"ol\">\n            <p parentName=\"li\"><inlineCode parentName=\"p\">{`TRIVY_AUTH_URL,`}</inlineCode>{` `}<inlineCode parentName=\"p\">{`TRIVY_USERNAME`}</inlineCode>{`, `}<inlineCode parentName=\"p\">{`TRIVY_PASSWORD`}</inlineCode>{` refers the Registry URL and user details to login into IBM Cloud Container Registry by trivy.`}</p>\n          </li>\n          <li parentName=\"ol\">\n            <p parentName=\"li\"><inlineCode parentName=\"p\">{`trivy --exit-code 1 --severity CRITICAL \\${APP_IMAGE_Temp}`}</inlineCode>{` - step scans the temp image available in the IBM Cloud Container Registry.`}</p>\n          </li>\n          <li parentName=\"ol\">\n            <p parentName=\"li\">{`The step stops and then the pipeline also stops when there is a CRITICAL issue found.`}</p>\n          </li>\n          <li parentName=\"ol\">\n            <p parentName=\"li\">{`If you don’t want to stop the pipeline though the CRITICAL issue is found then replace the above triy scan line with `}<inlineCode parentName=\"p\">{`trivy \\${APP_IMAGE_Temp}`}</inlineCode>{`.`}</p>\n          </li>\n          <li parentName=\"ol\">\n            <p parentName=\"li\">{`The scan results will be printed in the console.`}</p>\n          </li>\n        </ol>\n        <h3>{`Push Image`}</h3>\n        <p>{`Add the below code code snippet in the `}<inlineCode parentName=\"p\">{`Task`}</inlineCode>{` for pushing image.`}</p>\n        <pre><code parentName=\"pre\" {...{}}>{`  - args:\n    - -c\n    - |\n      set -e\n      . ./env-config\n\n      IMAGE_URL=$(outputs.resources.image.url)\n\n      REGISTRY_URL=$(echo $IMAGE_URL | awk -F / '{print $1}')\n      REGISTRY_NAMESPACE=$(echo $IMAGE_URL | awk -F / '{print $2}')\n\n      APP_IMAGE=\"\\${REGISTRY_URL}/\\${REGISTRY_NAMESPACE}/\\${IMAGE_NAME}:\\${IMAGE_VERSION}\"\n      APP_IMAGE_Temp=\"\\${REGISTRY_URL}/\\${REGISTRY_NAMESPACE}/\\${IMAGE_NAME}-temp:\\${IMAGE_VERSION}\"\n\n      if [[ -n \"\\${REGISTRY_USER}\" ]] && [[ -n \"\\${REGISTRY_PASSWORD}\" ]]; then\n          buildah login -u \"\\${REGISTRY_USER}\" -p \"\\${REGISTRY_PASSWORD}\" \"\\${REGISTRY_URL}\"\n      fi\n\n      buildah pull \\${APP_IMAGE_Temp}\n      buildah tag \\${APP_IMAGE_Temp} \\${APP_IMAGE}\n      buildah push --tls-verify=\\${TLSVERIFY} \"\\${APP_IMAGE}\" \"docker://\\${APP_IMAGE}\"\n      buildah rmi \\${APP_IMAGE_Temp}\n    command:\n    - /bin/bash\n    env:\n    - name: REGISTRY_USER\n      valueFrom:\n        secretKeyRef:\n          key: REGISTRY_USER\n          name: ibmcloud-apikey\n          optional: true\n    - name: REGISTRY_PASSWORD\n      valueFrom:\n        secretKeyRef:\n          key: APIKEY\n          name: ibmcloud-apikey\n          optional: true\n    image: $(inputs.params.BUILDER_IMAGE)\n    name: push\n    resources: {}\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: /var/lib/containers\n      name: varlibcontainers\n    workingDir: $(inputs.resources.source.path)\n\n`}</code></pre>\n        <p>{`The code snippet does the followings.`}</p>\n        <ol>\n          <li parentName=\"ol\">\n            <p parentName=\"li\">{`Login into IBM Cloud Container Registry using `}<inlineCode parentName=\"p\">{`buildah`}</inlineCode>{`.`}</p>\n          </li>\n          <li parentName=\"ol\">\n            <p parentName=\"li\">{`Pull the temp image using `}<inlineCode parentName=\"p\">{`buildah`}</inlineCode>{`.`}</p>\n          </li>\n          <li parentName=\"ol\">\n            <p parentName=\"li\">{`Tag the image to the actual image name.`}</p>\n          </li>\n          <li parentName=\"ol\">\n            <p parentName=\"li\">{`Push the actual image to IBM Cloud Container Registry using `}<inlineCode parentName=\"p\">{`buildah`}</inlineCode>{`.`}</p>\n          </li>\n          <li parentName=\"ol\">\n            <p parentName=\"li\">{`Remove the temp image from IBM Cloud Container Registry using `}<inlineCode parentName=\"p\">{`buildah`}</inlineCode>{`.`}</p>\n          </li>\n        </ol>\n      </Tab>\n    </Tabs>\n\n    </MDXLayout>;\n}\n;\nMDXContent.isMDXComponent = true;\n      "],"sourceRoot":""}