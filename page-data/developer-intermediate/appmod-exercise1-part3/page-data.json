{"componentChunkName":"component---src-pages-developer-intermediate-appmod-exercise-1-part-3-index-mdx","path":"/developer-intermediate/appmod-exercise1-part3/","result":{"pageContext":{"frontmatter":{"title":"Migrate to Openshift"},"relativePagePath":"/developer-intermediate/appmod-exercise1-part3/index.mdx","titleType":"page","MdxNode":{"id":"1fd95bd9-9658-5763-b4ac-4816379158c8","children":[],"parent":"0ed61749-1e08-5251-bf48-1cbec48e4b9f","internal":{"content":"---\ntitle: Migrate to Openshift \n---\n\nimport Globals from 'gatsby-theme-carbon/src/templates/Globals';\n\n<PageDescription>\n\n## **Migrate Application to Liberty Container on IBM Cloud**\n\n</PageDescription>\n\n\n\n**Recap : ** \n\nAs part of the Transformation Advisor : Part 2 - Analyse the scan results, we covered\n\n1. Uploading the scanned results to the Transformation Advisor \n1. Transformation Advisor generates the recommendations and reports based on the scanned results\n1. Analyzed the Technology report, Inventory report and Analysis report of the existing application to see the fitment for migration.\n\n\n\n\n### Migrate to Liberty\n\nAs part of this session, we will start with preparation stage of the existing application to container based stack on IBM Cloud using the Transformation advisor. As in the previous part, navigate to your workspace in the Transformation Advisor that is already created earlier.\n\nTransformation Advisor creates some accelerators to speed up the process of migrating an application. These files are a starting point for most modernization journeys and require modification. In this section, you will modify those files for PlantsByWebSphere.\n\n- From the main recommendations page, click the `...` link on the right for the `PlantsByWebSphere8.ear` and select View migration plan\n\n- You will Navigate to the Migration Bundle Page of the Transformation Advisor\n\n![pbw](images/ta-migration-repo.png)\n\n- Select the Build type as binary\n\n- Ensure \"Don't use\" is selected for the \"Use Accelerator for Teams Collection\"\n\n- Select Manual upload for \"application Dependencies\"\n\n    - As per the application dependencies select the application binary and the db2 driver(db2jcc.jar) that we have downloaded earlier\n\n- The migration files section show the below bundle\n\n    ![pbw](images/ta-bindle.png)\n\n    The migration plan shows the files that Transformation Advisor has generated:\n    - **server.xml** - Transformation Advisor extracts most of the configuration from traditional WebSphere and generates a server.xml for Liberty to use\n    - **Dockerfile** - Used to create the Docker image, which includes the application and configuration for Liberty\n    - **Operator resources** - Used in Red Hat OpenShift to deploy the application using the [Open Liberty operator](https://operatorhub.io/operator/open-liberty)\n    - **pom.xml** - Used for Maven builds, particularly useful if the application does not already employ build scripts\n\n- We will push the Transformation generated files along with the Application binary and Db2-jcc.jar file to the git repo. \n\n- To do previous step, \n    - First we will create a new repository in your public git hub. Let us name the repository as \"ta-appmodern-migrate\"\n\n    - Copy the Https Url of your repository,\n    'https://github.com/{username}/ta-appmodern-migrate.git'\n\n   - Use this git repository in your Transformation Migration \n    \n   - Once this is done, select the \"send to git option\" in the \"Migration Bundle Page\" to push the migration files to your git repository\n\n\n- we need to edit the server.xml to change the database properties and the db2jcc_licence_cu.jar. so lets clone the git repo to the local system\n\n    ```bash\n    git clone 'https://github.com/{user}/ta-appmodern-migrate.git'\n    ```\n\n\n- Copy `db2jcc_licence_cu.jar` to the folder `src/main/liberty/binary/lib`  from you earlier download folder of the binaries '(https://github.com/ibm-gsi-ecosystem/appmod-plants-app.git)'.\n\nIdeally, Transformation Advisor could figure out enough from the original application so that the generated files contain exactly what's needed and we could use these files as-is. Unfortunately, there are some details Transformation Advisor cannot discern, so we'll need to add those into the files manually.\n\nEdit the `server.xml` file using your favorite editor to make the following changes:\n\n\n\n**Note:**\n\nThe db2 service provisioned in the IBM cloud shall be used as the database. Access the db2 service and navigate to the \"Service Credentials Tab\" to retrieve the database information listed below:\n1. User name\n1. password\n1. db name\n1. db host name\n1. db port\n\n\n\n- Change the `jpa-2.1` feature to `jpa-2.0`\n\n- Add health feature, to enable the health check task to be passed in the pipeline\n    ```bash\n    <feature>mpHealth-1.0</feature> \n    ```\n- Uncomment the `dataSources` and `jdbcDrivers`\n\n- As part of the server.xml, there are two references to jdbcDriver. Each reference will map the path of the db2 and db2 licence jar  locations as `${shared.config.dir}/lib/global/db2jcc.jar` and `${shared.config.dir}/lib/global/db2jcc_license_cu.jar`. While one of jdbcDrive id is mapped to `DB2_Universal_JDBC_Driver_Provider` and the second is mapped to `DB2_Universal_JDBC_Driver_Provider_(XA)`.  The jdbcDriver tag snipped should be like as below \n\n    ```bash \n    <jdbcDriver id=\"DB2_Universal_JDBC_Driver_Provider\" javax.sql.DataSource=\"com.ibm.db2.jcc.DB2ConnectionPoolDataSource\">\n        <library>\n            <file name=\"${shared.config.dir}/lib/global/db2jcc.jar\"/>\n            <file name=\"${shared.config.dir}/lib/global/db2jcc_license_cu.jar\"/>\n        </library>\n    </jdbcDriver>\n    <jdbcDriver id=\"DB2_Universal_JDBC_Driver_Provider_(XA)\" javax.sql.DataSource=\"com.ibm.db2.jcc.DB2XADataSource\">\n        <library>\n            <file name=\"${shared.config.dir}/lib/global/db2jcc.jar\"/>\n            <file name=\"${shared.config.dir}/lib/global/db2jcc_license_cu.jar\"/>\n        </library>\n    </jdbcDriver>\n    ```        \n\n\n- server.xml will have two reference of `datasource` tag. Each will have an element named jdbcDriverRefs. change the jdbcDriverRefs for first one as 'DB2_Universal_JDBC_Driver_Provider' and for the second one as `DB2_Universal_JDBC_Driver_Provider_(XA)`\n\n- In the `PlantsByWebSphereDataSourceNONJTA` datasource, in the `properties.db2.jcc` line, add `user=\"{to share}\" password=\"{to share}\" transactional=\"false\"`\n\n- In the `PlantsByWebSphereDataSource` datasource, in the `properties.db2.jcc` line, add `user=\"{to share}\" password=\"{to share}\" transactional=\"true\"` (Database user name and password).  \n\n- Also change the databaseName=\"{to share}\", serverName=\"{to share}\" and portNumber=\"{to share}\" \n\n- After changing the datasource tag with jdbcDriverRefs, username & password, Database details (databaseName, serverName and portNumber), the dataSource snipped should like as below:\n    \n     ```bash \n    DATASOURCE FIRST REFERENCE:\n\n    <dataSource containerAuthDataRef=\"DefaultNode01/PlantsAuthAlias\" id=\"PlantsByWebSphereDataSourceNONJTA\" jdbcDriverRef=\"DB2_Universal_JDBC_Driver_Provider\" jndiName=\"jdbc/PlantsByWebSphereDataSourceNONJTA\">\n        <properties.db2.jcc password=\"????\" user=\"????\" beginTranForResultSetScrollingAPIs=\"false\" beginTranForVendorAPIs=\"false\" connectionSharing=\"1\" databaseName=\"????\" enableClientInformation=\"false\" enableMultithreadedAccessDetection=\"false\" errorDetectionModel=\"ExceptionMapping\" jmsOnePhaseOptimization=\"false\" name=\"PlantsByWebSphereDataSourceNONJTA\" nonTransactionalDataSource=\"false\" portNumber=\"?????\" preTestSQLString=\"SELECT CURRENT SQLID FROM SYSIBM.SYSDUMMY1\" propagateClientIdentityUsingTrustedContext=\"false\" reauthentication=\"false\" retrieveMessagesFromServerOnGetMessage=\"true\" serverName=\"????\" traceLevel=\"-1\" unbindClientRerouteListFromJndi=\"false\" useTransactionRedirect=\"false\" validateNewConnection=\"false\" validateNewConnectionRetryCount=\"100\" validateNewConnectionRetryInterval=\"3\"/>\n        <connectionManager agedTimeout=\"0\" connectionTimeout=\"180\" maxIdleTime=\"1800\" maxPoolSize=\"10\" minPoolSize=\"0\" reapTime=\"180\"/>\n    </dataSource>\n\n    ```\n    **Note:*** ???? should be replaced by actual values\n    ```bash \n    DATASOURCE SECOND REFERENCE:\n\n    <dataSource containerAuthDataRef=\"DefaultNode01/PlantsAuthAlias\" id=\"PlantsByWebSphereDataSource\" jdbcDriverRef=\"DB2_Universal_JDBC_Driver_Provider_(XA)\" jndiName=\"jdbc/PlantsByWebSphereDataSource\">\n        <properties.db2.jcc password=\"????\" user=\"????\" beginTranForResultSetScrollingAPIs=\"false\" beginTranForVendorAPIs=\"false\" connectionSharing=\"1\" databaseName=\"????\" enableClientInformation=\"false\" enableMultithreadedAccessDetection=\"false\" errorDetectionModel=\"ExceptionMapping\" name=\"PlantsByWebSphereDataSource\" nonTransactionalDataSource=\"false\" portNumber=\"????\" preTestSQLString=\"SELECT CURRENT SQLID FROM SYSIBM.SYSDUMMY1\" propagateClientIdentityUsingTrustedContext=\"false\" reauthentication=\"false\" retrieveMessagesFromServerOnGetMessage=\"false\" serverName=\"????\" traceLevel=\"-1\" unbindClientRerouteListFromJndi=\"false\" useTransactionRedirect=\"false\" validateNewConnection=\"false\" validateNewConnectionRetryCount=\"100\" validateNewConnectionRetryInterval=\"3\"/>\n        <connectionManager agedTimeout=\"0\" connectionTimeout=\"180\" maxIdleTime=\"1800\" maxPoolSize=\"10\" minPoolSize=\"0\" reapTime=\"180\"/>\n    </dataSource>\n\n    ```\n\n- Validate the application tag to be \n    \n    ```bash\n    <application id=\"PlantsByWebSphere8\" location=\"plantsbywebsphere8.ear\" name=\"PlantsByWebSphere8\" type=\"ear\"/>\n    ```\n\n- Save your changes\n\n- Reference server.xml with the changes is also available in the downloaded reference repo '(https://github.com/ibm-gsi-ecosystem/appmod-plants-app.git)’. The location is liberty/config/server.xml.  The database details marked in ???? has to be replaced by the actual database info.\n\n- The modified `server.xml` should look like this:\n   ```\n    <?xml version=\"1.0\" encoding=\"UTF-8\"?><!--Generated by IBM TransformationAdvisor\n    Thu Nov 21 20:49:39 GMT 2019--><server>\n    <!--These elements have been identified from this application's configuration.-->\n    <featureManager>\n        <feature>beanValidation-1.1</feature>\n        <feature>cdi-1.2</feature>\n        <feature>ejbLite-3.2</feature>\n        <feature>el-3.0</feature>\n        <feature>javaMail-1.5</feature>\n        <feature>jndi-1.0</feature>\n        <feature>jpa-2.0</feature>\n        <feature>jsf-2.2</feature>\n        <feature>jsp-2.3</feature>\n        <feature>servlet-3.1</feature>\n        <feature>mpHealth-1.0</feature>\n    </featureManager>\n    <!-- <variable name=\"DERBY_JDBC_DRIVER_PATH\" value=\"${WAS_INSTALL_ROOT}/derby/lib\"/> -->\n    <httpEndpoint host=\"*\" httpPort=\"9080\" httpsPort=\"9443\" id=\"defaultHttpEndpoint\"/>\n    <!-- <variable name=\"DB2UNIVERSAL_JDBC_DRIVER_NATIVEPATH\" value=\"\"/> -->\n    <variable name=\"DERBY_JDBC_DRIVER_PATH\" value=\"${shared.config.dir}/lib/global\"/>\n    <variable name=\"DB2UNIVERSAL_JDBC_DRIVER_NATIVEPATH\" value=\"${shared.config.dir}/lib/global\"/>\n    <applicationManager autoExpand=\"true\"/>\n    <!--These elements are from the profile level configuration. Not all of them may be necessary for your application.-->\n    <dataSource containerAuthDataRef=\"DefaultNode01/PlantsAuthAlias\" id=\"PlantsByWebSphereDataSourceNONJTA\" jdbcDriverRef=\"DB2_Universal_JDBC_Driver_Provider\" jndiName=\"jdbc/PlantsByWebSphereDataSourceNONJTA\">\n        <properties.db2.jcc user=\"db2inst1\" password=\"db2Pa2359w0rd123\" transactional=\"false\" beginTranForResultSetScrollingAPIs=\"false\" beginTranForVendorAPIs=\"false\" connectionSharing=\"1\" databaseName=\"PLANTSDB\" enableClientInformation=\"false\" enableMultithreadedAccessDetection=\"false\" errorDetectionModel=\"ExceptionMapping\" jmsOnePhaseOptimization=\"false\" name=\"PlantsByWebSphereDataSourceNONJTA\" nonTransactionalDataSource=\"false\" portNumber=\"32612\" preTestSQLString=\"SELECT CURRENT SQLID FROM SYSIBM.SYSDUMMY1\" propagateClientIdentityUsingTrustedContext=\"false\" reauthentication=\"false\" retrieveMessagesFromServerOnGetMessage=\"true\" serverName=\"169.62.104.36\" traceLevel=\"-1\" unbindClientRerouteListFromJndi=\"false\" useTransactionRedirect=\"false\" validateNewConnection=\"false\" validateNewConnectionRetryCount=\"100\" validateNewConnectionRetryInterval=\"3\"/>\n        <connectionManager agedTimeout=\"0\" connectionTimeout=\"180\" maxIdleTime=\"1800\" maxPoolSize=\"10\" minPoolSize=\"0\" reapTime=\"180\"/>\n    </dataSource>\n    <dataSource containerAuthDataRef=\"DefaultNode01/PlantsAuthAlias\" id=\"PlantsByWebSphereDataSource\" jdbcDriverRef=\"DB2_Universal_JDBC_Driver_Provider_(XA)\" jndiName=\"jdbc/PlantsByWebSphereDataSource\">\n        <properties.db2.jcc user=\"db2inst1\" password=\"db2Pa2359w0rd123\" transactional=\"true\" beginTranForResultSetScrollingAPIs=\"false\" beginTranForVendorAPIs=\"false\" connectionSharing=\"1\" databaseName=\"PLANTSDB\" enableClientInformation=\"false\" enableMultithreadedAccessDetection=\"false\" errorDetectionModel=\"ExceptionMapping\" name=\"PlantsByWebSphereDataSource\" nonTransactionalDataSource=\"false\" portNumber=\"32612\" preTestSQLString=\"SELECT CURRENT SQLID FROM SYSIBM.SYSDUMMY1\" propagateClientIdentityUsingTrustedContext=\"false\" reauthentication=\"false\" retrieveMessagesFromServerOnGetMessage=\"false\" serverName=\"169.62.104.36\" traceLevel=\"-1\" unbindClientRerouteListFromJndi=\"false\" useTransactionRedirect=\"false\" validateNewConnection=\"false\" validateNewConnectionRetryCount=\"100\" validateNewConnectionRetryInterval=\"3\"/>\n        <connectionManager agedTimeout=\"0\" connectionTimeout=\"180\" maxIdleTime=\"1800\" maxPoolSize=\"10\" minPoolSize=\"0\" reapTime=\"180\"/>\n    </dataSource>\n    <jdbcDriver id=\"DB2_Universal_JDBC_Driver_Provider\" javax.sql.DataSource=\"com.ibm.db2.jcc.DB2ConnectionPoolDataSource\">\n        <library>\n            <file name=\"/config/lib/db2jcc.jar\"/>\n            <file name=\"/config/lib/db2jcc_license_cu.jar\"/>\n        </library>\n    </jdbcDriver>\n    <jdbcDriver id=\"DB2_Universal_JDBC_Driver_Provider_(XA)\" javax.sql.DataSource=\"com.ibm.db2.jcc.DB2XADataSource\">\n        <library>\n            <file name=\"/config/lib/db2jcc.jar\"/>\n            <file name=\"/config/lib/db2jcc_license_cu.jar\"/>\n        </library>\n    </jdbcDriver>\n    <authData id=\"DefaultNode01/PlantsAuthAlias\" password=\"???\" user=\"db2inst1\"/>\n    <application id=\"PlantsByWebSphere8\" location=\"plantsbywebsphere8.ear\" name=\"PlantsByWebSphere8\" type=\"ear\"/>\n    </server>\n    ```\n\n- Push the change to Git (server.xml and db2jcc_license_cu.jar)\n    ```bash\n    git add .\n    git commit -m \"Changes related to DB -server.xml and db2jcc_license_cu.jar\"\n    git push\n    ```\n\n\nNow that we've configured Liberty and the application, let's deploy it on the Openshift.\n\n\n### Run the application on Liberty\n\n<Tabs>\n\n<Tab label=\"oc pipeline\" open=\"true\">\n\nAs we plan to use the Tekton pipeline to deploy the application to the Openshift environment, we need additional files to be copied. \n\n- Copy charts (folder) to your base directory from the earlier downloaded/clone repository '(https://github.com/ibm-gsi-ecosystem/appmod-plants-app.git)'. This Contains the files related to pipeline deployment configuration.\n\n- Copy assets (folder) to your base directory from the earlier downloaded/clone repository '(https://github.com/ibm-gsi-ecosystem/appmod-plants-app.git)'. This Contains the Binaries of both the application and Db2 related, in a structured manner, that shall be used by the pom.xml during the maven build as part of the test stage in the pipeline.\n\n- Copy Jenkinsfile (file) to your base directory from the earlier downloaded/clone repository '(https://github.com/ibm-gsi-ecosystem/appmod-plants-app.git)'. This Contains the definition to the pipeline using the javalibertyapp image\n\n- Copy pom.xml (file) to your base directory from the earlier downloaded/clone repository '(https://github.com/ibm-gsi-ecosystem/appmod-plants-app.git)'. The original pom.xml generated by TA will be replaced by this pom.file. This file uses the websphere liberty container as runtime environment, since this application would need JPA2.0 supported environment for database access.\n\n- TA generated pom will look like as below\n\n   ```bash\n    <!-- Generated by IBM TransformationAdvisor -->\n    <!-- Wed May 13 10:33:04 UTC 2020 -->\n    <project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n        <modelVersion>4.0.0</modelVersion>\n\n        <groupId>com.ibm.ta</groupId>\n        <artifactId>plantsbywebsphere8</artifactId>\n        <version>1.0.0</version>\n        <packaging>war</packaging>\n\n        <name>plantsbywebsphere8</name>\n        <dependencies>\n            <dependency>\n                <groupId>junit</groupId>\n                <artifactId>junit</artifactId>\n                <version>4.8.2</version>\n                <scope>test</scope>\n            </dependency>\n        </dependencies>\n\n  \n    </project>\n   ```\n\n- Replaced pom for the pipeline to use websphere liberty is as below\n\n    ```bash\n    <project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n        <modelVersion>4.0.0</modelVersion>\n\n        <parent>\n            <groupId>net.wasdev.wlp.maven.parent</groupId>\n            <artifactId>liberty-maven-app-parent</artifactId>\n            <version>RELEASE</version>\n        </parent>\n\n        <groupId>com.ibm.ta</groupId>\n        <artifactId>tamigration</artifactId>\n        <version>1.0</version>\n        <packaging>war</packaging>\n        <properties>\n            <file.repo.name>assets</file.repo.name>\n        </properties>\n\n        <repositories>\n            <!--local migration assets repo-->\n            <repository>\n                <id>project.local</id>\n                <name>project</name>\n                <url>file:${project.basedir}/${file.repo.name}</url>\n            </repository>\n        </repositories>\n        <dependencies>\n        <!-- example of adding a war file dependency -->\n            <dependency>\n                <groupId>com.ibm.ta</groupId>\n                <artifactId>plantsbywebsphere8</artifactId>\n                <version>0.1</version>\n                <type>ear</type>\n            </dependency>\n            <dependency>\n                <groupId>com.ibm.ta</groupId>\n                <artifactId>db2jcclicensecu</artifactId>\n                <version>0.1</version>\n                <type>jar</type>\n            </dependency>\n            <dependency>\n                <groupId>com.ibm.ta</groupId>\n                <artifactId>db2jcc</artifactId>\n                <version>0.1</version>\n                <type>jar</type>\n            </dependency>\n        </dependencies>\n        <build>\n            <finalName>${project.artifactId}</finalName>\n            <plugins>\n                <plugin>\n                    <groupId>org.apache.maven.plugins</groupId>\n                    <artifactId>maven-dependency-plugin</artifactId>\n                    <version>3.1.2</version>\n                    <executions>\n\n                        <execution>\n                            <id>copy-application-dependency</id>\n                            <phase>generate-sources</phase>\n                            <goals>\n                                <goal>copy-dependencies</goal>\n                            </goals>\n                            <configuration>\n                            <!-- put war dependency file in target after dependency resolution -->\n                                <outputDirectory>${project.build.directory}</outputDirectory>\n                                <overWriteReleases>false</overWriteReleases>\n                                <overWriteSnapshots>true</overWriteSnapshots>\n                                <excludeTransitive>true</excludeTransitive>\n                                <includeTypes>ear</includeTypes>\n                            </configuration>\n                        </execution>\n\n                        <execution>\n                            <id>copy-shared-library-artifact-db2jcclicensecu</id>\n                            <phase>package</phase>\n                            <goals>\n                                <goal>copy-dependencies</goal>\n                            </goals>\n                            <configuration>\n                            <!--   <outputDirectory>${project.build.directory}/liberty/wlp/usr/servers/defaultServer/lib/global</outputDirectory> -->\n                                <outputDirectory>${project.build.directory}/liberty/wlp/usr/shared/config/lib/global</outputDirectory> \n                                <includeGroupIds>com.ibm.ta</includeGroupIds>\n                                <includeArtifactIds>db2jcclicensecu</includeArtifactIds>\n                                <includeTypes>jar</includeTypes>\n                            </configuration>\n                        </execution>\n\n                        <execution>\n                            <id>copy-shared-library-artifact-db2jcc</id>\n                            <phase>package</phase>\n                            <goals>\n                                <goal>copy-dependencies</goal>\n                            </goals>\n                            <configuration>\n                            <!--<outputDirectory>${project.build.directory}/liberty/wlp/usr/servers/defaultServer/lib/global</outputDirectory>-->\n                                <outputDirectory>${project.build.directory}/liberty/wlp/usr/shared/config/lib/global</outputDirectory>\n                                <includeGroupIds>com.ibm.ta</includeGroupIds>\n                                <includeArtifactIds>db2jcc</includeArtifactIds>\n                                <includeTypes>jar</includeTypes>\n                            </configuration>\n                        </execution>\n\n                    </executions>\n                </plugin>\n\n                <plugin>\n                    <groupId>org.apache.maven.plugins</groupId>\n                    <artifactId>maven-war-plugin</artifactId>\n                    <version>3.2.2</version>\n                    <configuration>\n                        <failOnMissingWebXml>false</failOnMissingWebXml>\n                        <packagingExcludes>pom.xml</packagingExcludes>\n                        <skip>true</skip>\n                    </configuration>\n                </plugin>\n\n                <plugin>\n                    <groupId>net.wasdev.wlp.maven.plugins</groupId>\n                    <artifactId>liberty-maven-plugin</artifactId>\n                    <configuration>\n                        <!-- adding for was liberty -start-->\n                        <assemblyArtifact>\n                            <groupId>com.ibm.websphere.appserver.runtime</groupId>\n                            <artifactId>wlp-javaee7</artifactId>\n                            <version>RELEASE</version>\n                            <type>zip</type>\n                        </assemblyArtifact>\n                        <stripVersion>true</stripVersion>\n                        <serverStartTimeout>120</serverStartTimeout>\n                        <configFile>src/main/liberty/config/server.xml</configFile>\n                        <bootstrapProperties>\n                            <default.http.port>${http.port}</default.http.port>\n                            <default.https.port>${https.port}</default.https.port>\n                            <app.context.root>${app.name}</app.context.root>\n                        </bootstrapProperties>\n                    </configuration>\n\n                    <executions>\n                        <execution>\n                            <id>package-server</id>\n                            <configuration>\n                            <outputDirectory>target/wlp-package</outputDirectory>\n                            </configuration>\n                        </execution>\n                    </executions>\n                \n                </plugin>\n            </plugins>\n        </build>\n  \n    </project>\n    ```\n\n- Push the change to Git (file related to pipeline)\n    ```bash\n    git add .\n    git commit -m \"Changes related to Enablement of the pipeline deployment\"\n    git push\n    ```\n\nNow that we are ready for the application deployment on the Openshift cluster, we will here follow the pipeline approach for the build and deployment. Let us use the Cloud Shell for the same\n\n- Login to your OC cluster using the Copy Login Command from the browser of the openshift console\n    ```bash\n    $ oc login {Cluster info}\n    $ oc project dev-{initial} \n    $ oc project -q  \n    \n    ```\n\n- Let us use igc pipeline to build and deploy. From the repository directory let us execute the oc sync command to configure your project environment in the openshift cluster\n\n    ```bash\n    $ oc sycn {your project} --dev\n\n    Setting up namespace {your project} and serviceAccount default\n\n    ```\n- Let us trigger the pipeline using the oc pipeline command from the same repo directory.  \n\n    - This would request you request for pipeline to select with options \n        - Jenkins\n        - Tekton\n    - Select the Tekton option\n   \n    - As the next step, to configure git repo for the pipeline, it would ask for the git \n        - username  (if not configured already for this project)\n        - Token/password (if not configured already for this project)\n        - branch (Press enter if branch is (master)) otherwise provide the branch details\n\n    - Next it would request for the \"Select the Pipeline to use in the PipelineRun\"\n        - Select the option : ibm-java-maven\n\n    - Next it would request for \"Would you like to enable the pipeline to scan the image for vulnerabilities\"\n        - Select Yes (if you want to include the image scan) /  No (if you don't want to include the image scan)\n        - In this case, we will go with the scan option as 'No'\n\n-  The output of the exection of oc pipeline as below\n    ```bash\n    $ oc pipeline\n\n    ? Select the type of pipeline that should be run? Tekton\n    Creating pipeline on openshift cluster in {your project} namespace\n    Getting git parameters\n    Git credentials have already been stored for user: {user name}\n    Project git repo: {your git repor}\n    ? Provide the git branch that should be used: master\n    Creating service account: pipeline\n    Creating Git PipelineResource\n    Creating Image PipelineResource\n    ? Select the Pipeline to use in the PipelineRun: ibm-java-maven\n    ? Would you like to enable the pipeline to scan the image for vulnerabilities? No\n    Copying tasks from tools\n    Copied Pipeline from tools/ibm-java-maven to {Openshift Project Name /Application Name}\n    Creating TriggerTemplate for pipeline: {Application Name}\n    Creating TriggerBinding for pipeline: {Application Name}\n    Creating TriggerEventListener for pipeline: {Application Name}\n    Creating Route for pipeline: {Application Name}\n    Creating PipelineRun for pipeline: {Application Name}\n    Creating webhook for repo: {github repo}\n\n    ```\n\n- This will create the project pipeline in {your project} and the pipeline will start executing. You can see the pipeline execution as part of the openshift dash board. \n\n    - Navigate to the Developer Console -> Navigate to the 'Pipelines' in the left Nav -> Select your project space from the drop down option -> select your application link -> Select the 'Pipeline Runs' and again the application link.\n\n![tekton-pipeline-runs](images/ta_pipelineruns_scan_no.png)\n\n- Once the pipeline is executed successfully, the application can be tested. To get the routes of the application first navigate to the \n\n    - Topology on the left nav -> Then click on your application. On the right side you should see the overview and resources -> navigate to the resources tab, you would be able to see the routes link. Using the routes link, test the application access\n    \n- Test the app\n\n    - Open the browser and navigate to the OpenShift dashboard console\n\n    - Navigate to the 'Topology' section in the left nav.\n\n    - Select your project/name-space and then select the Application. \n\n    - After selection of the application, on the right you will be able to see details of the application in tabs/sections as Overview and Resources\n\n    - As part of the Resource tab, you can get the routes of the application that shows two routes links.\n\n    - Click the link of the route with Path /PlantsByWebSphere\n\n    - You will be able to landup in the home page of the application\n\n    ![PlantsByLiberty](images/twas-pbw.jpg)\n\n\n</Tab>\n<Tab label=\"S2I\" open=\"true\">  \nNow that we are ready for the application deployment on the Openshift cluster, we will here follow the S2I (Source to Image approach) for the build and deployment. Let us use the Cloud Shell for the same.\n\n**Note:**\n\nEnsure you **don't copy** and push to the git, any of the below folders and files that are used by the pipeline from the reference repo ‘(https://github.com/ibm-gsi-ecosystem/appmod-plants-app.git)’.\n\n1. Copy charts (folder) \n1. Copy assets (folder)\n1. Copy Jenkinsfile (file) \n1. Copy pom.xml (file). Use only the default pom generated by the TA \n\n\nThe steps below will help to deploy the application to the cluster using S2I\n\n- Login to your OC cluster using the Copy Login Command from the browser of the openshift console\n    ```bash\n    oc login {Cluster info}\n    oc project dev-{initial} \n    oc project -q  \n    ```\n\n- Let us use openshift S2I to build and deploy\n\n    ```bash\n    oc new-app 'https://github.com/{repo}/ta-appmodern-migrate.git' --name=plantsbyliberty\n    .....\n    .....\n\n    --> Success\n        Build scheduled, use 'oc logs -f bc/plantsbyliberty' to track it progress\n        Application is not exposed. You can expose services to the outside world by \n    executing one or more of the commands below:\n          'oc expose svc/plantsbyliberty'\n        Run 'oc status' to view your app\n    ```\n\n\n\n- Check the logs to track the build and deployment. This will take few minutes to deploy\n    ```bash\n    oc logs -f bc/plantsbyliberty\n    ```\n\n    Once the deployment is completed, create the service for the application\n\n    ```bash\n    oc expose svc/plantsbyliberty\n    oc status\n    ```\n\n- If you need to redeploy the app after some changes, you can do this by manually triggering the below command\n    ```bash\n    oc start-build plantsbyliberty\n    ```\n\n\n- Now you can access the application by getting the hostname for the application by using get routes\n    ```bash\n    oc get routes | grep plantsbyliberty\n    ```\n\n- Test the app\n\n    - Open the browser and navigate to the OpenShift dashboard console\n\n    - Navigate to the 'Topology' section in the left nav.\n\n    - Select your project/name-space and then select the Application. \n\n    - After selection of the application, on the right you will be able to see details of the application in tabs/sections as Overview and Resources\n\n    - As part of the Resource tab, you can get the routes of the application.\n\n    - Click the link of the route  that you retrieved using \"oc get routes | grep plantsbyliberty\" \n    \n    - The route will open a new tab. Add the Path /PlantsByWebSphere at the end, to access the application\n\n    - You will be able to landup in the home page of the application\n\n    ![PlantsByLiberty](images/twas-pbw.jpg)\n\n</Tab>\n</Tabs>\n\n\n\n\nThat's it. You now have this application running on Liberty in a Docker container which is sufficient for this exercise.\n\n## Summary\n\nYou have now completed a simple Application Modernization exercises in multiple steps. This exercise demonstrated a simple runtime modernization scenario that can be moved to cloud without any code change to the application.\n","type":"Mdx","contentDigest":"b00fd9396fb7387fce5e4ad9ed4ec4f3","counter":980,"owner":"gatsby-plugin-mdx"},"frontmatter":{"title":"Migrate to Openshift"},"exports":{},"rawBody":"---\ntitle: Migrate to Openshift \n---\n\nimport Globals from 'gatsby-theme-carbon/src/templates/Globals';\n\n<PageDescription>\n\n## **Migrate Application to Liberty Container on IBM Cloud**\n\n</PageDescription>\n\n\n\n**Recap : ** \n\nAs part of the Transformation Advisor : Part 2 - Analyse the scan results, we covered\n\n1. Uploading the scanned results to the Transformation Advisor \n1. Transformation Advisor generates the recommendations and reports based on the scanned results\n1. Analyzed the Technology report, Inventory report and Analysis report of the existing application to see the fitment for migration.\n\n\n\n\n### Migrate to Liberty\n\nAs part of this session, we will start with preparation stage of the existing application to container based stack on IBM Cloud using the Transformation advisor. As in the previous part, navigate to your workspace in the Transformation Advisor that is already created earlier.\n\nTransformation Advisor creates some accelerators to speed up the process of migrating an application. These files are a starting point for most modernization journeys and require modification. In this section, you will modify those files for PlantsByWebSphere.\n\n- From the main recommendations page, click the `...` link on the right for the `PlantsByWebSphere8.ear` and select View migration plan\n\n- You will Navigate to the Migration Bundle Page of the Transformation Advisor\n\n![pbw](images/ta-migration-repo.png)\n\n- Select the Build type as binary\n\n- Ensure \"Don't use\" is selected for the \"Use Accelerator for Teams Collection\"\n\n- Select Manual upload for \"application Dependencies\"\n\n    - As per the application dependencies select the application binary and the db2 driver(db2jcc.jar) that we have downloaded earlier\n\n- The migration files section show the below bundle\n\n    ![pbw](images/ta-bindle.png)\n\n    The migration plan shows the files that Transformation Advisor has generated:\n    - **server.xml** - Transformation Advisor extracts most of the configuration from traditional WebSphere and generates a server.xml for Liberty to use\n    - **Dockerfile** - Used to create the Docker image, which includes the application and configuration for Liberty\n    - **Operator resources** - Used in Red Hat OpenShift to deploy the application using the [Open Liberty operator](https://operatorhub.io/operator/open-liberty)\n    - **pom.xml** - Used for Maven builds, particularly useful if the application does not already employ build scripts\n\n- We will push the Transformation generated files along with the Application binary and Db2-jcc.jar file to the git repo. \n\n- To do previous step, \n    - First we will create a new repository in your public git hub. Let us name the repository as \"ta-appmodern-migrate\"\n\n    - Copy the Https Url of your repository,\n    'https://github.com/{username}/ta-appmodern-migrate.git'\n\n   - Use this git repository in your Transformation Migration \n    \n   - Once this is done, select the \"send to git option\" in the \"Migration Bundle Page\" to push the migration files to your git repository\n\n\n- we need to edit the server.xml to change the database properties and the db2jcc_licence_cu.jar. so lets clone the git repo to the local system\n\n    ```bash\n    git clone 'https://github.com/{user}/ta-appmodern-migrate.git'\n    ```\n\n\n- Copy `db2jcc_licence_cu.jar` to the folder `src/main/liberty/binary/lib`  from you earlier download folder of the binaries '(https://github.com/ibm-gsi-ecosystem/appmod-plants-app.git)'.\n\nIdeally, Transformation Advisor could figure out enough from the original application so that the generated files contain exactly what's needed and we could use these files as-is. Unfortunately, there are some details Transformation Advisor cannot discern, so we'll need to add those into the files manually.\n\nEdit the `server.xml` file using your favorite editor to make the following changes:\n\n\n\n**Note:**\n\nThe db2 service provisioned in the IBM cloud shall be used as the database. Access the db2 service and navigate to the \"Service Credentials Tab\" to retrieve the database information listed below:\n1. User name\n1. password\n1. db name\n1. db host name\n1. db port\n\n\n\n- Change the `jpa-2.1` feature to `jpa-2.0`\n\n- Add health feature, to enable the health check task to be passed in the pipeline\n    ```bash\n    <feature>mpHealth-1.0</feature> \n    ```\n- Uncomment the `dataSources` and `jdbcDrivers`\n\n- As part of the server.xml, there are two references to jdbcDriver. Each reference will map the path of the db2 and db2 licence jar  locations as `${shared.config.dir}/lib/global/db2jcc.jar` and `${shared.config.dir}/lib/global/db2jcc_license_cu.jar`. While one of jdbcDrive id is mapped to `DB2_Universal_JDBC_Driver_Provider` and the second is mapped to `DB2_Universal_JDBC_Driver_Provider_(XA)`.  The jdbcDriver tag snipped should be like as below \n\n    ```bash \n    <jdbcDriver id=\"DB2_Universal_JDBC_Driver_Provider\" javax.sql.DataSource=\"com.ibm.db2.jcc.DB2ConnectionPoolDataSource\">\n        <library>\n            <file name=\"${shared.config.dir}/lib/global/db2jcc.jar\"/>\n            <file name=\"${shared.config.dir}/lib/global/db2jcc_license_cu.jar\"/>\n        </library>\n    </jdbcDriver>\n    <jdbcDriver id=\"DB2_Universal_JDBC_Driver_Provider_(XA)\" javax.sql.DataSource=\"com.ibm.db2.jcc.DB2XADataSource\">\n        <library>\n            <file name=\"${shared.config.dir}/lib/global/db2jcc.jar\"/>\n            <file name=\"${shared.config.dir}/lib/global/db2jcc_license_cu.jar\"/>\n        </library>\n    </jdbcDriver>\n    ```        \n\n\n- server.xml will have two reference of `datasource` tag. Each will have an element named jdbcDriverRefs. change the jdbcDriverRefs for first one as 'DB2_Universal_JDBC_Driver_Provider' and for the second one as `DB2_Universal_JDBC_Driver_Provider_(XA)`\n\n- In the `PlantsByWebSphereDataSourceNONJTA` datasource, in the `properties.db2.jcc` line, add `user=\"{to share}\" password=\"{to share}\" transactional=\"false\"`\n\n- In the `PlantsByWebSphereDataSource` datasource, in the `properties.db2.jcc` line, add `user=\"{to share}\" password=\"{to share}\" transactional=\"true\"` (Database user name and password).  \n\n- Also change the databaseName=\"{to share}\", serverName=\"{to share}\" and portNumber=\"{to share}\" \n\n- After changing the datasource tag with jdbcDriverRefs, username & password, Database details (databaseName, serverName and portNumber), the dataSource snipped should like as below:\n    \n     ```bash \n    DATASOURCE FIRST REFERENCE:\n\n    <dataSource containerAuthDataRef=\"DefaultNode01/PlantsAuthAlias\" id=\"PlantsByWebSphereDataSourceNONJTA\" jdbcDriverRef=\"DB2_Universal_JDBC_Driver_Provider\" jndiName=\"jdbc/PlantsByWebSphereDataSourceNONJTA\">\n        <properties.db2.jcc password=\"????\" user=\"????\" beginTranForResultSetScrollingAPIs=\"false\" beginTranForVendorAPIs=\"false\" connectionSharing=\"1\" databaseName=\"????\" enableClientInformation=\"false\" enableMultithreadedAccessDetection=\"false\" errorDetectionModel=\"ExceptionMapping\" jmsOnePhaseOptimization=\"false\" name=\"PlantsByWebSphereDataSourceNONJTA\" nonTransactionalDataSource=\"false\" portNumber=\"?????\" preTestSQLString=\"SELECT CURRENT SQLID FROM SYSIBM.SYSDUMMY1\" propagateClientIdentityUsingTrustedContext=\"false\" reauthentication=\"false\" retrieveMessagesFromServerOnGetMessage=\"true\" serverName=\"????\" traceLevel=\"-1\" unbindClientRerouteListFromJndi=\"false\" useTransactionRedirect=\"false\" validateNewConnection=\"false\" validateNewConnectionRetryCount=\"100\" validateNewConnectionRetryInterval=\"3\"/>\n        <connectionManager agedTimeout=\"0\" connectionTimeout=\"180\" maxIdleTime=\"1800\" maxPoolSize=\"10\" minPoolSize=\"0\" reapTime=\"180\"/>\n    </dataSource>\n\n    ```\n    **Note:*** ???? should be replaced by actual values\n    ```bash \n    DATASOURCE SECOND REFERENCE:\n\n    <dataSource containerAuthDataRef=\"DefaultNode01/PlantsAuthAlias\" id=\"PlantsByWebSphereDataSource\" jdbcDriverRef=\"DB2_Universal_JDBC_Driver_Provider_(XA)\" jndiName=\"jdbc/PlantsByWebSphereDataSource\">\n        <properties.db2.jcc password=\"????\" user=\"????\" beginTranForResultSetScrollingAPIs=\"false\" beginTranForVendorAPIs=\"false\" connectionSharing=\"1\" databaseName=\"????\" enableClientInformation=\"false\" enableMultithreadedAccessDetection=\"false\" errorDetectionModel=\"ExceptionMapping\" name=\"PlantsByWebSphereDataSource\" nonTransactionalDataSource=\"false\" portNumber=\"????\" preTestSQLString=\"SELECT CURRENT SQLID FROM SYSIBM.SYSDUMMY1\" propagateClientIdentityUsingTrustedContext=\"false\" reauthentication=\"false\" retrieveMessagesFromServerOnGetMessage=\"false\" serverName=\"????\" traceLevel=\"-1\" unbindClientRerouteListFromJndi=\"false\" useTransactionRedirect=\"false\" validateNewConnection=\"false\" validateNewConnectionRetryCount=\"100\" validateNewConnectionRetryInterval=\"3\"/>\n        <connectionManager agedTimeout=\"0\" connectionTimeout=\"180\" maxIdleTime=\"1800\" maxPoolSize=\"10\" minPoolSize=\"0\" reapTime=\"180\"/>\n    </dataSource>\n\n    ```\n\n- Validate the application tag to be \n    \n    ```bash\n    <application id=\"PlantsByWebSphere8\" location=\"plantsbywebsphere8.ear\" name=\"PlantsByWebSphere8\" type=\"ear\"/>\n    ```\n\n- Save your changes\n\n- Reference server.xml with the changes is also available in the downloaded reference repo '(https://github.com/ibm-gsi-ecosystem/appmod-plants-app.git)’. The location is liberty/config/server.xml.  The database details marked in ???? has to be replaced by the actual database info.\n\n- The modified `server.xml` should look like this:\n   ```\n    <?xml version=\"1.0\" encoding=\"UTF-8\"?><!--Generated by IBM TransformationAdvisor\n    Thu Nov 21 20:49:39 GMT 2019--><server>\n    <!--These elements have been identified from this application's configuration.-->\n    <featureManager>\n        <feature>beanValidation-1.1</feature>\n        <feature>cdi-1.2</feature>\n        <feature>ejbLite-3.2</feature>\n        <feature>el-3.0</feature>\n        <feature>javaMail-1.5</feature>\n        <feature>jndi-1.0</feature>\n        <feature>jpa-2.0</feature>\n        <feature>jsf-2.2</feature>\n        <feature>jsp-2.3</feature>\n        <feature>servlet-3.1</feature>\n        <feature>mpHealth-1.0</feature>\n    </featureManager>\n    <!-- <variable name=\"DERBY_JDBC_DRIVER_PATH\" value=\"${WAS_INSTALL_ROOT}/derby/lib\"/> -->\n    <httpEndpoint host=\"*\" httpPort=\"9080\" httpsPort=\"9443\" id=\"defaultHttpEndpoint\"/>\n    <!-- <variable name=\"DB2UNIVERSAL_JDBC_DRIVER_NATIVEPATH\" value=\"\"/> -->\n    <variable name=\"DERBY_JDBC_DRIVER_PATH\" value=\"${shared.config.dir}/lib/global\"/>\n    <variable name=\"DB2UNIVERSAL_JDBC_DRIVER_NATIVEPATH\" value=\"${shared.config.dir}/lib/global\"/>\n    <applicationManager autoExpand=\"true\"/>\n    <!--These elements are from the profile level configuration. Not all of them may be necessary for your application.-->\n    <dataSource containerAuthDataRef=\"DefaultNode01/PlantsAuthAlias\" id=\"PlantsByWebSphereDataSourceNONJTA\" jdbcDriverRef=\"DB2_Universal_JDBC_Driver_Provider\" jndiName=\"jdbc/PlantsByWebSphereDataSourceNONJTA\">\n        <properties.db2.jcc user=\"db2inst1\" password=\"db2Pa2359w0rd123\" transactional=\"false\" beginTranForResultSetScrollingAPIs=\"false\" beginTranForVendorAPIs=\"false\" connectionSharing=\"1\" databaseName=\"PLANTSDB\" enableClientInformation=\"false\" enableMultithreadedAccessDetection=\"false\" errorDetectionModel=\"ExceptionMapping\" jmsOnePhaseOptimization=\"false\" name=\"PlantsByWebSphereDataSourceNONJTA\" nonTransactionalDataSource=\"false\" portNumber=\"32612\" preTestSQLString=\"SELECT CURRENT SQLID FROM SYSIBM.SYSDUMMY1\" propagateClientIdentityUsingTrustedContext=\"false\" reauthentication=\"false\" retrieveMessagesFromServerOnGetMessage=\"true\" serverName=\"169.62.104.36\" traceLevel=\"-1\" unbindClientRerouteListFromJndi=\"false\" useTransactionRedirect=\"false\" validateNewConnection=\"false\" validateNewConnectionRetryCount=\"100\" validateNewConnectionRetryInterval=\"3\"/>\n        <connectionManager agedTimeout=\"0\" connectionTimeout=\"180\" maxIdleTime=\"1800\" maxPoolSize=\"10\" minPoolSize=\"0\" reapTime=\"180\"/>\n    </dataSource>\n    <dataSource containerAuthDataRef=\"DefaultNode01/PlantsAuthAlias\" id=\"PlantsByWebSphereDataSource\" jdbcDriverRef=\"DB2_Universal_JDBC_Driver_Provider_(XA)\" jndiName=\"jdbc/PlantsByWebSphereDataSource\">\n        <properties.db2.jcc user=\"db2inst1\" password=\"db2Pa2359w0rd123\" transactional=\"true\" beginTranForResultSetScrollingAPIs=\"false\" beginTranForVendorAPIs=\"false\" connectionSharing=\"1\" databaseName=\"PLANTSDB\" enableClientInformation=\"false\" enableMultithreadedAccessDetection=\"false\" errorDetectionModel=\"ExceptionMapping\" name=\"PlantsByWebSphereDataSource\" nonTransactionalDataSource=\"false\" portNumber=\"32612\" preTestSQLString=\"SELECT CURRENT SQLID FROM SYSIBM.SYSDUMMY1\" propagateClientIdentityUsingTrustedContext=\"false\" reauthentication=\"false\" retrieveMessagesFromServerOnGetMessage=\"false\" serverName=\"169.62.104.36\" traceLevel=\"-1\" unbindClientRerouteListFromJndi=\"false\" useTransactionRedirect=\"false\" validateNewConnection=\"false\" validateNewConnectionRetryCount=\"100\" validateNewConnectionRetryInterval=\"3\"/>\n        <connectionManager agedTimeout=\"0\" connectionTimeout=\"180\" maxIdleTime=\"1800\" maxPoolSize=\"10\" minPoolSize=\"0\" reapTime=\"180\"/>\n    </dataSource>\n    <jdbcDriver id=\"DB2_Universal_JDBC_Driver_Provider\" javax.sql.DataSource=\"com.ibm.db2.jcc.DB2ConnectionPoolDataSource\">\n        <library>\n            <file name=\"/config/lib/db2jcc.jar\"/>\n            <file name=\"/config/lib/db2jcc_license_cu.jar\"/>\n        </library>\n    </jdbcDriver>\n    <jdbcDriver id=\"DB2_Universal_JDBC_Driver_Provider_(XA)\" javax.sql.DataSource=\"com.ibm.db2.jcc.DB2XADataSource\">\n        <library>\n            <file name=\"/config/lib/db2jcc.jar\"/>\n            <file name=\"/config/lib/db2jcc_license_cu.jar\"/>\n        </library>\n    </jdbcDriver>\n    <authData id=\"DefaultNode01/PlantsAuthAlias\" password=\"???\" user=\"db2inst1\"/>\n    <application id=\"PlantsByWebSphere8\" location=\"plantsbywebsphere8.ear\" name=\"PlantsByWebSphere8\" type=\"ear\"/>\n    </server>\n    ```\n\n- Push the change to Git (server.xml and db2jcc_license_cu.jar)\n    ```bash\n    git add .\n    git commit -m \"Changes related to DB -server.xml and db2jcc_license_cu.jar\"\n    git push\n    ```\n\n\nNow that we've configured Liberty and the application, let's deploy it on the Openshift.\n\n\n### Run the application on Liberty\n\n<Tabs>\n\n<Tab label=\"oc pipeline\" open=\"true\">\n\nAs we plan to use the Tekton pipeline to deploy the application to the Openshift environment, we need additional files to be copied. \n\n- Copy charts (folder) to your base directory from the earlier downloaded/clone repository '(https://github.com/ibm-gsi-ecosystem/appmod-plants-app.git)'. This Contains the files related to pipeline deployment configuration.\n\n- Copy assets (folder) to your base directory from the earlier downloaded/clone repository '(https://github.com/ibm-gsi-ecosystem/appmod-plants-app.git)'. This Contains the Binaries of both the application and Db2 related, in a structured manner, that shall be used by the pom.xml during the maven build as part of the test stage in the pipeline.\n\n- Copy Jenkinsfile (file) to your base directory from the earlier downloaded/clone repository '(https://github.com/ibm-gsi-ecosystem/appmod-plants-app.git)'. This Contains the definition to the pipeline using the javalibertyapp image\n\n- Copy pom.xml (file) to your base directory from the earlier downloaded/clone repository '(https://github.com/ibm-gsi-ecosystem/appmod-plants-app.git)'. The original pom.xml generated by TA will be replaced by this pom.file. This file uses the websphere liberty container as runtime environment, since this application would need JPA2.0 supported environment for database access.\n\n- TA generated pom will look like as below\n\n   ```bash\n    <!-- Generated by IBM TransformationAdvisor -->\n    <!-- Wed May 13 10:33:04 UTC 2020 -->\n    <project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n        <modelVersion>4.0.0</modelVersion>\n\n        <groupId>com.ibm.ta</groupId>\n        <artifactId>plantsbywebsphere8</artifactId>\n        <version>1.0.0</version>\n        <packaging>war</packaging>\n\n        <name>plantsbywebsphere8</name>\n        <dependencies>\n            <dependency>\n                <groupId>junit</groupId>\n                <artifactId>junit</artifactId>\n                <version>4.8.2</version>\n                <scope>test</scope>\n            </dependency>\n        </dependencies>\n\n  \n    </project>\n   ```\n\n- Replaced pom for the pipeline to use websphere liberty is as below\n\n    ```bash\n    <project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n        <modelVersion>4.0.0</modelVersion>\n\n        <parent>\n            <groupId>net.wasdev.wlp.maven.parent</groupId>\n            <artifactId>liberty-maven-app-parent</artifactId>\n            <version>RELEASE</version>\n        </parent>\n\n        <groupId>com.ibm.ta</groupId>\n        <artifactId>tamigration</artifactId>\n        <version>1.0</version>\n        <packaging>war</packaging>\n        <properties>\n            <file.repo.name>assets</file.repo.name>\n        </properties>\n\n        <repositories>\n            <!--local migration assets repo-->\n            <repository>\n                <id>project.local</id>\n                <name>project</name>\n                <url>file:${project.basedir}/${file.repo.name}</url>\n            </repository>\n        </repositories>\n        <dependencies>\n        <!-- example of adding a war file dependency -->\n            <dependency>\n                <groupId>com.ibm.ta</groupId>\n                <artifactId>plantsbywebsphere8</artifactId>\n                <version>0.1</version>\n                <type>ear</type>\n            </dependency>\n            <dependency>\n                <groupId>com.ibm.ta</groupId>\n                <artifactId>db2jcclicensecu</artifactId>\n                <version>0.1</version>\n                <type>jar</type>\n            </dependency>\n            <dependency>\n                <groupId>com.ibm.ta</groupId>\n                <artifactId>db2jcc</artifactId>\n                <version>0.1</version>\n                <type>jar</type>\n            </dependency>\n        </dependencies>\n        <build>\n            <finalName>${project.artifactId}</finalName>\n            <plugins>\n                <plugin>\n                    <groupId>org.apache.maven.plugins</groupId>\n                    <artifactId>maven-dependency-plugin</artifactId>\n                    <version>3.1.2</version>\n                    <executions>\n\n                        <execution>\n                            <id>copy-application-dependency</id>\n                            <phase>generate-sources</phase>\n                            <goals>\n                                <goal>copy-dependencies</goal>\n                            </goals>\n                            <configuration>\n                            <!-- put war dependency file in target after dependency resolution -->\n                                <outputDirectory>${project.build.directory}</outputDirectory>\n                                <overWriteReleases>false</overWriteReleases>\n                                <overWriteSnapshots>true</overWriteSnapshots>\n                                <excludeTransitive>true</excludeTransitive>\n                                <includeTypes>ear</includeTypes>\n                            </configuration>\n                        </execution>\n\n                        <execution>\n                            <id>copy-shared-library-artifact-db2jcclicensecu</id>\n                            <phase>package</phase>\n                            <goals>\n                                <goal>copy-dependencies</goal>\n                            </goals>\n                            <configuration>\n                            <!--   <outputDirectory>${project.build.directory}/liberty/wlp/usr/servers/defaultServer/lib/global</outputDirectory> -->\n                                <outputDirectory>${project.build.directory}/liberty/wlp/usr/shared/config/lib/global</outputDirectory> \n                                <includeGroupIds>com.ibm.ta</includeGroupIds>\n                                <includeArtifactIds>db2jcclicensecu</includeArtifactIds>\n                                <includeTypes>jar</includeTypes>\n                            </configuration>\n                        </execution>\n\n                        <execution>\n                            <id>copy-shared-library-artifact-db2jcc</id>\n                            <phase>package</phase>\n                            <goals>\n                                <goal>copy-dependencies</goal>\n                            </goals>\n                            <configuration>\n                            <!--<outputDirectory>${project.build.directory}/liberty/wlp/usr/servers/defaultServer/lib/global</outputDirectory>-->\n                                <outputDirectory>${project.build.directory}/liberty/wlp/usr/shared/config/lib/global</outputDirectory>\n                                <includeGroupIds>com.ibm.ta</includeGroupIds>\n                                <includeArtifactIds>db2jcc</includeArtifactIds>\n                                <includeTypes>jar</includeTypes>\n                            </configuration>\n                        </execution>\n\n                    </executions>\n                </plugin>\n\n                <plugin>\n                    <groupId>org.apache.maven.plugins</groupId>\n                    <artifactId>maven-war-plugin</artifactId>\n                    <version>3.2.2</version>\n                    <configuration>\n                        <failOnMissingWebXml>false</failOnMissingWebXml>\n                        <packagingExcludes>pom.xml</packagingExcludes>\n                        <skip>true</skip>\n                    </configuration>\n                </plugin>\n\n                <plugin>\n                    <groupId>net.wasdev.wlp.maven.plugins</groupId>\n                    <artifactId>liberty-maven-plugin</artifactId>\n                    <configuration>\n                        <!-- adding for was liberty -start-->\n                        <assemblyArtifact>\n                            <groupId>com.ibm.websphere.appserver.runtime</groupId>\n                            <artifactId>wlp-javaee7</artifactId>\n                            <version>RELEASE</version>\n                            <type>zip</type>\n                        </assemblyArtifact>\n                        <stripVersion>true</stripVersion>\n                        <serverStartTimeout>120</serverStartTimeout>\n                        <configFile>src/main/liberty/config/server.xml</configFile>\n                        <bootstrapProperties>\n                            <default.http.port>${http.port}</default.http.port>\n                            <default.https.port>${https.port}</default.https.port>\n                            <app.context.root>${app.name}</app.context.root>\n                        </bootstrapProperties>\n                    </configuration>\n\n                    <executions>\n                        <execution>\n                            <id>package-server</id>\n                            <configuration>\n                            <outputDirectory>target/wlp-package</outputDirectory>\n                            </configuration>\n                        </execution>\n                    </executions>\n                \n                </plugin>\n            </plugins>\n        </build>\n  \n    </project>\n    ```\n\n- Push the change to Git (file related to pipeline)\n    ```bash\n    git add .\n    git commit -m \"Changes related to Enablement of the pipeline deployment\"\n    git push\n    ```\n\nNow that we are ready for the application deployment on the Openshift cluster, we will here follow the pipeline approach for the build and deployment. Let us use the Cloud Shell for the same\n\n- Login to your OC cluster using the Copy Login Command from the browser of the openshift console\n    ```bash\n    $ oc login {Cluster info}\n    $ oc project dev-{initial} \n    $ oc project -q  \n    \n    ```\n\n- Let us use igc pipeline to build and deploy. From the repository directory let us execute the oc sync command to configure your project environment in the openshift cluster\n\n    ```bash\n    $ oc sycn {your project} --dev\n\n    Setting up namespace {your project} and serviceAccount default\n\n    ```\n- Let us trigger the pipeline using the oc pipeline command from the same repo directory.  \n\n    - This would request you request for pipeline to select with options \n        - Jenkins\n        - Tekton\n    - Select the Tekton option\n   \n    - As the next step, to configure git repo for the pipeline, it would ask for the git \n        - username  (if not configured already for this project)\n        - Token/password (if not configured already for this project)\n        - branch (Press enter if branch is (master)) otherwise provide the branch details\n\n    - Next it would request for the \"Select the Pipeline to use in the PipelineRun\"\n        - Select the option : ibm-java-maven\n\n    - Next it would request for \"Would you like to enable the pipeline to scan the image for vulnerabilities\"\n        - Select Yes (if you want to include the image scan) /  No (if you don't want to include the image scan)\n        - In this case, we will go with the scan option as 'No'\n\n-  The output of the exection of oc pipeline as below\n    ```bash\n    $ oc pipeline\n\n    ? Select the type of pipeline that should be run? Tekton\n    Creating pipeline on openshift cluster in {your project} namespace\n    Getting git parameters\n    Git credentials have already been stored for user: {user name}\n    Project git repo: {your git repor}\n    ? Provide the git branch that should be used: master\n    Creating service account: pipeline\n    Creating Git PipelineResource\n    Creating Image PipelineResource\n    ? Select the Pipeline to use in the PipelineRun: ibm-java-maven\n    ? Would you like to enable the pipeline to scan the image for vulnerabilities? No\n    Copying tasks from tools\n    Copied Pipeline from tools/ibm-java-maven to {Openshift Project Name /Application Name}\n    Creating TriggerTemplate for pipeline: {Application Name}\n    Creating TriggerBinding for pipeline: {Application Name}\n    Creating TriggerEventListener for pipeline: {Application Name}\n    Creating Route for pipeline: {Application Name}\n    Creating PipelineRun for pipeline: {Application Name}\n    Creating webhook for repo: {github repo}\n\n    ```\n\n- This will create the project pipeline in {your project} and the pipeline will start executing. You can see the pipeline execution as part of the openshift dash board. \n\n    - Navigate to the Developer Console -> Navigate to the 'Pipelines' in the left Nav -> Select your project space from the drop down option -> select your application link -> Select the 'Pipeline Runs' and again the application link.\n\n![tekton-pipeline-runs](images/ta_pipelineruns_scan_no.png)\n\n- Once the pipeline is executed successfully, the application can be tested. To get the routes of the application first navigate to the \n\n    - Topology on the left nav -> Then click on your application. On the right side you should see the overview and resources -> navigate to the resources tab, you would be able to see the routes link. Using the routes link, test the application access\n    \n- Test the app\n\n    - Open the browser and navigate to the OpenShift dashboard console\n\n    - Navigate to the 'Topology' section in the left nav.\n\n    - Select your project/name-space and then select the Application. \n\n    - After selection of the application, on the right you will be able to see details of the application in tabs/sections as Overview and Resources\n\n    - As part of the Resource tab, you can get the routes of the application that shows two routes links.\n\n    - Click the link of the route with Path /PlantsByWebSphere\n\n    - You will be able to landup in the home page of the application\n\n    ![PlantsByLiberty](images/twas-pbw.jpg)\n\n\n</Tab>\n<Tab label=\"S2I\" open=\"true\">  \nNow that we are ready for the application deployment on the Openshift cluster, we will here follow the S2I (Source to Image approach) for the build and deployment. Let us use the Cloud Shell for the same.\n\n**Note:**\n\nEnsure you **don't copy** and push to the git, any of the below folders and files that are used by the pipeline from the reference repo ‘(https://github.com/ibm-gsi-ecosystem/appmod-plants-app.git)’.\n\n1. Copy charts (folder) \n1. Copy assets (folder)\n1. Copy Jenkinsfile (file) \n1. Copy pom.xml (file). Use only the default pom generated by the TA \n\n\nThe steps below will help to deploy the application to the cluster using S2I\n\n- Login to your OC cluster using the Copy Login Command from the browser of the openshift console\n    ```bash\n    oc login {Cluster info}\n    oc project dev-{initial} \n    oc project -q  \n    ```\n\n- Let us use openshift S2I to build and deploy\n\n    ```bash\n    oc new-app 'https://github.com/{repo}/ta-appmodern-migrate.git' --name=plantsbyliberty\n    .....\n    .....\n\n    --> Success\n        Build scheduled, use 'oc logs -f bc/plantsbyliberty' to track it progress\n        Application is not exposed. You can expose services to the outside world by \n    executing one or more of the commands below:\n          'oc expose svc/plantsbyliberty'\n        Run 'oc status' to view your app\n    ```\n\n\n\n- Check the logs to track the build and deployment. This will take few minutes to deploy\n    ```bash\n    oc logs -f bc/plantsbyliberty\n    ```\n\n    Once the deployment is completed, create the service for the application\n\n    ```bash\n    oc expose svc/plantsbyliberty\n    oc status\n    ```\n\n- If you need to redeploy the app after some changes, you can do this by manually triggering the below command\n    ```bash\n    oc start-build plantsbyliberty\n    ```\n\n\n- Now you can access the application by getting the hostname for the application by using get routes\n    ```bash\n    oc get routes | grep plantsbyliberty\n    ```\n\n- Test the app\n\n    - Open the browser and navigate to the OpenShift dashboard console\n\n    - Navigate to the 'Topology' section in the left nav.\n\n    - Select your project/name-space and then select the Application. \n\n    - After selection of the application, on the right you will be able to see details of the application in tabs/sections as Overview and Resources\n\n    - As part of the Resource tab, you can get the routes of the application.\n\n    - Click the link of the route  that you retrieved using \"oc get routes | grep plantsbyliberty\" \n    \n    - The route will open a new tab. Add the Path /PlantsByWebSphere at the end, to access the application\n\n    - You will be able to landup in the home page of the application\n\n    ![PlantsByLiberty](images/twas-pbw.jpg)\n\n</Tab>\n</Tabs>\n\n\n\n\nThat's it. You now have this application running on Liberty in a Docker container which is sufficient for this exercise.\n\n## Summary\n\nYou have now completed a simple Application Modernization exercises in multiple steps. This exercise demonstrated a simple runtime modernization scenario that can be moved to cloud without any code change to the application.\n","fileAbsolutePath":"/home/runner/work/ibm-gsi-cloudnative-journey/ibm-gsi-cloudnative-journey/src/pages/developer-intermediate/appmod-exercise1-part3/index.mdx"}}}}